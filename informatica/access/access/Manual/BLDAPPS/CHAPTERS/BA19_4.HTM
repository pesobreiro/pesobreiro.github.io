<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head><title>Connection Strategies</title>
<link REL="STYLESHEET" HREF="naetugp.css" TYPE="text/css">
<script Language="VBScript">
Dim look
Sub SyncURL(look)
if right(top.frames(0).frames(1).location.href, 10)="toc_tc.htm" then
top.frames(0).frames(1).TreeCtl1.SyncToURL(look)
end if
End Sub
</script>
<meta name="Microsoft Theme" content="expeditn 011, default"></head>
<!--DocHeaderStart-->
<body background="../../../../_themes/expeditn/exptextb.jpg" bgcolor="#FFFFFF" text="#000000" link="#993300" vlink="#666600" alink="#CC3300"><!--mstheme--><font face="book antiqua, times new roman, times"><a HREF="ba19_3.htm" OnClick="SyncURL(&quot;chapters/ba19_3.htm&quot;)"><img SRC="..\images\prevpage.gif" ALT="Previous Page" ALIGN="RIGHT" BORDER="0"></a>
<!--DocHeaderEnd-->
<!-- This is a PANDA Generated HTML file. The source is a WinWord Document. -->
<a NAME="3ConnectionStrategies"></a>
<p CLASS="heading3OrgHeading1h1">Connection Strategies</p>
<p CLASS="Textttext">The first time you issue a command that requires access to the server, you must establish a connection between the server and your application. Establishing a connection takes time and memory from both the client and the server. This section describes several ways you can limit connections, thus reducing the resources your application uses.</p>
<a NAME="4Preconnecting"></a>
<p CLASS="heading4OrgHeading2h2">Preconnecting</p>
<p CLASS="Textttext">By using the connection management capabilities of Microsoft Jet, you can log a user on to a server when your application starts, without waiting until the first form or datasheet opens. This is called <span CLASS="NewTermntrm">preconnecting</span>. Microsoft Access caches the connection and authentication information (user name and password), and reuses it as needed. Preconnecting may increase the time it takes your application to start, but it improves the performance of your application while it is running.
<p CLASS="Textttext">One way to preconnect is to create a pop-up form where users can enter their user name and password, construct a connection string that contains the values, and then use the <span CLASS="ElementNameeln">OpenDatabase</span> method. For example, the following procedure connects to a server called MyServer and opens a database:</p>
<p CLASS="CodeTextct">Sub PreConnect (strUserName As String, strPassword As String)<br>&nbsp;&nbsp;&amp;nbspDim wrkRemote As Workspace, dbsRemote As Database<br>&nbsp;&nbsp;&amp;nbspDim strConnect As String<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&amp;nbspstrConnect = &quot;ODBC;DSN=MyServer;DATABASE=MyDatabase;&quot; &amp; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;UID=&quot; &amp; strUserName &amp; &quot;PWD=&quot; &amp; strPassword &amp; &quot;;&quot;<br>&nbsp;&nbsp;&amp;nbspSet wrkRemote = DBEngine.Workspaces(0)<br>&nbsp;&nbsp;&amp;nbspSet dbsRemote = wrkRemote.OpenDatabase(&quot;&quot;, False, False, strConnect)<br>&nbsp;&nbsp;&amp;nbspdbsRemote.Close&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Close database but keep connection.<br>End Sub</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on creating pop-up forms, search the Help index for &quot;pop-up forms, creating.&quot;</p>
<p CLASS="Textttext">If you're not sure which ODBC data source you should connect to, you can display the <span CLASS="ElementNameeln">ODBC Data Sources</span> dialog box by using <span CLASS="CodeTextEmbeddedcte">&quot;ODBC;&quot;</span> for the first argument in the connection string. This dialog box displays a list of all registered ODBC data sources available from your computer. You can then select a server and a database, and enter a user name and a password.
<p CLASS="Textttext">Once a connection is made, you can access the actual connection string by using the <span CLASS="ElementNameeln">Connect</span> property, which identifies your connection to the server. You can then use the <span CLASS="CodeTextEmbeddedcte">strConnect</span> variable when you create pass-through queries or link tables. For example:</p>
<p CLASS="CodeTextct">Sub PreConnect()<br>&nbsp;&nbsp;&amp;nbspDim wrkRemote As Workspace, dbsRemote As Database<br>&nbsp;&nbsp;&amp;nbspDim strConnect As String<br>&nbsp;&nbsp;&amp;nbspSet wrkRemote = DBEngine.Workspaces(0)<br>&nbsp;&nbsp;&amp;nbspSet dbsRemote = wrkRemote.OpenDatabase(&quot;&quot;, False, False, &quot;ODBC;&quot;)<br>&nbsp;&nbsp;&amp;nbspstrConnect = dbsRemote.Connect<br>&nbsp;&nbsp;&amp;nbspdbsRemote.Close&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Close database but keep connection.<br>End Sub</p>
<p CLASS="Textttext">In both examples, the <span CLASS="ElementNameeln">Close</span> method doesn't disconnect you from the server<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">instead, Microsoft Access caches the connection locally.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>Because connections are shared, once you establish a connection to a server with a given user name and password, the connection retains that identity, even if linked tables have different stored user IDs and passwords. If you need varying levels of security on multiple linked tables, configure the server's security so that each individual user has the appropriate access permissions, instead of designing your application around multiple identities.</p>
<a NAME="4ReducingConnectionUse"></a>
<p CLASS="heading4OrgHeading2h2">Reducing Connection Use</p>
<p CLASS="Textttext">Some servers support powerful connections that can handle multiple partially completed queries at the same time. Other servers provide connections that require fewer resources, but each connection can process only one query at a time (for example, Microsoft SQL Server). Regardless of the server's capabilities, Microsoft Jet allows multiple queries and manages your connections automatically.
<p CLASS="Textttext">If your server supports multiple queries on a single connection, you generally don't have to worry about connection usage because Microsoft Access uses just one connection to the server for the entire application. However, if your server doesn't support such queries, or if your server has a limited number of connections, you should try to reduce the number of connections your application requires. This section describes ways to limit your use of connections.</p>
<a NAME="5LimitingDynasetstoRecords"></a>
<p CLASS="heading5OrgHeading3h3">Limiting Dynasets to 100 Records</p>
<p CLASS="Textttext">If your server uses multiple connections to process more than one query at the same time, you can reduce connection use by limiting dynasets to 100 records. A dynaset that contains 100 or fewer records requires only a single connection. In contrast, a dynaset that contains more than 100 records requires two connections: Microsoft Access uses one connection to fetch the primary key values from the server and another to fetch the data associated with those keys for the records visible on the screen. Other dynasets can share the second connection, but can't share the first because all key values may not have been retrieved from the server.
<p CLASS="Textttext">For example, three dynasets, each containing more than 100 records, require a total of four connections. When all of the primary key values for any of these dynasets have been fetched, or when the dynaset is closed, the corresponding connection is released. In contrast, three dynasets, each containing 100 or fewer records, require only one connection.</p>
<a NAME="5ReleasingConnections"></a>
<p CLASS="heading5OrgHeading3h3">Releasing Connections</p>
<p CLASS="Textttext">Another way to reduce the number of connections is to close connections that your application is no longer using. To cause a <span CLASS="ElementNameeln">Recordset</span> object to finish execution and close its connections, perform an action that retrieves all of the records in the <span CLASS="ElementNameeln">Recordset</span>. You can do this in one of three ways:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspIf you are using a form to manage the connection with a <span CLASS="ElementNameeln">Recordset</span> object, use the <span CLASS="ElementNameeln">MoveLast</span> method of the <span CLASS="ElementNameeln">RecordsetClone</span> property in the Open event procedure of the form. For example:</p>
<p CLASS="ListCodeText1lct1">Me.RecordsetClone.MoveLast
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspIf you are using code to manage the connection with a <span CLASS="ElementNameeln">Recordset</span> object, use the <span CLASS="ElementNameeln">MoveLast</span> method to retrieve any remaining rows. For example:</p>
<p CLASS="ListCodeText1lct1">rst.MoveLast
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUse a TOP 100 PERCENT query (or a query's <span CLASS="ElementNameeln">TopValues</span> property) to return 100 percent of the records. (This is especially useful for filling list boxes and combo boxes.)</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For more information on TOP 100 PERCENT queries, search the Help index for &quot;TOP predicate&quot; or &quot;TopValues property.&quot;
</span>
<p CLASS="ListText1lt1"></p>
<p CLASS="Textttext">Although they reduce connection usage, these techniques cause forms to open more slowly. This isn't recommended if your recordsets are very large.</p>
<a NAME="5ClosingIdleConnections"></a>
<p CLASS="heading5OrgHeading3h3">Closing Idle Connections</p>
<p CLASS="Textttext">Regardless of the type of server you're using, if someone is running your application but hasn't taken any action for a long time, you may want to close connections to the server. By default, connections are closed after 600 seconds (10 minutes) of idle time. You can change this interval in the <span CLASS="ElementNameeln">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\8.0\Access\Jet\3.5\Engines\ODBC</span> key of the Windows Registry by changing the ConnectionTimeout setting to the number of seconds you want to wait before closing idle connections. Microsoft Access closes connections even if datasheets and forms that display remote data are still open, and then automatically reconnects when the connection is needed again.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on changing Windows Registry settings, search the Help index for &quot;Windows Registry.&quot;</p>
<p CLASS="Textttext">Even if the idle time has expired, Microsoft Access can't close a connection if:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspA transaction is pending on the connection. You must commit or roll back the transaction before the connection can be closed.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe results of a query are pending. Microsoft Access doesn't close a connection if it's in the process of retrieving query results from a server.</p>
<p CLASS="Textttext">You can cause timed-out connections to stay closed by changing the setting in the <span CLASS="ElementNameeln">ODBC Refresh Interval</span> box on the <span CLASS="ElementNameeln">Advanced</span> tab of the <span CLASS="ElementNameeln">Options</span> dialog box (<span CLASS="ElementNameeln">Tools</span> menu). This setting tells Microsoft Access how often to refresh a form or datasheet that contains remote data. The default setting is 1,500 seconds; this means that after 25 minutes of idle time, Microsoft Access refreshes the current screen of remote data from the server, which requires reestablishing a timed-out connection. If you want to reduce connection use by keeping timed-out connections closed longer, increase the <span CLASS="ElementNameeln">ODBC Refresh Interval </span>setting.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the <span CLASS="ElementNameeln">ODBC Refresh Interval</span> setting, search the Help index for &quot;refresh interval, ODBC.&quot;</p>
<p><!--DocFooterStart-->
<p><span CLASS="copyright"><a HREF="cpyright.htm">© 1996 Microsoft Corporation. All rights reserved.</a></span>
<p><!--DocFooterEnd-->
<a HREF="ba19_5.htm" OnClick="SyncURL(&quot;chapters/ba19_5.htm&quot;)"><img SRC="..\images\nextpage.gif" ALT="Next Page" ALIGN="RIGHT" BORDER="0"></a><!--mstheme--></font></body></html>
