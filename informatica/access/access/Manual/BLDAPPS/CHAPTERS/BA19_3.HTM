<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head><title>Connecting to a Server</title>
<link REL="STYLESHEET" HREF="naetugp.css" TYPE="text/css">
<script Language="VBScript">
Dim look
Sub SyncURL(look)
if right(top.frames(0).frames(1).location.href, 10)="toc_tc.htm" then
top.frames(0).frames(1).TreeCtl1.SyncToURL(look)
end if
End Sub
</script>
<meta name="Microsoft Theme" content="expeditn 011, default"></head>
<!--DocHeaderStart-->
<body background="../../../../_themes/expeditn/exptextb.jpg" bgcolor="#FFFFFF" text="#000000" link="#993300" vlink="#666600" alink="#CC3300"><!--mstheme--><font face="book antiqua, times new roman, times"><a HREF="ba19_2.htm" OnClick="SyncURL(&quot;chapters/ba19_2.htm&quot;)"><img SRC="..\images\prevpage.gif" ALT="Previous Page" ALIGN="RIGHT" BORDER="0"></a>
<!--DocHeaderEnd-->
<!-- This is a PANDA Generated HTML file. The source is a WinWord Document. -->
<a NAME="3ConnectingtoaServer"></a>
<p CLASS="heading3OrgHeading1h1">Connecting to a Server</p>
<p CLASS="Textttext">To access data on a remote server, your application must establish a connection. This connection creates a communication link to the server across the network. You can use any of the following methods to connect to a server:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspLink tables and SQL views from the server</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUse pass-through queries to send SQL statements straight to the server</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspDirectly access the server by using Visual Basic</p>
<p CLASS="Textttext">This section describes each of these methods, as well as their respective time and memory requirements on both the client and the server.</p>
<a NAME="4LinkingTablesandSQLViewsfromaServer"></a>
<p CLASS="heading4OrgHeading2h2">Linking Tables and SQL Views from a Server</p>
<p CLASS="Textttext">The easiest and most common way to access data on a server is to link tables from the server. With few exceptions, you can use linked tables in your application just as you would Microsoft Access tables. Microsoft Access automatically connects to the server when you open a linked table.
<p CLASS="Textttext">If your server supports SQL views, you can link them to your local database. An <span CLASS="NewTermntrm">SQL view</span> is a virtual table that is derived from other tables or previously defined views. It has a name, a list of attributes, and a query which define the contents of the view. Microsoft Access treats a linked view exactly like a linked table without indexes. The processing defined in a view is always performed by the server.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To link a table or an SQL view from a server</p>
<p CLASS="Textttext">In your Visual Basic code, create an ODBC connection string that references the data source you set up with the ODBC Manager. Assign the connection string to a variable.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspCreate a new <span CLASS="ElementNameeln">TableDef</span> object and set its <span CLASS="ElementNameeln">Connect</span> property to the variable you created in step 1.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspAppend the <span CLASS="ElementNameeln">TableDef</span> object to the <span CLASS="ElementNameeln">TableDefs</span> collection to link the table or SQL view to your Microsoft Access database.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspOpen a <span CLASS="ElementNameeln">Recordset</span> object on the linked table or SQL view. You can use the properties and methods of the <span CLASS="ElementNameeln">Recordset</span> object to manipulate the data in the ODBC data source.</p>
<p CLASS="Textttext">The following example uses the Pubs sample database included with Microsoft SQL Server to link the Authors table, and counts the number of authors whose phone number begins with the area code that is passed as an argument to the function.</p>
<p CLASS="CodeTextct">Function CountByAreaCode(strAreaCode As String) As Long<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rst As Recordset<br>&nbsp;&nbsp;&amp;nbspDim strConnect As String, tdf As TableDef<br>&nbsp;&nbsp;&amp;nbspDim lngCount As Long<br>&nbsp;&nbsp;&amp;nbspstrConnect = &quot;ODBC;DSN=Pubs;UID=SA;PWD=;DATABASE=Pubs&quot;<br>&nbsp;&nbsp;&amp;nbspSet dbs = OpenDatabase(&quot;C:\data\cs.mdb&quot;)<br>&nbsp;&nbsp;&nbsp;' Delete any existing links named LinkedAuthors.<br>&nbsp;&nbsp;&amp;nbspOn Error Resume Next<br>&nbsp;&nbsp;&amp;nbspdbs.TableDefs.Delete &quot;LinkedAuthors&quot;<br>&nbsp;&nbsp;&amp;nbspdbs.TableDefs.Refresh<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&nbsp;' Create a TableDef and set its Connect property.<br>&nbsp;&nbsp;&amp;nbspSet tdf = dbs.CreateTableDef(&quot;LinkedAuthors&quot;)<br>&nbsp;&nbsp;&amp;nbsptdf.Connect = strConnect<br>&nbsp;&nbsp;&nbsp;' Specify the table to access within the Pubs database.<br>&nbsp;&nbsp;&amp;nbsptdf.SourceTableName = &quot;Authors&quot;<br>&nbsp;&nbsp;&amp;nbspdbs.TableDefs.Append tdf<br>&nbsp;&nbsp;&amp;nbspdbs.TableDefs.Refresh<br>&nbsp;&nbsp;&nbsp;' Open a recordset on the linked table.<br>&nbsp;&nbsp;&amp;nbspSet rst = dbs.OpenRecordset(&quot;LinkedAuthors&quot;, dbOpenForwardOnly)<br>&nbsp;&nbsp;&nbsp;' Count number of authors whose phone number begins with specified area code.<br>&nbsp;&nbsp;&amp;nbspDo Until rst.EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf Left$(rst!phone, 3) = strAreaCode Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsplngCount = lngCount + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprst.MoveNext<br>&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&amp;nbsprst.Close<br>&nbsp;&nbsp;&amp;nbspdbs.Close<br>&nbsp;&nbsp;&amp;nbspCountByAreaCode = lngCount<br>&nbsp;&nbsp;&amp;nbspExit Function<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Err.Description<br>&nbsp;&nbsp;&amp;nbspExit Function<br>End Function</p>
<p CLASS="Textttext">In this example, the Authors <span CLASS="ElementNameeln">Recordset</span> object is opened as a forward-only-type <span CLASS="ElementNameeln">Recordset</span> object to optimize performance. Because forward-only-type <span CLASS="ElementNameeln">Recordset</span> objects are snapshots, you cannot update data in them. If you want to be able to update data in the recordset, open it as a dynaset-type <span CLASS="ElementNameeln">Recordset</span> object by using the <span CLASS="ElementNameeln">dbOpenDynaset</span> constant with the <span CLASS="ElementNameeln">OpenRecordset</span> method.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note</span>&nbsp;&nbsp;&amp;nbspAlthough you can update information in ODBC databases by using update queries or dynaset-type <span CLASS="ElementNameeln">Recordset</span> objects, you should consider using a pass-through query, which is usually much more efficient. For more information on pass-through queries, see the next section <a HREF="#4UsingPassThroughQueries" OnClick="SyncURL(&quot;chapters/ba19_3.htm&quot;)">&quot;Using Pass-Through Queries.&quot;</a></p>
<p CLASS="Textttext">Microsoft Access stores field and index information for the tables you link, which improves performance when you open the tables. Relink remote tables if you change their structure or the structure of their indexes on the server.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on relinking tables, search the Help index for &quot;RefreshLink method.&quot;
<p CLASS="TipIcontpi"></p>
<p CLASS="TipTexttpt"><span CLASS="TipHeadingtph">Tip&nbsp;&nbsp;&nbsp;</span>When you link a table from a server, you usually have the option of storing your server password in the local database so that you don't have to type it each time you start the application. However, if you don't want users to have this option when they link tables, you can disable the feature. For more information, search the Help index for &quot;MSysConf table.&quot;</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on linking remote tables and creating connection strings, see Chapter 18, <a HREF="../chapters/ba18_1.htm" OnClick="SyncURL(&quot;chapters/ba18_1.htm&quot;)">&quot;Accessing External Data.&quot;</a> For general information on linking, search the Help index for &quot;tables, linking.&quot;</p>
<a NAME="5CreatingIndexesonLinkedSQLViews"></a>
<p CLASS="heading5OrgHeading3h3">Creating Indexes on Linked SQL Views</p>
<p CLASS="Textttext">If your server allows you to update data by using SQL views and you want to take advantage of this updatability in Microsoft Access, you need to create a <span CLASS="NewTermntrm">pseudo index</span> on the linked view. This index tells Microsoft Access the field or fields that make up the primary key for a record returned by the view<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">the field or fields that uniquely identify the record. Microsoft Access can then create an updatable dynaset on the view, which forms and queries can use to view and update data.
<p CLASS="Textttext">For example, suppose you link an SQL view named SeptOrdersView that returns a subset of records in the remote Orders table, and you name the linked view SeptemberOrders. Because the OrderID field is still unique within the view, you would use a data-definition query to create the index by running the following SQL statement:</p>
<p CLASS="CodeTextct">CREATE UNIQUE INDEX index1 ON SeptemberOrders (OrderID)</p>
<p CLASS="Textttext">This doesn't create a real index on the server or in your local database, nor does it take up much space locally. It simply tells Microsoft Access that the OrderID field is the primary key for the linked view.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on data-definition queries, search the Help index for &quot;data-definition queries.&quot;</p>
<a NAME="4UsingPassThroughQueries"></a>
<p CLASS="heading4OrgHeading2h2">Using Pass-Through Queries</p>
<p CLASS="Textttext">The second way to access data on a server is to use <span CLASS="NewTermntrm">pass-through queries</span>. Pass-through queries are SQL statements that are sent directly to a database server without interpretation by Microsoft Access. You can use pass-through queries in your application to directly manipulate the features of a database server that may or may not be supported by Microsoft Access.
<p CLASS="Textttext">In many applications, you'll use both ordinary Microsoft Access queries based on remote tables and pass-through queries. When you use an ordinary query to retrieve information from the tables on your database server, Microsoft Access compiles and runs the query, combining the power of the server with the capabilities of the Microsoft Jet database engine. With a pass-through query, you create an SQL statement that Microsoft Access sends directly to the server without stopping to compile the query.
<p CLASS="Textttext">Pass-through queries offer the following advantages over ordinary Microsoft Access queries:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspYou don't need to consider how much of your pass-through query is being sent to the server for processing because the query is sent without modifications. This means that more processing occurs on the server and less traffic is generated over the network.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspPass-through queries can use server-specific functionality<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">such as stored procedures and server-based intrinsic functions<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">that have no Visual Basic equivalent.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspPass-through queries can log informational messages returned by the server, such as errors, warnings, and statistics.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspWith pass-through queries, you can use nonstandard SQL extensions, as well as data-definition, server administration, and security commands that are supported by the server.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUse a pass-through query if you want to join tables from different databases on a server (if the server supports multiple databases). Because each database is a separate ODBC data source, an ordinary query would consider the join to be heterogeneous and would run at least part of the query locally.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For more information on heterogeneous joins, see <a HREF="../chapters/ba19_6.htm#5HeterogeneousJoins" OnClick="SyncURL(&quot;chapters/ba19_6.htm&quot;)">&quot;Heterogeneous Joins&quot;</a> later in this chapter.</span></p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspBulk update, delete, and append pass-through action queries are faster than action queries based on linked remote tables, especially when many records are affected. In addition, a pass-through action query cannot partially succeed as an ordinary action query can.</p>
<p CLASS="Textttext">On the other hand, pass-through queries do have several disadvantages:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspA pass-through query always returns a snapshot, which can't be updated. An ordinary query usually returns a dynaset, which reflects other users' changes and can be updated.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspWhen you design pass-through queries, you type the commands directly into the SQL Pass-Through Query window. In contrast, when you design ordinary queries, you use the graphical query design grid.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspTo create a pass-through query, you must know the exact SQL syntax supported by your server. SQL syntax and conventions often vary from server to server, particularly outer-join syntax, intrinsic function names, wildcard characters, and the use of single versus double quotation marks. All ordinary Microsoft Access queries use the same syntax, regardless of where the data is stored. Microsoft Access automatically translates Visual Basic intrinsic function names, wildcard characters, and other elements into the appropriate ODBC syntax.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspYou can't call user-defined functions in a pass-through query, but ordinary queries can use them as if they were intrinsic Visual Basic functions.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspYou can add parameters to an ordinary query, causing Microsoft Access to automatically prompt the user for the parameter value. (Alternatively, the value can be supplied from a form control.) In contrast, you can't add parameters to pass-through queries.</p>
<a NAME="5CreatingPassThroughQueries"></a>
<p CLASS="heading5OrgHeading3h3">Creating Pass-Through Queries</p>
<p CLASS="Textttext">Pass-through queries consist of an SQL statement and an ODBC connection string. The SQL statement is interpreted only by the database server and must follow the server's SQL language specification. The SQL statement cannot contain any Microsoft Access-specific elements or any Visual Basic functions or commands.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on connection strings, see Chapter 18, <a HREF="../chapters/ba18_1.htm" OnClick="SyncURL(&quot;chapters/ba18_1.htm&quot;)">&quot;Accessing External Data.&quot;</a></p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To create a pass-through query</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspCreate a <span CLASS="ElementNameeln">QueryDef</span> object by using the <span CLASS="ElementNameeln">CreateQueryDef</span> method. Specify only the <span CLASS="NewTermntrm">name </span>argument for the query. If you want to create a temporary <span CLASS="ElementNameeln">QueryDef</span> object, specify a zero-length string (&quot;&quot;) for the <span CLASS="NewTermntrm">name </span>argument.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspSet the <span CLASS="ElementNameeln">Connect</span> property of the <span CLASS="ElementNameeln">QueryDef</span> object to a valid connection string. </p>
<p CLASS="ListImportantText1lit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">Always set the <span CLASS="ElementNameeln">Connect</span> property before you set the <span CLASS="ElementNameeln">SQL</span> property so that Microsoft Jet passes the query directly to the ODBC data source without processing it. </span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspSet the <span CLASS="ElementNameeln">SQL</span> property of the <span CLASS="ElementNameeln">QueryDef</span> object to an SQL statement that is compatible with the ODBC data source you are querying.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspIf your query is an action query that does not return a recordset, set the <span CLASS="ElementNameeln">ReturnsRecords</span> property of the <span CLASS="ElementNameeln">QueryDef</span> object to <span CLASS="ElementNameeln">False</span> and use the <span CLASS="ElementNameeln">Execute</span> method to run the query. Otherwise, set the <span CLASS="ElementNameeln">ReturnsRecords</span> property to <span CLASS="ElementNameeln">True</span> and run the query by opening a recordset on the stored query definition.</p>
<p CLASS="Textttext">The following example sends three pass-though action queries to the Pubs sample database included with Microsoft SQL Server. The first query creates a new table called sales_archive with the same structure as the Sales table in the Pubs database. The second query appends all of the sales records that were created before 1993 from the Sales table to the sales_archive table. The third query deletes all of the sales records created before 1993 from the Sales table.</p>
<p CLASS="CodeTextct">Sub ArchiveSales()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, qdf As QueryDef<br>&nbsp;&nbsp;&amp;nbspDim strConnect As String<br>&nbsp;&nbsp;&amp;nbspDim strSQL As String<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspstrConnect = &quot;ODBC;DSN=Pubs;UID=sa;PWD=;DATABASE=Pubs&quot;<br>&nbsp;&nbsp;&amp;nbspSet qdf = dbs.CreateQueryDef(&quot;&quot;)<br>&nbsp;&nbsp;&amp;nbspqdf.Connect = strConnect<br>&nbsp;&nbsp;&amp;nbspstrSQL = &quot;CREATE TABLE sales_archive (stor_id char (4) &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;NOT NULL, ord_num varchar (20) NOT NULL, &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;ord_date datetime NOT NULL, &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;qty smallint NOT NULL, &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;payterms varchar (12) NOT NULL, &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;title_id tid NOT NULL)&quot;<br>&nbsp;&nbsp;&amp;nbspqdf.ReturnsRecords = False<br>&nbsp;&nbsp;&amp;nbspqdf.SQL = strSQL<br>&nbsp;&nbsp;&amp;nbspqdf.Execute<br>&nbsp;&nbsp;&amp;nbspqdf.SQL = &quot;INSERT INTO sales_archive SELECT * FROM sales WHERE ord_date &lt; '1/1/93'&quot;<br>&nbsp;&nbsp;&amp;nbspqdf.Execute<br>&nbsp;&nbsp;&amp;nbspqdf.SQL = &quot;DELETE FROM sales WHERE ord_date &lt; '1/1/93'&quot;<br>&nbsp;&nbsp;&amp;nbspqdf.Execute<br>&nbsp;&nbsp;&amp;nbspExit Sub<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Err.Description<br>&nbsp;&nbsp;&amp;nbspExit Sub<br>End Sub</p>
<p CLASS="Textttext">In the previous example, the <span CLASS="ElementNameeln">ReturnsRecords</span> property is set to <span CLASS="ElementNameeln">False</span> because all three queries are action queries. The following example uses a pass-through query to return records. It returns all sales records in the Pubs sample database for the year 1994.</p>
<p CLASS="CodeTextct">Dim dbs As Database, qdf As QueryDef<br>Dim strConnect As String, rst As Recordset<br>Dim strSQL As String<br>Set dbs = CurrentDb<br>strConnect = &quot;ODBC;DSN=Pubs;UID=SA;PWD=;DATABASE=Pubs&quot;<br>Set qdf = dbs.CreateQueryDef(&quot;94Sales&quot;)<br>qdf.Connect = strConnect<br>strSQL = &quot;SELECT * FROM sales WHERE ord_date BETWEEN &quot;<br>strSQL = strSQL &amp; &quot;'1/1/1994' AND '12/31/1994'&quot;<br>qdf.SQL = strSQL<br>qdf.ReturnsRecords = True<br>Set rst = dbs.OpenRecordset(&quot;94Sales&quot;, dbOpenSnapshot)<br>Do Until rst.EOF<br>&nbsp;&nbsp;&amp;nbspDebug.Print rst!ord_date<br>&nbsp;&nbsp;&amp;nbsprst.MoveNext<br>Loop</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note</span>&nbsp;&nbsp;&nbsp;<span CLASS="ElementNameeln">Recordset</span> objects opened on a pass-through queries are always opened as snapshots and cannot be updated.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on pass-through queries, search the Help index for &quot;pass-through queries.&quot;</p>
<a NAME="5UsingStoredProcedures"></a>
<p CLASS="heading5OrgHeading3h3">Using Stored Procedures</p>
<p CLASS="Textttext">In some environments, your access to server data is limited to a set of server-based stored procedures. You must carry out all data requests and updates through these stored procedures; you have no direct access to the remote tables. In such an environment, you use pass-through queries exclusively.
<p CLASS="Textttext">Your server may have two sets of stored procedures defined: one to retrieve data and one to update data. If you don't need to update data and only want to retrieve data, you can create a pass-through query for each stored procedure you want to call. You can then base other queries, forms, and reports on these queries as if they were linked tables.
<p CLASS="Textttext">However, if you need to update data in this type of environment, you can collect the user's input locally and then send the data to the server by running a pass-through query that calls the appropriate stored procedure. You may find either of the following two approaches helpful:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspCreate a form based on a local holding table that temporarily stores records before they are sent to the server. Add code to the form's AfterUpdate and AfterInsert event procedures that calls the data-updating stored procedures for each record in the holding table.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspCreate an unbound form to collect data and add command buttons to the form for saving the data. You can then use the values in the form's unbound controls when you call the data-updating stored procedures.</p>
<p CLASS="Textttext">In either case, you need to write Visual Basic code to create a pass-through query that uses the name of the stored procedure and the values to be supplied from the form.
<p CLASS="Textttext">If the stored procedure runs an action query, you can determine whether the stored procedure ran successfully by examining the first element of the <span CLASS="ElementNameeln">Fields</span> collection of the <span CLASS="ElementNameeln">Recordset</span> object that the stored procedure is based on. If the value is 0, then the procedure ran successfully. Otherwise, the procedure did not run successfully.
<p CLASS="Textttext">For example, the following SQL Server stored procedure increases or decreases the royalty schedules in the Roysched table of the Pubs sample database included with Microsoft SQL Server. The amount of the increase or decrease is specified in the integer parameter named delta:</p>
<p CLASS="CodeTextct">CREATE PROCEDURE change_royalty @delta int AS UPDATE roysched<br>&nbsp;&nbsp;&amp;nbspSET royalty = royalty + @delta</p>
<p CLASS="Textttext">The following function calls the change_royalty stored procedure in the Pubs sample database, examines the first element of the <span CLASS="ElementNameeln">Fields</span> collection, and returns 0 if the stored procedure ran successfully.</p>
<p CLASS="CodeTextct">Function intChangeRoyalty(intDelta As Integer) As Integer<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, qdf As QueryDef<br>&nbsp;&nbsp;&amp;nbspDim strConnect As String, rst As Recordset<br>&nbsp;&nbsp;&amp;nbspDim strSQL As String<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspstrConnect = &quot;ODBC;DSN=Pubs;UID=sa;PWD=;DATABASE=Pubs&quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = &quot;declare @status int execute @status = change_royalty&quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; intDelta &amp; &quot; select 'return value' = @status&quot;<br>&nbsp;&nbsp;&amp;nbspSet qdf = dbs.CreateQueryDef(&quot;&quot;)<br>&nbsp;&nbsp;&amp;nbspqdf.Connect = strConnect<br>&nbsp;&nbsp;&amp;nbspqdf.ReturnsRecords = True<br>&nbsp;&nbsp;&amp;nbspqdf.SQL = strSQL<br>&nbsp;&nbsp;&amp;nbspSet rst = qdf.OpenRecordset(dbOpenSnapshot)<br>&nbsp;&nbsp;&nbsp;' Examine the first element in the recordset's Fields collection.<br>&nbsp;&nbsp;&nbsp;' If it is 0, the stored procedure was successful.<br>&nbsp;&nbsp;&amp;nbspIf rst(0) = 0 Then <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintChangeRoyalty = 0 <br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintChangeRoyalty = -1<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbspExit Function<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Err.Description<br>&nbsp;&nbsp;&amp;nbspintChangeRoyalty = -1<br>&nbsp;&nbsp;&amp;nbspExit Function<br>End Function</p>
<a NAME="4DirectlyAccessingtheServer"></a>
<p CLASS="heading4OrgHeading2h2">Directly Accessing the Server</p>
<p CLASS="Textttext">The third way to connect to a server is to access it directly in Visual Basic by using the <span CLASS="ElementNameeln">OpenDatabase</span> method with an ODBC connection string. This approach has several disadvantages, however. Although it's possible to directly open snapshots and dynasets on a remote database, this is always much less efficient than using linked tables. When you link remote tables, Microsoft Jet caches locally a great deal of information about these tables, including field information, index information, and server capabilities. In contrast, when you access the remote tables directly, Microsoft Access has to ask the server for this information every time you run a query.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>You'll want to access the server directly when you preconnect. For information on preconnecting, see <a HREF="../chapters/ba19_4.htm#4Preconnecting" OnClick="SyncURL(&quot;chapters/ba19_4.htm&quot;)">&quot;Preconnecting&quot;</a> later in this chapter.</p>
<p><!--DocFooterStart-->
<p><span CLASS="copyright"><a HREF="cpyright.htm">© 1996 Microsoft Corporation. All rights reserved.</a></span>
<p><!--DocFooterEnd-->
<a HREF="ba19_4.htm" OnClick="SyncURL(&quot;chapters/ba19_4.htm&quot;)"><img SRC="..\images\nextpage.gif" ALT="Next Page" ALIGN="RIGHT" BORDER="0"></a><!--mstheme--></font></body></html>
