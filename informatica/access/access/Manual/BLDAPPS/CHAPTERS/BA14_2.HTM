<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head><title>Microsoft Access User-Level Security</title>
<link REL="STYLESHEET" HREF="naetugp.css" TYPE="text/css">
<script Language="VBScript">
Dim look
Sub SyncURL(look)
if right(top.frames(0).frames(1).location.href, 10)="toc_tc.htm" then
top.frames(0).frames(1).TreeCtl1.SyncToURL(look)
end if
End Sub
</script>
<meta name="Microsoft Theme" content="expeditn 011, default"></head>
<!--DocHeaderStart-->
<body background="../../../../_themes/expeditn/exptextb.jpg" bgcolor="#FFFFFF" text="#000000" link="#993300" vlink="#666600" alink="#CC3300"><!--mstheme--><font face="book antiqua, times new roman, times"><a HREF="ba14_1.htm" OnClick="SyncURL(&quot;chapters/ba14_1.htm&quot;)"><img SRC="..\images\prevpage.gif" ALT="Previous Page" ALIGN="RIGHT" BORDER="0"></a>
<!--DocHeaderEnd-->
<!-- This is a PANDA Generated HTML file. The source is a WinWord Document. -->
<a NAME="3MicrosoftAccessUserLevelSecurity"></a>
<p CLASS="heading3OrgHeading1h1">Microsoft Access User-Level Security</p>
<p CLASS="Textttext">User-level security is the most flexible and secure method of protecting the sensitive data, the code, and the design of objects in your application. In addition, user-level security is the only form of Microsoft Access security that allows you to establish different levels of access to sensitive data and objects.
<p CLASS="Textttext">Before you begin establishing user-level security for your application, make sure you understand the Microsoft Access user-level security model. The following sections discuss the significance of a workgroup-based user-level security model; how you can create user and group accounts to create a workgroup and establish permissions; and how you can use the tools that Microsoft Access provides, such as the User-Level Security Wizard, to help secure your databases. You can also establish security and perform security actions that aren't available using the Microsoft Access user interface by using Data Access Objects (DAO) in Visual Basic.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also</span>&nbsp;&nbsp;&amp;nbspFor more information on establishing security using Visual Basic, see <a HREF="#4UsingDataAccessObjectstoEstablishUserLevelSecurity" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Using Data Access Objects to Establish User-Level Security&quot;</a> later in this chapter.</p>
<a NAME="4TheMicrosoftAccessUserLevelSecurityModel"></a>
<p CLASS="heading4OrgHeading2h2">The Microsoft Access User-Level Security Model </p>
<p CLASS="Textttext">Unlike the security models of most other database systems, the primary form of security in Microsoft Access is <span CLASS="NewTermntrm">user-level </span>security rather than <span CLASS="NewTermntrm">share-level</span> security. (Microsoft Access does provide a simple form of share-level security: the ability to protect opening a database with a password.) Microsoft Access user-level security is similar to the security used in most network environments, such as Microsoft Windows NT Server. When users start Microsoft Access, they enter a name and password in the <span CLASS="ElementNameeln">Logon</span> dialog box. The password confirms the user's identity by checking the name and password against data in the workgroup information file. The password can be changed at any time by that user without affecting anyone else on the system. When users log on, each user is also identified as a member of one or more groups.
<p CLASS="Textttext">When a user opens a secured database, Microsoft Access determines the user's level of access to an object (including the database itself) by checking the set of permissions assigned to that user for that object. Different users and groups can have different permissions for the same objects. Every time the user tries to perform an action on an object, such as opening a form, running a query, or modifying the data in a table, Microsoft Access checks to see if the user, or any of the groups to which the user belongs, has the necessary permissions to carry out the operation. If so, the action is performed. If not, Microsoft Access informs the user that he or she doesn't have permissions to perform the requested action, and causes the operation to fail.
<p CLASS="Textttext">In contrast, database systems that provide share-level security associate passwords with specific objects, and users must supply passwords to access those objects. Any user who knows the password to a specific object can access it, and a user's level of access is determined by the kind of password that user has been given. For example, a manager may be given an update password for a table which allows him or her to change records, while a general staff member may be given a read password which only allows him or her to view records.
<p CLASS="Textttext">You can create a system similar to this with Microsoft Access user-level security by creating a Managers group with Update Data permission and a Staff group with only Read Data permission, and then assigning each user to the appropriate group. Users don't supply passwords when accessing the objects, because they have been identified as a member of the appropriate group when they logged on to Microsoft Access.</p>
<a NAME="5WhereIsWorkgroupandPermissionInformationStored"></a>
<p CLASS="heading5OrgHeading3h3">Where Is Workgroup and Permission Information Stored?</p>
<p CLASS="Textttext">Microsoft Access stores information about users and groups in a database called a <span CLASS="NewTermntrm">workgroup information file</span>. A workgroup information file stores:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe name of each user and group.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe list of users that make up each group.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe encrypted logon password of each user.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="NewTermntrm">security identifier</span> (SID) of each user and group. The SID is a machine-generated, non-readable binary string that uniquely identifies the user <br>or group.</p>
<p CLASS="Textttext">Each workgroup information file defines a <span CLASS="NewTermntrm">workgroup</span>, and can be used by many Microsoft Access databases. A workgroup is a group of users in a multiuser environment who share data and the same workgroup information file. You manage users, their passwords, and the groups they are assigned to by using the <span CLASS="ElementNameeln">User And Group Accounts</span> dialog box (<span CLASS="ElementNameeln">Tools</span> menu, <span CLASS="ElementNameeln">Security</span> submenu).</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on users and groups, see <a HREF="#5UsersandGroups" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Users and Groups&quot;</a> later in this chapter.</p>
<p CLASS="Textttext">Permissions that you assign to users and groups for the objects in a database are stored in hidden system tables within the database. Even if a new workgroup information file is established, the permissions associated with the objects in a database don't change. You assign permissions on the <span CLASS="ElementNameeln">Permissions</span> and <span CLASS="ElementNameeln">Change Owner</span> tabs of the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box; this information affects the objects in the open database, not the workgroup information file.
<p CLASS="Textttext">The following illustration shows how these elements of Microsoft Access user-level security are related.</p>
<p CLASS="Arta"><img SRC="..\images\ABAC1401.jpg"></p>
<p CLASS="Textttext">The location of the workgroup information file in use is specified in the Windows Registry. You can create a new workgroup information file or specify which file to use with the Workgroup Administrator. You can also specify which file to use when starting Microsoft Access with the <span CLASS="ElementNameeln">/wrkgrp</span> command-line option.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on using the Workgroup Administrator, search the Help index for &quot;Workgroup Administrator.&quot; For more information on how the workgroup information file is specified in the Registry, search the Help index for &quot;workgroup information file, specifying in Registry.&quot;</p>
<a NAME="5UsersandGroups"></a>
<p CLASS="heading5OrgHeading3h3">Users and Groups</p>
<p CLASS="Textttext">You use the <span CLASS="ElementNameeln">User And Group Accounts</span> dialog box (<span CLASS="ElementNameeln">Tools</span> menu, <span CLASS="ElementNameeln">Security</span> submenu), to create new user and group accounts for your workgroup. When you create a new user or group account, you supply a name and a <span CLASS="NewTermntrm">personal identifier</span> (PID). The PID is a case-sensitive alphanumeric string that can be from 4 through 20 characters long. Microsoft Access feeds the name and the PID into an encryption program to generate the security identifier (SID) for that account. The SID is used internally by Microsoft Access to uniquely identify and validate users and groups. It is important to note that the PID is not a password. It is used only when creating user and group accounts. A user's password can be designated only after an account for that user has been created.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>Be sure to write down the exact, case-sensitive names and PIDs that you use to create user and group accounts and keep them in a secure place. If your workgroup information file becomes damaged or lost and you need to re-create it, you to must re-enter the exact names and PIDs to re-create identical SIDs for the user and group accounts you created. Additionally, you need to use the Workgroup Administrator to create an identical workgroup information file to contain these accounts by re-entering the name, company name, and workgroup ID (WID) used when it was originally created. For more information on creating an identical workgroup information file, see <a HREF="#BLAdmins" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Admins&quot;</a> later in this section.</p>
<p CLASS="Textttext">A Microsoft Access workgroup information file contains the following default user and group accounts:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">Admin&nbsp;&nbsp;&nbsp;</span>The default user account. Before user-level security is established, all users are automatically logged on using the Admin user account when they start Microsoft Access. As a result, the Admin user owns and has full permissions on all objects created in the database. Because the Admin user's SID is identical across all installations of Microsoft Access and Visual Basic, all objects that the Admin user owns or has permissions to are open to anyone using another copy of Microsoft Access or Visual Basic. When establishing user-level security, it's important to make sure that the Admin user doesn't own or have any permissions on objects that you want to secure. For assistance with this process, run the User-Level Security Wizard provided with Microsoft Access.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For more information on running the User-Level Security Wizard, see <a HREF="#4EstablishingSecuritywiththeUserLevelSecurityWizard" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Establishing Security with the User-Level Security Wizard&quot;</a> later in this chapter.</span></p>
<a NAME="BLAdmins"></a>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">Admins&nbsp;&nbsp;&nbsp;</span>The system administrator's group account. There must be at least one member of the Admins group at all times. Before user-level security is established, the default Admin user is the only member of the Admins group. Because members of the Admins group have the power to perform actions such as changing permissions, modifying user and group memberships, and clearing users' passwords, you want to be careful when assigning users to this group.</p>
<p CLASS="ListImportantText1lit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">The Microsoft Access Setup program uses only the user's name and the company name provided during setup to create the SID for the Admins group of the default workgroup information file. Because these two values are available from the Microsoft Access Help menu, someone trying to breach security could re-create an identical Admins account by using the Workgroup Administrator to create a new workgroup information file with these values, and then add themselves to the Admins group.</span></p>
<p CLASS="ListImportantText1lit">Before establishing user-level security, you should use the Workgroup Administrator to create a new workgroup information file, making sure to enter a third value known only to you, the workgroup ID (WID). This ensures that the new workgroup information file contains a new Admins group with a unique, secure SID.
<p CLASS="ListImportantText1lit">Record the three case-sensitive strings used to create the new workgroup information file and keep them in a secure place. In the event that the workgroup information file becomes lost or damaged, you can re-create a workgroup information file with an identical Admins group by re-entering these three strings. Members of this re-created Admins group will be able to grant themselves permissions on all objects that were created when the old workgroup information file was in effect.
<p CLASS="ListText1lt1">The Admins group's Administer permission<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">the right to change permissions<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">can't be revoked using the Microsoft Access user interface. Even if you clear the <span CLASS="ElementNameeln">Administer</span> check box on the <span CLASS="ElementNameeln">Permissions</span> tab of the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box (<span CLASS="ElementNameeln">Tools</span> menu, <span CLASS="ElementNameeln">Security</span> submenu) for the Admins group on an object, the permission remains. It is possible to revoke the Admins group's Administer permission by using Data Access Objects (DAO) code, but this isn't recommended because there is no way to grant the permission back again. It's better to make sure you're using a workgroup information file created with a secure WID, which ensures a unique and secure Admins group, and then make sure only the appropriate users are assigned to the Admins group.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">Users&nbsp;&nbsp;&nbsp;</span>The default group account comprising all user accounts. Microsoft Access automatically adds user accounts to the Users group when you create them. Any permissions assigned explicitly to the Users group are available to all users in all installations of Microsoft Access and Visual Basic because, like the Admin user's SID, the Users group's SID is identical in all workgroup information files. Similar to concerns about the default Admin user, when establishing user-level security, it's important to make sure that the Users group doesn't own or have permissions on objects that you want secure.</p>
<a NAME="5Permissions"></a>
<p CLASS="heading5OrgHeading3h3">Permissions</p>
<p CLASS="Textttext"><span CLASS="NewTermntrm">Explicit</span> permissions are those permissions granted directly to a user; no other users are affected. <span CLASS="NewTermntrm">Implicit</span> permissions are those permissions granted to a group; all users who are members of a group get the permissions assigned to that group.
<p CLASS="Textttext">The easiest way to administrate a secure workgroup is to create new groups and assign permissions to the groups, rather than to individual users. Then you can change individual users' permissions by adding or removing them from groups. In a simple situation, you may want to use only the default groups to define permissions: assigning administrators to the Admins group and all other users to the Users group. If you do this, keep in mind that because the Users group is identical across all installations of Microsoft Access, any permissions you assign to the Users group will be available to all users of Microsoft Access. For a higher level of security, revoke all permissions for the Users group, create your own groups, and assign permissions to them.
<p CLASS="Textttext">When a user tries to perform an operation on an object, that user's security level is determined by the least restrictive of the permissions explicitly granted to that user and the permissions implicitly granted to the groups to which that user belongs. For example, if User1 has no explicit permissions on the Orders table but belongs to the Clerks group, which has Read Data permission on the Orders table, User1 will be able to read the data in the table. If User1 is removed from the Clerks group and doesn't belong to another group with permissions on the Orders table, User1 will be denied any access to the Orders table.
<p CLASS="Textttext">Permissions can be changed on a object contained in a database by:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspMembers of the Admins group of the workgroup information file in use when the database was created.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe owner of the object.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspAny user who has Administer permission on the object.</p>
<p CLASS="Textttext">Permissions for a database itself can be changed only by the owner of the database or by members of the Admins group.
<p CLASS="Textttext">Even though users may not currently be able to perform an action, they may be able to grant themselves permissions to perform the action. This is true if the user is a member of the Admins group of the workgroup information file in use when the database was created, or if the user is the owner of an object.</p>
<a NAME="6PermissionsforNewObjects"></a>
<p CLASS="heading6OrgHeading4h4">Permissions for New Objects</p>
<p CLASS="Textttext">You can set the permissions that users and groups receive by default for all new objects in a database. For example, you can prevent the Users group from getting permissions for new tables. This reduces your administrative burden, because you don't need to keep checking to make sure that new objects are properly secured.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>You can prevent users from creating new tables and queries by using Visual Basic code to remove permissions on the <span CLASS="ElementNameeln">Container</span> object, but you can't prevent users from creating new forms, reports, macros, or modules.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also</span>&nbsp;&nbsp;&amp;nbspFor information on how to assign default permissions for new objects, search the Help index for &quot;permissions, assigning and removing.&quot; For more information on the types of permissions you can assign, search the Help index for &quot;setting permissions.&quot;</p>
<a NAME="5Ownership"></a>
<p CLASS="heading5OrgHeading3h3">Ownership</p>
<p CLASS="Textttext">The user who creates an object is the owner of that object. The owner of an object can always grant permissions on that object, even if a member of the Admins group has revoked his or her explicit permissions on that object. One way to change the ownership of an object is to use the <span CLASS="ElementNameeln">Change Owner</span> tab on the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box (<span CLASS="ElementNameeln">Tools</span> menu, <span CLASS="ElementNameeln">Security</span> submenu). In addition to being able to transfer ownership to another user, the <span CLASS="ElementNameeln">Change Owner</span> tab is the only way to transfer ownership to a group. A group can own any kind of object except the database itself.
<p CLASS="Textttext">Another way to transfer ownership to a user is to log on as that user and re-create the object. To re-create an object, you don't have to start from scratch. You can make a copy of the object, or import it or export it to another database. To re-create an object, you must have Read Design permission for the object and, if the object is a table or query, you must also have Read Data permission.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>These procedures don't change the ownership of queries whose <span CLASS="ElementNameeln">RunPermissions</span> property is set to Owner's. You can change ownership of a query only if you own the query, or if its <span CLASS="ElementNameeln">RunPermissions</span> property is set to User's. For more information on the <span CLASS="ElementNameeln">RunPermissions</span> property, see <a HREF="#4UsingtheRunPermissionsPropertywithUserLevelSecurity" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Using the RunPermissions Property with User-Level Security&quot;</a> later in this chapter.</p>
<p CLASS="Textttext">The user who creates a database is the database's owner. The database owner can always open a database and create new objects in it. The database owner can also grant or revoke the permission to open a database. A database owner's rights can't be revoked by using the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box. Before you establish user-level security, the default Admin user is the owner of the database.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>If you don't transfer database ownership to a secure user account, any user of Microsoft Access or Visual Basic can open your database. You can't change the owner of a database by using the <span CLASS="ElementNameeln">Change Owner</span> tab on the <span CLASS="ElementNameeln">User And Group Permissions </span>dialog box. The only way to transfer the ownership of all of the objects and the database itself is to log on as the user you want to own the database, create a new blank database, and then import all of the objects. When you run the User-Level Security Wizard to secure your database, it uses this method to transfer ownership of the database and all of its objects.</p>
<a NAME="4EstablishingSecuritywiththeUserLevelSecurityWizard"></a>
<p CLASS="heading4OrgHeading2h2">Establishing Security with the User-Level Security Wizard</p>
<p CLASS="Textttext">Once you understand how the different pieces of the Microsoft Access user-level security model fit together, you can proceed with the steps to secure your database. While you can perform individual steps yourself, the User-Level Security Wizard is the easiest and most reliable way to secure your database.
<p CLASS="Textttext">To establish user-level security with the User-Level Security Wizard, you specify the object types that you want secured and the User-Level Security Wizard revokes permissions on those objects for all users and groups except the user that is currently logged on. The User-Level Security Wizard creates a new, secured copy of your database, and leaves the original copy unmodified. The User-Level Security Wizard also re-creates linked tables and table relationships in the new database. After you run the User-Level Security Wizard, you can create new users and groups and assign permissions to control how the objects in your application are used.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To establish security with the User-Level Security Wizard</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspIf you don't have a secure workgroup information file, create one with the Workgroup Administrator. Write down the exact, case-sensitive values you type in the <span CLASS="ElementNameeln">Name</span>, <span CLASS="ElementNameeln">Organization</span>, and <span CLASS="ElementNameeln">Workgroup ID</span> boxes and store them in a safe place. You'll need these values if you ever need to re-create your workgroup information file.</p>
<p CLASS="ListText1lt1">If you do have a secure workgroup information file, use the Workgroup Administrator to make sure that it is in use before proceeding. You must be a member of the Admins group of this file to be able to continue. Do this before you start Microsoft Access.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspStart Microsoft Access. On the <span CLASS="ElementNameeln">Tools</span> menu, point to <span CLASS="ElementNameeln">Security</span>, and then click <span CLASS="ElementNameeln">User And Group Accounts</span>.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspIn the <span CLASS="ElementNameeln">User And Group Accounts</span> dialog box, create a new user to be the owner and administrator of the database, and then add that user to the Admins group.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspIn the <span CLASS="ElementNameeln">Name</span> box on the <span CLASS="ElementNameeln">Users</span> tab, select the Admin user, and then click the <span CLASS="ElementNameeln">Change Logon Password</span> tab and assign a password to the Admin user. This causes the <span CLASS="ElementNameeln">Logon</span> dialog box to appear the next time you start Microsoft Access.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">5</span>&nbsp;&nbsp;&amp;nbspClick the <span CLASS="ElementNameeln">Users</span> tab, and then remove the Admin user from the Admins group.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">6</span>&nbsp;&nbsp;&amp;nbspExit Microsoft Access and restart it, logging on as the administrator user that you created in step 3.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">7</span>&nbsp;&nbsp;&amp;nbspOpen the database you want to secure.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">8</span>&nbsp;&nbsp;&amp;nbspOn the <span CLASS="ElementNameeln">Tools</span> menu, point to <span CLASS="ElementNameeln">Security</span>, and then click <span CLASS="ElementNameeln">User-Level Security Wizard</span>.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">9</span>&nbsp;&nbsp;&amp;nbspSelect the check boxes for the object types you want to secure, and then click <span CLASS="ElementNameeln">OK</span>.</p>
<p CLASS="ListText1lt1">The User-Level Security Wizard creates a new database, exports copies of all of the objects from the original database, secures the object types you selected by revoking all permissions of the Users group for those objects in the new database, and then encrypts the new database. The original database isn't changed in any way.</p>
<p CLASS="ListText1lt1">If you chose to secure all object types in the database, the User-Level Security Wizard removes the Users group's Open/Run permission for the database itself. This means that only members of the Admins group of the workgroup information file in use in step 1 can open the new secured database. All other users of Microsoft Access and Visual Basic can't open the database or access the secured objects within it.
<p CLASS="ListText1lt1">If you chose to secure only some object types in the database, the User-Level Security Wizard doesn't remove the Users group's Open/Run permission for the database itself. In this case, all users of Microsoft Access and Visual Basic can open the new secured database and access unsecured objects, but they can't access the secured objects within it.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">10</span>&nbsp;&amp;nbspCreate your own users and groups. Assign appropriate permissions to the group accounts, and then add individual users to the appropriate groups. Typical permissions may include Read Data and Update Data permissions for tables and queries, and Open/Run permission for forms and reports.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For information on creating users and groups, see <a HREF="#5UsersandGroups" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Users and Groups&quot;</a> earlier in this chapter. For information on how to assign permissions and a list of permissions you can assign, search the Help index for &quot;setting permissions.&quot;
</span>
<p CLASS="ListText1lt1"></p>
<p CLASS="Textttext">The new database created in step 9 is now secure. The user that you logged on as in step 6 is now the owner of all objects as well as the database itself. The only people who can use the objects in your application are those you gave permissions to in step 10, and members of the Admins group of the workgroup information file you created or specified in step 1.</p>
<a NAME="4SecuringaFrontendBackendApplication"></a>
<p CLASS="heading4OrgHeading2h2">Securing a Front-end/Back-end Application</p>
<p CLASS="Textttext">There are some additional factors to take into account when establishing user-level security for an application that has been split into a back-end database that contains only tables and a front-end database that contains the remaining objects and links to the tables in the back-end database. You may not know the name of the specific network location for the back-end database in advance, or you may want to allow a database administrator to move the back-end database. In either situation, you should make sure that users will be able to relink the tables in the back-end database.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To establish user-level security for a front-end/back-end application</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspFor both databases, follow the steps for establishing security with the User-Level Security Wizard.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspAssign permissions to the appropriate groups to read, update, insert, or delete data in the back-end database. To do so, you can either assign permissions directly to the tables in the back-end database, or you can remove all permissions to those tables and create queries in the front-end database that use the tables in the back-end database that have the <span CLASS="ElementNameeln">RunPermissions</span> property set to Owner's.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also</span>&nbsp;&nbsp;&nbsp;<span CLASS="Xref">For more information on the <span CLASS="ElementNameeln">RunPermissions</span> property, see <a HREF="#4UsingtheRunPermissionsPropertywithUserLevelSecurity" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Using the RunPermissions Property with User-Level Security&quot;</a> later in this chapter.</span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspAssign Open/Run permission for the back-end database. This is required even if you are using queries with the <span CLASS="ElementNameeln">RunPermissions</span> property set to Owner's.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspIn the front-end database, grant users Modify Design permission for the linked tables. Granting users Modify Design permission on linked tables in the front-end database doesn't grant them the same rights to the tables in the back-end database.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">5</span>&nbsp;&nbsp;&amp;nbspBy default, after running the User-Level Security Wizard, users have permission to create new tables and queries in the front-end database. If Database Access Objects (DAO) code has been used to remove this permission, you must use DAO code and the <span CLASS="ElementNameeln">dbSecCreate</span> constant to reassign this permission.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For more information on using DAO code to assign permissions, see <a HREF="#5AssigningPermissionsforObjects" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Assigning Permissions for Objects&quot;</a> later in this chapter.</span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">6</span>&nbsp;&nbsp;&amp;nbspWhen the users first install your application, have them run the Linked Table Manager from the front-end database to refresh the links to the tables in the back-end database in its new location.</p>
<p CLASS="TipIcontpi"><span CLASS="TipHeadingtph"></span>
<p CLASS="ListTipText1ltpt"><span CLASS="TipHeadingtph">Tip&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">You can also write code that prompts users during startup to refresh table links. For sample code that does this, see the RelinkTables and RefreshLinks functions in the RefreshTableLinks module of the Orders sample application.
</span>
<p CLASS="Textttext">Because users have Modify Design permission for the linked tables in the front-end database, they can reset the link to the back-end tables if the location of the back-end database changes. They won't be able to make any modifications to the design of the actual tables in the back-end database.</p>
<a NAME="4SecuringaDatabaseWithoutRequiringUserstoLogOn"></a>
<p CLASS="heading4OrgHeading2h2">Securing a Database Without Requiring Users to Log On</p>
<p CLASS="Textttext">If you want to secure some objects in your database such as your modules and the design of your objects, but you don't care about establishing different levels of access for different groups of users, you may want to consider securing your application without requiring your users to log on.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To establish user-level security without requiring users to log on</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspFollow the steps to secure your application by using the User-Level Security Wizard.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspWhile logged on as a member of the Admins group, assign permissions to the Admin user account for objects that you want to be available to all users. Typical permissions may include Read Data and Update Data permissions for tables and queries, and Open/Run permission for forms and reports. If you have secured your application properly, the Admin user should no longer be a member of the Admins group.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspClear the password for the Admin user.</p>
<p CLASS="Textttext">Users can now open your application without logging on. When users start Microsoft Access without logging on, Microsoft Access automatically logs them on using the Admin user account. As a result, they have only the permissions assigned in step 2. This works for any workgroup because the Admin user account is the same in every workgroup information file. Only members of the Admins group of the workgroup information file that was in use when you ran the User-Level Security Wizard in step 1 have full permissions on the objects in your database.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>You should not distribute copies of the workgroup information file in use when you secured the database using this procedure. If you need to allow a trusted user to administer your database, you should give the copy of the workgroup information file only to that user.</p>
<p CLASS="Textttext">To perform administrative functions, you must use the workgroup information file that was in use when you secured the database. There are two ways you can log on as a member of the Admins group of that workgroup information file:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspYou can temporarily define a password for the Admin user to reactivate the logon procedure, and log on as a member of the Admins group.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspYou can use the <span CLASS="ElementNameeln">/pwd</span> and <span CLASS="ElementNameeln">/user</span> command-line options to specify your password and user name when starting Microsoft Access. If you define a shortcut that uses the <span CLASS="ElementNameeln">/pwd</span> and <span CLASS="ElementNameeln">/user</span> command-line options to do this, you should physically secure the computer that the shortcut is located on to prevent unauthorized users from accessing this information.</p>
<a NAME="4RemovingUserLevelSecurity"></a>
<p CLASS="heading4OrgHeading2h2">Removing User-Level Security</p>
<p CLASS="Textttext">If you want to remove user-level security, perform the following procedure:</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To remove user-level security</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspMake a backup copy of the database you want to remove security from.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspStart Microsoft Access and log on as a workgroup administrator (a member of the Admins group).</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspOpen the database.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspOn the <span CLASS="ElementNameeln">Tools</span> menu, point to <span CLASS="ElementNameeln">Security</span>, then click<span CLASS="ElementNameeln"> User And Group Permissions</span>.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">5</span>&nbsp;&nbsp;&amp;nbspIn the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box, give the Users group full permissions on all objects in the database.</p>
<p CLASS="ListTipText1ltpt"><span CLASS="TipHeadingtph">Tip&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">You can select all of the objects in the <span CLASS="ElementNameeln">Object Name</span> box at once by clicking the first item in the list, holding down SHIFT, and then clicking the last item in the list.</span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">6</span>&nbsp;&nbsp;&amp;nbspExit and restart Microsoft Access, and then log on as the default Admin user.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">7</span>&nbsp;&nbsp;&amp;nbspCreate a new blank database and leave it open.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">8</span>&nbsp;&nbsp;&amp;nbspImport all the objects from the original database into the new database.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">9</span>&nbsp;&nbsp;&amp;nbspIf users will be using the current workgroup information file when opening the database, you need to clear the password for the Admin user to turn off the <span CLASS="ElementNameeln">Logon</span> dialog box for the current workgroup. This is not necessary if users will be using the default workgroup information file created when installing Microsoft Access.</p>
<p CLASS="Textttext">The new database is now completely unsecured. Anyone who can open the new database has full permissions on all its objects. This works for any workgroup because the Admin user account and Users group account are the same in every workgroup information file, and all users, including the Admin user, are members of the Users group. The workgroup information file in use when the new database was created in step 7 defines the Admins group for the new database.</p>
<a NAME="4UsingtheRunPermissionsPropertywithUserLevelSecurity"></a>
<p CLASS="heading4OrgHeading2h2">Using the RunPermissions Property with User-Level Security</p>
<p CLASS="Textttext">For Microsoft Access to display a table or query, it needs to read the design of that table or query. For example, it needs to read field names and other field properties, such as the <span CLASS="ElementNameeln">Format</span> and <span CLASS="ElementNameeln">InputMask </span>properties. As a result, for a user to read and display the data in a table or query, that user must also have permissions to read the design of the table or query. (This is why selecting the <span CLASS="ElementNameeln">Read Data</span> permission check box in the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box automatically selects the <span CLASS="ElementNameeln">Read Design</span> check box as well.) If you don't want your users to see the design of your table or query, you can use the <span CLASS="ElementNameeln">RunPermissions</span> property of queries to restrict their access to this information.
<p CLASS="Textttext">The <span CLASS="ElementNameeln">RunPermissions</span> property determines whether Microsoft Access uses the query user's permissions or the query owner's permissions when checking the user-level security permissions for each of the underlying tables in a query. If the<span CLASS="ElementNameeln"> RunPermissions</span> property is set to User's, then the users of a query have only their own permissions to view data in underlying tables. However, it is possible to override existing user permissions. If the owner of a query sets the <span CLASS="ElementNameeln">RunPermissions</span> property to Owner's, anyone who uses that query will have the same level of permissions to view data in the underlying tables as the query's owner.
<p CLASS="Textttext">The <span CLASS="ElementNameeln">RunPermissions</span> property allows you to create queries to display data to users who don't have permission to access the underlying tables. Using this feature, you can build different views of your data that provide record-level and field-level security for a table. For example, suppose you have a secure database with an Employees table and a Salary table. Using the <span CLASS="ElementNameeln">RunPermissions</span> property, you can build several views of the two tables: one that allows a user or group to view, but not update the Salary field; a second that allows a different user or group to view and update the Salary field; and a third that allows another user or group to view the Salary field only if its value is less than a certain amount.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To prevent users from viewing the design of underlying tables or queries</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspFor the users or groups that you want to restrict, remove all permissions to the underlying tables or queries whose design you want to secure.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspBuild a new query that includes all the fields you want to include from those tables or queries. You can exclude access to a field by omitting that field. You can also limit access to a certain range of values by defining criteria for your query.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspMake sure you or a secure group owns the new query.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspIn the query property sheet, set the <span CLASS="ElementNameeln">RunPermissions</span> property of the new query to Owner's. </p>
<p CLASS="ListNoteText1lnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">You can also set the <span CLASS="ElementNameeln">RunPermissions</span> property in SQL view of the Query window by using the WITH OWNERACCESS OPTION declaration in the SQL statement.</span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">5</span>&nbsp;&nbsp;&amp;nbspGrant appropriate data permissions for the new query to the users and groups who you want to be able to update data, but not view the design of the table or query. This would typically be Read Design, Read Data, Update Data, Delete Data, and Insert Data permissions, but you should specify only the permissions you want to allow.</p>
<p CLASS="TipTexttpt"><span CLASS="TipHeadingtph">Tip&nbsp;&nbsp;&nbsp;</span>You can base forms and reports on the new query.</p>
<p CLASS="Textttext">Users can update data in the underlying tables or queries by using the new query or forms based on it. However, they won't be able to view the design of those tables or queries. If they try to view the design of the new query, they receive a message that they don't have permissions to view the source tables or queries.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>By default, the user who creates a query is its owner, and only the owner of a query can save changes to it if the <span CLASS="ElementNameeln">RunPermissions</span> property is set to Owner's. Even members of the Admins group or users with Administer permission are prevented from saving changes to a query created by another user if the <span CLASS="ElementNameeln">RunPermissions</span> property is set to Owner's. However, anyone with Modify Design permission for the query can set the <span CLASS="ElementNameeln">RunPermissions</span> property to User's and then successfully save changes to the query.
<p CLASS="ImportantTextit">Because the creator of a query owns it by default, having the <span CLASS="ElementNameeln">RunPermissions</span> property set to Owner's can create problems if you need to allow more than one user to work with the design of a query. To address this situation, the ownership of the query can be transferred to a group. To do this, create a group, change the owner of the query to this group on the <span CLASS="ElementNameeln">Change Owner</span> tab of the <span CLASS="ElementNameeln">User And Group Permissions</span> dialog box, and then add the users who need to modify the query to the new group. Any member of the new group will be able to edit the query and save changes.</p>
<a NAME="4UsingDataAccessObjectstoEstablishUserLevelSecurity"></a>
<p CLASS="heading4OrgHeading2h2">Using Data Access Objects to Establish User-Level Security</p>
<p CLASS="Textttext">As an alternative to using the Microsoft Access user interface to establish user-level security for your application, you can establish security by using Visual Basic code to manipulate the Data Access Objects (DAO) that control security.
<p CLASS="Textttext">For user-level security purposes, all Microsoft Access objects<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">tables, queries, forms, reports, macros, and modules<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">are considered documents, and are manipulated through the <span CLASS="ElementNameeln">Document</span> object and the <span CLASS="ElementNameeln">Documents</span> collection. There are <span CLASS="ElementNameeln">User</span> and <span CLASS="ElementNameeln">Group</span> objects and <span CLASS="ElementNameeln">Users</span> and <span CLASS="ElementNameeln">Groups</span> collections. By manipulating the <span CLASS="ElementNameeln">Users</span> and <span CLASS="ElementNameeln">Groups</span> collections, you can manage which users belong to which groups. Permissions are properties of <span CLASS="ElementNameeln">Document</span> objects that are assigned to specific <span CLASS="ElementNameeln">User</span> and <span CLASS="ElementNameeln">Group</span> objects.
<p CLASS="Textttext">Using DAO objects, properties, and methods, you can:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspCreate user and group accounts.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspChange or clear passwords.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspChange ownership of objects.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspAssign or remove permissions for objects.</p>
<p CLASS="Textttext">In addition, you can use DAO to perform some operations that the user interface doesn't support. For example, you can write code to prevent users from creating a new database by using the security constant <span CLASS="ElementNameeln">dbSecDBCreate</span>. Or you can prevent users from creating new tables or queries within a database by revoking permissions on the Tables <span CLASS="ElementNameeln">Container</span> object with the <span CLASS="ElementNameeln">dbSecCreate</span> constant.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on how to prevent users from creating a new database, see <a HREF="#5PreventingUsersfromCreatingNewDatabases" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Preventing Users from Creating New Databases&quot;</a> later in this chapter. For more information on security constants, search the Help index for &quot;data access constants.&quot;</p>
<p CLASS="Textttext">Also, you can write code in an application to allow users to perform actions that they don't usually have permission to perform. You do this by opening new <span CLASS="ElementNameeln">Workspace</span> objects under the name and password of a user account (often a member of the Admins group of the workgroup information file in use when the database was created) who has greater permissions than the user currently logged on.
<p CLASS="Textttext">For example, you could add the following code to a command button on a form in a secured copy of the Northwind sample database. When a user clicks the button, Microsoft Access creates a new <span CLASS="ElementNameeln">Workspace</span> object using the name and password of a member of the Admins group, opens another copy of the database in that workspace, temporarily gives the current user full permissions to the form, changes the <span CLASS="ElementNameeln">BackColor</span> property of the form to Red, and then restores the user's normal permissions.</p>
<p CLASS="CodeTextct">Private Sub ChangeBackcolor_Click()<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ChangeBackcolor_Err<br>&nbsp;&nbsp;&amp;nbspDim wsNew As Workspace<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspDim ctr As Container<br>&nbsp;&nbsp;&amp;nbspDim doc As Document<br>&nbsp;&nbsp;&amp;nbspDim lngCurrentPermissions As Long<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;' Turn on hourglass icon and suppress screen updates.<br>&nbsp;&nbsp;&amp;nbspDoCmd.Hourglass True<br>&nbsp;&nbsp;&amp;nbspDoCmd.Echo False<br>&nbsp;&nbsp;&nbsp;' Create a new Workspace object using SteveB's name and password<br>&nbsp;&nbsp;&nbsp;' and open database in new workspace.<br>&nbsp;&nbsp;&amp;nbspSet wsNew = DBEngine.CreateWorkspace(&quot;NewWorkspace&quot;, &quot;SteveB&quot;, &quot;32msaig54&quot;)<br>&nbsp;&nbsp;&amp;nbspSet dbs = wsNew.OpenDatabase(CurrentDb.Name)<br>&nbsp;&nbsp;&nbsp;' Set Container object to Forms, and then set Document object to the current form.<br>&nbsp;&nbsp;&amp;nbspSet ctr = dbs.Containers!Forms<br>&nbsp;&nbsp;&amp;nbspSet doc = ctr.Documents(Me.Name)<br>&nbsp;&nbsp;&nbsp;' Specify the current user of the form, store that user's current permissions,<br>&nbsp;&nbsp;&nbsp;' and then give the user full rights.<br>&nbsp;&nbsp;&amp;nbspdoc.UserName = CurrentUser<br>&nbsp;&nbsp;&amp;nbsplngCurrentPermissions = doc.Permissions<br>&nbsp;&nbsp;&amp;nbspdoc.Permissions = dbSecFullAccess<br>&nbsp;&nbsp;&nbsp;' Switch to Design view, change the Detail section backcolor to red, and save form.<br>&nbsp;&nbsp;&amp;nbspDoCmd.DoMenuItem 0, 2, 0, , acMenuVer80<br>&nbsp;&nbsp;&amp;nbspCodeContextObject.Section(0).BackColor = 255<br>&nbsp;&nbsp;&amp;nbspDoCmd.Save acForm, CodeContextObject.Name<br>&nbsp;&nbsp;&nbsp;' Switch back to Form view, reset the user's permissions to original permissions,<br>&nbsp;&nbsp;&nbsp;' and close the database and new workspace.<br>&nbsp;&nbsp;&amp;nbspDoCmd.DoMenuItem 3, 2, 1, , acMenuVer80 <br>&nbsp;&nbsp;&amp;nbspdoc.Permissions = lngCurrentPermissions<br>&nbsp;&nbsp;&amp;nbspdbs.Close<br>&nbsp;&nbsp;&amp;nbspwsNew.Close<br>ChangeBackcolor_ErrCont:<br>&nbsp;&nbsp;&amp;nbspDoCmd.Hourglass False<br>&nbsp;&nbsp;&amp;nbspDoCmd.Echo True<br>&nbsp;&nbsp;&amp;nbspExit Sub<br>&nbsp;&nbsp;&nbsp;<br>ChangeBackcolor_Err:<br>&nbsp;&nbsp;&amp;nbspMsgBox Err.Description<br>&nbsp;&nbsp;&amp;nbspResume ChangeBackcolor_ErrCont<br>End Sub</p>
<p CLASS="Textttext">If you do this, make sure that the form in which you place this code is itself properly secured, because the user name and password will be visible to anyone who has Read Design permission on the form.
<p CLASS="Textttext">The following sections provide examples of manipulating user-level security by using Visual Basic code to perform common operations.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on how to use Data Access Objects (DAO) code to work with user-level security, see the <span CLASS="NewTermntrm">Microsoft Jet Database Engine Programmer's Guide</span>.</p>
<a NAME="5CreatingUserandGroupAccounts"></a>
<p CLASS="heading5OrgHeading3h3">Creating User and Group Accounts</p>
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">User</span> and <span CLASS="ElementNameeln">Group</span> objects to create and manage user and group accounts. A <span CLASS="ElementNameeln">User </span>is an object that represents an individual who can log on to the database, while a <span CLASS="ElementNameeln">Group </span>is a set of <span CLASS="ElementNameeln">User</span> objects.
<p CLASS="Textttext">You add users to a group by appending the <span CLASS="ElementNameeln">User </span>object to the <span CLASS="ElementNameeln">Users</span> collection of an existing group. Alternatively, you can append a <span CLASS="ElementNameeln">Group </span>object to the <span CLASS="ElementNameeln">Groups</span> collection in a <span CLASS="ElementNameeln">User </span>object to give that user the global permissions of that group.
<p CLASS="Textttext">Permissions set for a group are automatically given to all users who belong to that group, while permissions given to a user apply only to that user account. A user's security level is determined by the least restrictive of the permissions granted to that user or any group to which that user belongs. For example, if a user is given a higher permission level for a particular database object than is granted to the group of which the user is a member, the user permissions override the group permissions.
<p CLASS="Textttext">The following procedure creates new group and user accounts, and adds a new user to an existing group account:</p>
<p CLASS="CodeTextct">Sub VPPromotion()<br>&nbsp;&nbsp;&amp;nbspDim ws As Workspace<br>&nbsp;&nbsp;&amp;nbspDim grpVp As Group, grpManager As Group<br>&nbsp;&nbsp;&amp;nbspDim usr As User<br>&nbsp;&nbsp;&nbsp;' Create a Vice Presidents group account.<br>&nbsp;&nbsp;&amp;nbspSet ws = DBEngine.Workspaces(0)<br>&nbsp;&nbsp;&amp;nbspSet grpVp = ws.CreateGroup(&quot;VicePres&quot;, &quot;mmbhto101193&quot;)<br>&nbsp;&nbsp;&amp;nbspws.Groups.Append grpVp<br>&nbsp;&nbsp;&amp;nbspws.Groups.Refresh<br>&nbsp;&nbsp;&nbsp;' Create an instance of an existing user account, add the user to<br>&nbsp;&nbsp;&nbsp;' the new group account, then remove the user from an existing<br>&nbsp;&nbsp;&nbsp;' group account.<br>&nbsp;&nbsp;&amp;nbspSet usr = grpVp.CreateUser(&quot;Andrew Fuller&quot;)<br>&nbsp;&nbsp;&amp;nbspgrpVp.Users.Append usr<br>&nbsp;&nbsp;&amp;nbspgprVp.Users.Refresh<br>&nbsp;&nbsp;&amp;nbspSet grpManager = ws.Groups(&quot;Managers&quot;)<br>&nbsp;&nbsp;&amp;nbspgrpManager.Users.Delete &quot;Andrew Fuller&quot;<br>&nbsp;&nbsp;&amp;nbspgrpManager.Users.Refresh<br>&nbsp;&nbsp;&nbsp;' Create a new user account for a new manager.<br>&nbsp;&nbsp;&amp;nbspSet usr = grpManager.CreateUser(&quot;Mary McCreary&quot;, &quot;mbw1011&quot;, &quot;Pwd&quot;)<br>&nbsp;&nbsp;&amp;nbspws.Users.Append usr<br>&nbsp;&nbsp;&amp;nbspws.Users.Refresh<br>&nbsp;&nbsp;&nbsp;' Add the user to the Managers group. Because you've already added the<br>&nbsp;&nbsp;&nbsp;' user to the Users group, you must create a new instance of the<br>&nbsp;&nbsp;&nbsp;' user account before adding it to the Managers' Users group.<br>&nbsp;&nbsp;&amp;nbspSet usr = grpManager.CreateUser(&quot;Mary McCreary&quot;)<br>&nbsp;&nbsp;&amp;nbspgrpManager.Users.Append usr<br>&nbsp;&nbsp;&amp;nbspgrpManager.Users.Refresh<br>End Sub</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on users and groups, see <a HREF="#5UsersandGroups" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Users and Groups&quot;</a> earlier in this chapter.</p>
<a NAME="5AddingandChangingPasswords"></a>
<p CLASS="heading5OrgHeading3h3">Adding and Changing Passwords</p>
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">NewPassword</span> method of the <span CLASS="ElementNameeln">User</span> object to add, change, or clear the password of an existing user account. You can also set a password for a user account when you create it by using the <span CLASS="ElementNameeln">CreateUser</span> method<span CLASS="CrossRefHeadingcrh"> </span>of the<span CLASS="ElementNameeln"> User</span> object, or you can do so by setting the <span CLASS="ElementNameeln">Password</span> property of the<span CLASS="ElementNameeln"> User</span> object before you append it to the <span CLASS="ElementNameeln">Users</span> collection.
<p CLASS="Textttext">For example, the following procedure adds passwords to the Admin, OrdersAdmin and OrdersOwner user accounts, and creates two new user accounts with passwords:</p>
<p CLASS="CodeTextct">Sub ChangePasswords()<br>&nbsp;&nbsp;&amp;nbspDim ws As Workspace, usr As User<br>&nbsp;&nbsp;&nbsp;' Add passwords to the Admin, OrdersAdmin, and OrdersOwner<br>&nbsp;&nbsp;&nbsp;' user accounts.<br>&nbsp;&nbsp;&amp;nbspSet ws = DBEngine.Workspaces(0)<br>&nbsp;&nbsp;&amp;nbspws.Users(&quot;Admin&quot;).NewPassword &quot;&quot;, &quot;AdminPwd&quot;<br>&nbsp;&nbsp;&amp;nbspws.Users(&quot;OrdersAdmin&quot;).NewPassword &quot;&quot;, &quot;OrdAdminPwd&quot;<br>&nbsp;&nbsp;&amp;nbspws.Users(&quot;OrdersOwner&quot;).NewPassword &quot;&quot;, &quot;OrdOwnerPwd&quot;<br>&nbsp;&nbsp;&nbsp;' Create a user account, specifying a PID and a password with<br>&nbsp;&nbsp;&nbsp;' the CreateUser method.<br>&nbsp;&nbsp;&amp;nbspSet usr = ws.CreateUser(&quot;Tim Smith&quot;, &quot;ilmj2d&quot;, &quot;MyPwd&quot;)<br>&nbsp;&nbsp;&amp;nbspws.Users.Append usr<br>&nbsp;&nbsp;&nbsp;' Create a user account, specifying a password with the<br>&nbsp;&nbsp;&nbsp;' Password property.<br>&nbsp;&nbsp;&amp;nbspSet usr = ws.CreateUser(&quot;Robert King&quot;)<br>&nbsp;&nbsp;&amp;nbspusr.PID = &quot;tdi3tcm&quot;<br>&nbsp;&nbsp;&amp;nbspusr.Password = &quot;NewUserPwd&quot;<br>&nbsp;&nbsp;&amp;nbspws.Users.Append usr<br>End Sub</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on passwords, see <a HREF="../chapters/ba14_1.htm#4SettingaDatabasePassword" OnClick="SyncURL(&quot;chapters/ba14_1.htm&quot;)">&quot;Setting a Database Password&quot;</a> earlier in this chapter.</p>
<a NAME="5ChangingOwnershipofObjects"></a>
<p CLASS="heading5OrgHeading3h3">Changing Ownership of Objects</p>
<p CLASS="Textttext">Ownership entitles users to certain irrevocable rights to the database and objects that they create, including the ability to open the database. Owners can grant permissions on an object both to themselves and to other users or groups.
<p CLASS="Textttext">If you have the appropriate permissions, you can use the <span CLASS="ElementNameeln">Owner</span> property of a <span CLASS="ElementNameeln">Document</span> object to change the owner of an object. For example, the following procedure makes the OrdersOwner user account the owner of all objects in the current database. Note that the new owner for an object can also be a group account.</p>
<p CLASS="CodeTextct">Sub ChangeOwnership()<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo Err_ChangeOwnership<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, ctr As Container, doc As Document<br>&nbsp;&nbsp;&amp;nbspDim intDocCount As Integer, intCtrCount As Integer<br>&nbsp;&nbsp;&amp;nbspConst conErrNoPermissions = 3033<br>&nbsp;&nbsp;&nbsp;' Assign the current database to the database variable.<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&nbsp;' Loop through all the objects in the database,<br>&nbsp;&nbsp;&nbsp;' changing their ownership to the OrdersOwner account.<br>&nbsp;&nbsp;&amp;nbspFor intDocCount = 0 To dbs.Containers.Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspSet ctr = dbs.Containers(intDocCount)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspFor intCtrCount = 0 To ctr.Documents.Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspSet doc = ctr.Documents(intCtrCount)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspdoc.Owner = &quot;OrdersOwner&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspNext intCtrCount<br>&nbsp;&nbsp;&amp;nbspNext intDocCount<br>Bye_ChangeOwnership:<br>&nbsp;&nbsp;&amp;nbspExit Sub<br>Err_ChangeOwnership:<br>&nbsp;&nbsp;&amp;nbspIf Err = conErrNoPermissions Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume Next<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox Err.Description<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume Bye_ChangeOwnership<br>&nbsp;&nbsp;&amp;nbspEnd If<br>End Sub</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on ownership, see <a HREF="#5Ownership" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Ownership&quot;</a> earlier in this chapter.</p>
<a NAME="5AssigningPermissionsforObjects"></a>
<p CLASS="heading5OrgHeading3h3">Assigning Permissions for Objects</p>
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">UserName</span> and <span CLASS="ElementNameeln">Permissions</span> properties of a <span CLASS="ElementNameeln">Document</span> object to assign permissions for an object. For example, you can modify the preceding ChangeOwnership procedure so that it assigns full permissions to the Managers group account for all objects in the Orders sample application.</p>
<p CLASS="CodeTextct">Sub AssignPerms()<br>&nbsp;&nbsp;&nbsp;' Declare database and integer variables.<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, intDocCount As Integer, intCtrCount As Integer<br>&nbsp;&nbsp;&nbsp;' Assign the current database to the database variable.<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&nbsp;' Loop through all the document objects in the database,<br>&nbsp;&nbsp;&nbsp;' assigning full permissions to the Managers group account.<br>&nbsp;&nbsp;&amp;nbspFor intDocCount = 0 To dbs.Containers.Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspFor intCtrCount = 0 To dbs.Containers(intDocCount).Documents _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Count - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspdbs.Containers(intDocCount).Documents(intCtrCount) _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.UserName = &quot;Managers&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspdbs.Containers(intDocCount).Documents(intCtrCount) _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Permissions = dbSecFullAccess<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspNext intCtrCount<br>&nbsp;&nbsp;&amp;nbspNext intDocCount<br>End Sub</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on permissions, see <a HREF="#5Permissions" OnClick="SyncURL(&quot;chapters/ba14_2.htm&quot;)">&quot;Permissions&quot;</a> earlier in this chapter.</p>
<a NAME="5DeterminingIfaUserHasReadDataPermissionforaTable"></a>
<p CLASS="heading5OrgHeading3h3">Determining If a User Has Read Data Permission for a Table</p>
<p CLASS="Textttext">The<span CLASS="ElementNameeln"> AllPermissions</span> property returns the set of permissions the user inherits from each of the groups the user belongs to (the user's implicit permissions), in addition to the explicit permissions granted directly to the individual user account. A user's security level is always the least restrictive of that user's explicit and implicit permissions.
<p CLASS="Textttext">The following function uses the <span CLASS="ElementNameeln">AllPermissions</span> property and the <span CLASS="ElementNameeln">dbSecRetrieveData</span> constant to determine if the specified user has Read Data permission for a particular table.</p>
<p CLASS="CodeTextct">Function CheckAllReadPerms()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, docTemp As Document, strUser As String, strObject As String<br>&nbsp;&nbsp;&nbsp;' Assign the current database to the database variable.<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&nbsp;' Prompt for user name and table name and assign to string variables.<br>&nbsp;&nbsp;&amp;nbspstrUser = InputBox(&quot;Enter a user's account name.&quot;, &quot;Enter User&quot;)<br>&nbsp;&nbsp;&amp;nbspstrObject = InputBox(&quot;Enter a table to check for Read Data permission.&quot;, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Enter Table&quot;)<br>&nbsp;&nbsp;&nbsp;' Set document variable to the specified table and then specify the user<br>&nbsp;&nbsp;&nbsp;' of that table.<br>&nbsp;&nbsp;&amp;nbspSet docTemp = dbs.Containers!Tables.Documents(strObject)<br>&nbsp;&nbsp;&amp;nbspdocTemp.UserName = strUser<br>&nbsp;&nbsp;&nbsp;' Check to see if user has either implicit or explicit Read Data permission.<br>&nbsp;&nbsp;&amp;nbspIf (docTemp.AllPermissions And dbSecRetrieveData) &gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox strUser &amp; &quot; has implicit or explicit Read Data permission for &quot; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp; strObject &amp; &quot;.&quot;<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox strUser &amp; &quot; has no permissions for &quot; &amp; strObject &amp; &quot;.&quot;<br>&nbsp;&nbsp;&amp;nbspEnd If<br>End Function</p>
<p CLASS="Textttext">If you want to check only the explicit permissions granted to a user, you can use the <span CLASS="ElementNameeln">Permissions</span> property instead.
<p CLASS="Textttext">You can avoid having to worry about whether a user has less restrictive explicit permissions by using the User-Level Security Wizard to revoke permissions for all users and groups but the Admins group. Then create new groups and assign permissions only to groups and not to individual users. This way you can easily change permissions for a user by simply moving the user to a new group. You can also change permissions to an entire group in a single operation, which is much easier than changing them for each individual user.</p>
<a NAME="5PreventingUsersfromCreatingNewDatabases"></a>
<p CLASS="heading5OrgHeading3h3">Preventing Users from Creating New Databases</p>
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">Or</span> keyword to add permissions on top of the existing permissions for a user or a group, and you can use the <span CLASS="ElementNameeln">And Not</span> keyword to deny a user or a group account specific permissions. For example, when you use the <span CLASS="ElementNameeln">And Not</span> keyword with the security constant <span CLASS="ElementNameeln">dbSecDBCreate</span> for a user, you remove that user's permission to create new databases. The following procedure demonstrates how to use the <span CLASS="ElementNameeln">dbSecDBCreate</span> constant to remove the permission to create new databases from all users in the Users group:</p>
<p CLASS="CodeTextct">Sub Remove_DBCreate()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, ctr As Container, strSystemDatabase<br>&nbsp;&nbsp;&nbsp;' Retrieve path for your workgroup information file (system database).<br>&nbsp;&nbsp;&amp;nbspstrSystemDatabase = DBEngine.SystemDB<br>&nbsp;&nbsp;&amp;nbspSet dbs = DBEngine(0).OpenDatabase(strSystemDatabase)<br>&nbsp;&nbsp;&amp;nbspSet ctr = dbs.Containers!Databases<br>&nbsp;&nbsp;&amp;nbspctr.Username = &quot;Users&quot;<br>&nbsp;&nbsp;&amp;nbspctr.Permissions = ctr.Permissions And Not dbSecDbCreate<br>End Sub</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on security constants, search the Help index for &quot;security constants.&quot;</p>
<p><!--DocFooterStart-->
<p><span CLASS="copyright"><a HREF="cpyright.htm"> 1996 Microsoft Corporation. All rights reserved.</a></span>
<p><!--DocFooterEnd-->
<a HREF="ba14_3.htm" OnClick="SyncURL(&quot;chapters/ba14_3.htm&quot;)"><img SRC="..\images\nextpage.gif" ALT="Next Page" ALIGN="RIGHT" BORDER="0"></a><!--mstheme--></font></body></html>
