<%@LANGUAGE="JAVASCRIPT" CODEPAGE="1252"%><!--#include file="../../../Connections/Esdrm.asp" --><%  	if (Session("Login") != "jorgemadeira") {		Response.Write("Utilizador sem autorização - Acesso Negado !");		Response.Redirect("../centroInformatica.html");	}%><%// *** Edit Operations: declare variables// set the form action variablevar MM_editAction = Request.ServerVariables("SCRIPT_NAME");if (Request.QueryString) {  MM_editAction += "?" + Request.QueryString;}// boolean to abort record editvar MM_abortEdit = false;// query string to executevar MM_editQuery = "";%><%// *** Insert Record: set variablesif (String(Request("MM_insert")) == "form1") {  var MM_editConnection = MM_Esdrm_STRING;  var MM_editTable  = "dbo.TabUtilizadores";  var MM_editRedirectUrl = "";  var MM_fieldsStr = "titulo|value|nomeUser|value|tipoUtilizador|value|usernameNT|value|passwordNT|value|usernameMail|value|passwordMail|value|email|value|URLPagina|value|Extensao|value|Telefone|value|Cargos|value|Categoria|value|NomeCompleto|value|Morada|value|Localidade|value|CodPostal|value|LocPostal|value|GrauAcademico|value|Foto|value|TelefCasa|value|Telemovel|value|BI|value|Validade|value|NIF|value|DataNasc|value|IdComputador|value|Activo|value";  var MM_columnsStr = "titulo|none,none,NULL|nomeUser|',none,''|tipoUtilizador|',none,''|usernameNT|',none,''|passwordNT|',none,''|usernameMail|',none,''|passwordMail|',none,''|email|',none,''|URLPagina|',none,''|Extensao|none,none,NULL|Telefone|',none,''|Cargos|',none,''|Categoria|',none,''|NomeCompleto|',none,''|Morada|',none,''|Localidade|',none,''|CodPostal|',none,''|LocPostal|',none,''|GrauAcademico|',none,''|Foto|',none,''|TelefCasa|',none,''|Telemovel|',none,''|BI|',none,''|validade|',none,NULL|NIF|',none,''|DataNasc|',none,NULL|IdComputador|',none,''|Ativo|',none,'1'";  // create the MM_fields and MM_columns arrays  var MM_fields = MM_fieldsStr.split("|");  var MM_columns = MM_columnsStr.split("|");    // set the form values  for (var i=0; i+1 < MM_fields.length; i+=2) {    MM_fields[i+1] = String(Request.Form(MM_fields[i]));  }  // append the query string to the redirect URL  if (MM_editRedirectUrl && Request.QueryString && Request.QueryString.Count > 0) {    MM_editRedirectUrl += ((MM_editRedirectUrl.indexOf('?') == -1)?"?":"&") + Request.QueryString;  }}%><%// *** Insert Record: construct a sql insert statement and execute itif (String(Request("MM_insert")) != "undefined") {  // create the sql insert statement  var MM_tableValues = "", MM_dbValues = "";  for (var i=0; i+1 < MM_fields.length; i+=2) {    var formVal = MM_fields[i+1];    var MM_typesArray = MM_columns[i+1].split(",");    var delim =    (MM_typesArray[0] != "none") ? MM_typesArray[0] : "";    var altVal =   (MM_typesArray[1] != "none") ? MM_typesArray[1] : "";    var emptyVal = (MM_typesArray[2] != "none") ? MM_typesArray[2] : "";    if (formVal == "" || formVal == "undefined") {      formVal = emptyVal;    } else {      if (altVal != "") {        formVal = altVal;      } else if (delim == "'") { // escape quotes        formVal = "'" + formVal.replace(/'/g,"''") + "'";      } else {        formVal = delim + formVal + delim;      }    }    MM_tableValues += ((i != 0) ? "," : "") + MM_columns[i];    MM_dbValues += ((i != 0) ? "," : "") + formVal;  }  MM_editQuery = "insert into " + MM_editTable + " (" + MM_tableValues + ") values (" + MM_dbValues + ")";  if (!MM_abortEdit) {    // execute the insert    var MM_editCmd = Server.CreateObject('ADODB.Command');    MM_editCmd.ActiveConnection = MM_editConnection;    MM_editCmd.CommandText = MM_editQuery;    MM_editCmd.Execute();    MM_editCmd.ActiveConnection.Close();    if (MM_editRedirectUrl) {      Response.Redirect(MM_editRedirectUrl);    }  }}%><%var rstTipoUser = Server.CreateObject("ADODB.Recordset");rstTipoUser.ActiveConnection = MM_Esdrm_STRING;rstTipoUser.Source = "SELECT *  FROM dbo.tabTipoUtilizador ORDER BY TabTipoDesc ASC";rstTipoUser.CursorType = 0;rstTipoUser.CursorLocation = 2;rstTipoUser.LockType = 1;rstTipoUser.Open();var rstTipoUser_numRows = 0;%><%var rstTitulo = Server.CreateObject("ADODB.Recordset");rstTitulo.ActiveConnection = MM_Esdrm_STRING;rstTitulo.Source = "SELECT * FROM dbo.Titulo ORDER BY Descricao ASC";rstTitulo.CursorType = 0;rstTitulo.CursorLocation = 2;rstTitulo.LockType = 1;rstTitulo.Open();var rstTitulo_numRows = 0;%><html><head><title>Inserir Utilizador</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link href="../../../CSS/css.css" rel="stylesheet" type="text/css"><script language="JavaScript" type="text/JavaScript"><!--function MM_findObj(n, d) { //v4.01  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);  if(!x && d.getElementById) x=d.getElementById(n); return x;}function MM_validateForm() { //v4.0	var i,p,q,nm,test,num,min,max,errors='',args=MM_validateForm.arguments;  	for (i=0; i<(args.length-2); i+=3) 		{   		test=args[i+2]; 		val=MM_findObj(args[i]);    	if (val) 			{			nm=args[i+1]; 			if ((val=val.value)!="") 				{	      		if (test.indexOf('isEmail')!=-1) 					{ 	  				p=val.indexOf('@');        			if (p<1 || p==(val.length-1)) errors+='- '+nm+' - O E-Mail é Inválido.\n';      				} 				else if (test!='R') 					{        			if (isNaN(val)) errors+='- '+nm+' - É um Campo Numérico.\n';	        		if (test.indexOf('inRange') != -1) 						{ 						p=test.indexOf(':');          				min=test.substring(8,p); max=test.substring(p+1);           				if (val<min || max<val) errors+='- '+nm+' - O número deve estar entre '+min+' e '+max+'.\n';						}					}				} 			else if (test.charAt(0) == 'R') errors += '- '+nm+' - É um Campo Obrigatório.\n'; 			}		} 	if (errors) alert('Rectificar o(s) seguinte(s) erro(s):\n'+errors);	document.MM_returnValue = (errors == '');}function MM_callJS(jsStr) { //v2.0  return eval(jsStr)}function MM_goToURL() { //v3.0  var i, args=MM_goToURL.arguments; document.MM_returnValue = false;  for (i=0; i<(args.length-1); i+=2) eval(args[i]+".location='"+args[i+1]+"'");}//--></script></head><body background="../../../Fundos/exptextb.jpg"><div align="center"><strong><font size="5"><br>  Dados Pessoais dos Docentes</font></strong><strong><font size="5"> e Funcion&aacute;rios</font></strong><br></div><form method="POST" action="<%=MM_editAction%>" name="form1">  <table width="668" border="1" align="center" bgcolor="#CCCC99">    <tr valign="baseline">       <td align="right" nowrap><div align="center">Titulo:           <select name="titulo">            <% while (!rstTitulo.EOF) {%>            <option value="<%=(rstTitulo.Fields.Item("IdTitulo").Value)%>"><%=(rstTitulo.Fields.Item("Descricao").Value)%></option>            <%  rstTitulo.MoveNext();}if (rstTitulo.CursorType > 0) {  if (!rstTitulo.BOF) rstTitulo.MoveFirst();} else {  rstTitulo.Requery();}%>          </select>          &nbsp;&nbsp; Nome de User:           <input name="nomeUser" type="text" onBlur="MM_validateForm('nomeUser','Nome do Utilizador','R');return document.MM_returnValue" value="" size="20" maxlength="20">          &nbsp;&nbsp;Tipo de Utilizador:           <select name="tipoUtilizador" size="1" title="<%=(rstTipoUser.Fields.Item("TabTipoDesc").Value)%>">            <% while (!rstTipoUser.EOF) {%>            <option value="<%=(rstTipoUser.Fields.Item("IdUser").Value)%>"><%=(rstTipoUser.Fields.Item("TabTipoDesc").Value)%></option>            <%  rstTipoUser.MoveNext();}if (rstTipoUser.CursorType > 0) {  if (!rstTipoUser.BOF) rstTipoUser.MoveFirst();} else {  rstTipoUser.Requery();}%>          </select>        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Username do Windows:           <input name="usernameNT" type="text" onBlur="MM_validateForm('usernameNT','UserName do Windows','R');return document.MM_returnValue" value="" size="20" maxlength="20">          Password do Windows:           <input name="passwordNT" type="text" onBlur="MM_validateForm('passwordNT','Password do Windows','R');return document.MM_returnValue" value="" size="20" maxlength="20">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Username do Mail:           <input name="usernameMail" type="text" onBlur="MM_validateForm('usernameMail','UserName do eMail','R');return document.MM_returnValue" value="" size="20" maxlength="20">          Password do Mail:           <input name="passwordMail" type="text" value="" size="20" maxlength="20" onBlur="MM_validateForm('passwordMail','Password do eMail','R');return document.MM_returnValue">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Email:           <input name="email" type="text" onBlur="MM_validateForm('email','eMail','RisEmail');return document.MM_returnValue" value="" size="50" maxlength="50">          URL da sua Página:           <input name="URLPagina" type="text" value="" size="50" maxlength="50">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº da Extens&atilde;o de Telefone:           <input name="Extensao" type="text" value="" size="3" maxlength="3">          Nº do Telefone Directo:           <input name="Telefone" type="text" size="9" maxlength="9">          Cargo que Desempenha:           <input type="text" name="Cargos" value="" size="32">        </div></td>    </tr>    <tr valign="baseline">      <td align="right" nowrap><div align="center">Categoria Profissional:         <input type="text" name="Categoria" value="" size="50">      </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nome Completo:           <input name="NomeCompleto" type="text" value="" size="50" maxlength="50">          Morada:           <input name="Morada" type="text" value="" size="50" maxlength="50">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Localidade:           <input name="Localidade" type="text" value="" size="50" maxlength="50">          Código Postal:           <input name="CodPostal" type="text" value="" size="8" maxlength="8">          <input name="LocPostal" type="text" value="" size="50" maxlength="50">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Grau Académico:           <input type="text" name="GrauAcademico" value="" size="32">          Link da Foto:           <input type="text" name="Foto" value="" size="50">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº do Telefone de Casa:           <input name="TelefCasa" type="text" value="" size="9" maxlength="9">          Nº do Telemóvel:           <input name="Telemovel" type="text" value="" size="9" maxlength="9">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº do Bilhete de Identidade:           <input name="BI" type="text" value="" size="10" maxlength="10">          V&aacute;lido at&eacute;:           <input name="Validade" type="text" size="10" maxlength="10">          &nbsp;dd-mm-aaaa</div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº de Identificação Fiscal:           <input name="NIF" type="text" value="" size="9" maxlength="9">          Data de Nascimento:           <input name="DataNasc" type="text" size="10" maxlength="10">          &nbsp;dd-mm-aaaa</div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">N&ordm; do computador que lhe           foi atribu&iacute;do:           <input name="IdComputador" type="text" size="20" maxlength="20">        </div></td>    </tr>  </table>  <br>  <input type="hidden" name="MM_insert" value="form1">  <table width="66%" border="0" align="center">    <tr>       <td width="29%"><div align="center">           <input name="Gravar" type="submit" class="botao_actualizar" id="Gravar" onClick="MM_validateForm('nomeUser','Nome do Utilizador','R','usernameNT','UserName do Windows','R','passwordNT','Password do Windows','R','usernameMail','UserName do eMail','R','passwordMail','Password do eMail','R','email','eMail do utilizador','RisEmail');return document.MM_returnValue" value="Gravar Novo Registo">        </div></td>      <td width="16%"><div align="center">           <input name="Cancelar" type="reset" class="botao_actualizar" id="Cancelar" value="Cancelar">        </div></td>      <td width="23%"><div align="center">           <input name="Mostrar" type="button" class="botao_actualizar" id="Mostrar" onClick="MM_goToURL('parent','Mostrar.asp');return document.MM_returnValue" value="Mostrar Todos">        </div></td>      <td width="32%"><input name="Voltar" type="button" class="botao_actualizar" id="Voltar2" onClick="MM_callJS('top.history.back()')" value="Voltar &agrave; P&aacute;gina Anterior"></td>    </tr>  </table></form><p>&nbsp;</p></body></html><%rstTipoUser.Close();%><%rstTitulo.Close();%>