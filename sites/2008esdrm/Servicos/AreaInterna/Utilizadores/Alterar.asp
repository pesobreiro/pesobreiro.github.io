<%@LANGUAGE="JAVASCRIPT" CODEPAGE="1252"%><!--#include file="../../../Connections/Esdrm.asp" --><%  	if ((Session("Login") == "jorgemadeira") || (Session("Login") == "trindade"))	{		registo = Request.QueryString;	}	else	{		registo = Session("IdUser");	}%><%// *** Edit Operations: declare variables// set the form action variablevar MM_editAction = Request.ServerVariables("SCRIPT_NAME");if (Request.QueryString) {  MM_editAction += "?" + Request.QueryString;}// boolean to abort record editvar MM_abortEdit = false;// query string to executevar MM_editQuery = "";%><%// *** Update Record: set variablesif (String(Request("MM_update")) == "form1" &&    String(Request("MM_recordId")) != "undefined") {  var MM_editConnection = MM_Esdrm_STRING;  var MM_editTable  = "dbo.TabUtilizadores";  var MM_editColumn = "numero";  var MM_recordId = "" + Request.Form("MM_recordId") + "";  var MM_editRedirectUrl = "Mostrar.asp";  var MM_fieldsStr = "select2|value|nomeUser2|value|select|value|usernameNT2|value|passwordNT2|value|usernameMail2|value|passwordMail2|value|email2|value|URLPagina2|value|Extensao2|value|Telefone2|value|Cargos2|value|Categoria2|value|NomeCompleto2|value|Morada2|value|Localidade2|value|CodPostal2|value|LocPostal2|value|GrauAcademico2|value|Foto2|value|TelefCasa2|value|Telemovel2|value|BI2|value|Validade|value|NIF2|value|DataNasc|value|IdComputador|value";     //|Ativo|value";  var MM_columnsStr = "titulo|',none,''|nomeUser|',none,''|tipoUtilizador|',none,''|usernameNT|',none,''|passwordNT|',none,''|usernameMail|',none,''|passwordMail|',none,''|email|',none,''|URLPagina|',none,''|Extensao|',none,''|Telefone|',none,''|Cargos|',none,''|Categoria|',none,''|NomeCompleto|',none,''|Morada|',none,''|Localidade|',none,''|CodPostal|',none,''|LocPostal|',none,''|GrauAcademico|',none,''|Foto|',none,''|TelefCasa|',none,''|Telemovel|',none,''|BI|',none,''|validade|',none,NULL|NIF|',none,''|DataNasc|',none,NULL|IdComputador|',none,''"       //|Activo|',none,''";  // create the MM_fields and MM_columns arrays  var MM_fields = MM_fieldsStr.split("|");  var MM_columns = MM_columnsStr.split("|");    // set the form values  for (var i=0; i+1 < MM_fields.length; i+=2) {    MM_fields[i+1] = String(Request.Form(MM_fields[i]));  }  // append the query string to the redirect URL  if (MM_editRedirectUrl && Request.QueryString && Request.QueryString.Count > 0) {    MM_editRedirectUrl += ((MM_editRedirectUrl.indexOf('?') == -1)?"?":"&") + Request.QueryString;  }}%><%// *** Update Record: construct a sql update statement and execute itif (String(Request("MM_update")) != "undefined" &&    String(Request("MM_recordId")) != "undefined") {  // create the sql update statement  MM_editQuery = "update " + MM_editTable + " set ";  for (var i=0; i+1 < MM_fields.length; i+=2) {    var formVal = MM_fields[i+1];    var MM_typesArray = MM_columns[i+1].split(",");    var delim =    (MM_typesArray[0] != "none") ? MM_typesArray[0] : "";    var altVal =   (MM_typesArray[1] != "none") ? MM_typesArray[1] : "";    var emptyVal = (MM_typesArray[2] != "none") ? MM_typesArray[2] : "";    if (formVal == "" || formVal == "undefined") {      formVal = emptyVal;    } else {      if (altVal != "") {        formVal = altVal;      } else if (delim == "'") { // escape quotes        formVal = "'" + formVal.replace(/'/g,"''") + "'";      } else {        formVal = delim + formVal + delim;      }    }    MM_editQuery += ((i != 0) ? "," : "") + MM_columns[i] + " = " + formVal;  }  MM_editQuery += " where " + MM_editColumn + " = " + MM_recordId;  if (!MM_abortEdit) {    // execute the update    var MM_editCmd = Server.CreateObject('ADODB.Command');    MM_editCmd.ActiveConnection = MM_editConnection;    MM_editCmd.CommandText = MM_editQuery;    MM_editCmd.Execute();    MM_editCmd.ActiveConnection.Close();    if (MM_editRedirectUrl) {      Response.Redirect(MM_editRedirectUrl);    }  }}%><%var rstUtilizadores = Server.CreateObject("ADODB.Recordset");rstUtilizadores.ActiveConnection = MM_Esdrm_STRING;rstUtilizadores.Source = "SELECT dbo.Titulo.IdTitulo AS Expr1, dbo.tabTipoUtilizador.TabTipoDesc AS Expr2, dbo.TabUtilizadores.numero, dbo.TabUtilizadores.titulo, dbo.TabUtilizadores.nomeUser, dbo.TabUtilizadores.tipoUtilizador, dbo.TabUtilizadores.usernameNT, dbo.TabUtilizadores.passwordNT, dbo.TabUtilizadores.usernameMail, dbo.TabUtilizadores.passwordMail, dbo.TabUtilizadores.email, dbo.TabUtilizadores.URLPagina, dbo.TabUtilizadores.Extensao, dbo.TabUtilizadores.Telefone, dbo.TabUtilizadores.Cargos, dbo.TabUtilizadores.Categoria, dbo.TabUtilizadores.NomeCompleto, dbo.TabUtilizadores.Morada, dbo.TabUtilizadores.Localidade, dbo.TabUtilizadores.CodPostal, dbo.TabUtilizadores.LocPostal, dbo.TabUtilizadores.GrauAcademico, dbo.TabUtilizadores.Foto, dbo.TabUtilizadores.TelefCasa, dbo.TabUtilizadores.Telemovel, dbo.TabUtilizadores.BI, dbo.TabUtilizadores.validade, dbo.TabUtilizadores.NIF, dbo.TabUtilizadores.DataNasc, dbo.TabUtilizadores.IdComputador FROM dbo.tabTipoUtilizador INNER JOIN dbo.TabUtilizadores ON dbo.tabTipoUtilizador.IdUser = dbo.TabUtilizadores.tipoUtilizador INNER JOIN dbo.Titulo ON dbo.TabUtilizadores.titulo = dbo.Titulo.IdTitulo  WHERE (CONVERT(char(4), dbo.TabUtilizadores.numero))='"+ registo +"'";rstUtilizadores.CursorType = 0;rstUtilizadores.CursorLocation = 2;rstUtilizadores.LockType = 1;rstUtilizadores.Open();var rstUtilizadores_numRows = 0;%><%var rstTipoUtilizador = Server.CreateObject("ADODB.Recordset");rstTipoUtilizador.ActiveConnection = MM_Esdrm_STRING;rstTipoUtilizador.Source = "SELECT *  FROM dbo.tabTipoUtilizador";rstTipoUtilizador.CursorType = 0;rstTipoUtilizador.CursorLocation = 2;rstTipoUtilizador.LockType = 1;rstTipoUtilizador.Open();var rstTipoUtilizador_numRows = 0;%><%var rstTitulo = Server.CreateObject("ADODB.Recordset");rstTitulo.ActiveConnection = MM_Esdrm_STRING;rstTitulo.Source = "SELECT *  FROM dbo.Titulo  ORDER BY Descricao ASC";rstTitulo.CursorType = 0;rstTitulo.CursorLocation = 2;rstTitulo.LockType = 1;rstTitulo.Open();var rstTitulo_numRows = 0;%><SCRIPT RUNAT=SERVER LANGUAGE=VBSCRIPT>					function DoDateTime(str, nNamedFormat, nLCID)					dim strRet									dim nOldLCID																			strRet = str									If (nLCID > -1) Then									oldLCID = Session.LCID							End If																				On Error Resume Next																		If (nLCID > -1) Then									Session.LCID = nLCID							End If																				If ((nLCID < 0) Or (Session.LCID = nLCID)) Then						strRet = FormatDateTime(str, nNamedFormat)				End If																				If (nLCID > -1) Then									Session.LCID = oldLCID							End If																				DoDateTime = strRet							End Function									</SCRIPT><html><head><title>Alterar</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><script language="JavaScript" type="text/JavaScript"><!--function MM_goToURL() { //v3.0  var i, args=MM_goToURL.arguments; document.MM_returnValue = false;  for (i=0; i<(args.length-1); i+=2) eval(args[i]+".location='"+args[i+1]+"'");}function jsTrim(TXT)    {    	return TXT.replace(/(^\s+)|(\s+$)/g,"");}function jsLTrim(TXT)    {    	return TXT.replace(/(^\s+)/g,"");}function jsRTrim(TXT)    {    	return TXT.replace(/(\s+$)/g,"");}function MM_findObj(n, d) { //v4.01  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);  if(!x && d.getElementById) x=d.getElementById(n); return x;}function MM_validateForm() { //v4.0	var i,p,q,nm,test,num,min,max,errors='',args=MM_validateForm.arguments;  	for (i=0; i<(args.length-2); i+=3) 		{   		test=args[i+2]; 		val=MM_findObj(args[i]);    	if (val) 			{			nm=args[i+1]; 			if ((val=val.value)!="") 				{	      		if (test.indexOf('isEmail')!=-1) 					{ 	  				p=val.indexOf('@');        			if (p<1 || p==(val.length-1)) errors+='- '+nm+' - O E-Mail é Inválido.\n';      				} 				else if (test!='R') 					{        			if (isNaN(val)) errors+='- '+nm+' - É um Campo Numérico.\n';	        		if (test.indexOf('inRange') != -1) 						{ 						p=test.indexOf(':');          				min=test.substring(8,p); max=test.substring(p+1);           				if (val<min || max<val) errors+='- '+nm+' - O número deve estar entre '+min+' e '+max+'.\n';						}					}				} 			else if (test.charAt(0) == 'R') errors += '- '+nm+' - É um Campo Obrigatório.\n'; 			}		} 	if (errors) alert('Rectificar o(s) seguinte(s) erro(s):\n'+errors);	document.MM_returnValue = (errors == '');}function MM_callJS(jsStr) { //v2.0  return eval(jsStr)}//--></script><link href="../../../CSS/css.css" rel="stylesheet" type="text/css"></head><body background="../../../Fundos/exptextb.jpg"><div align="center"><strong><font size="5">Altera&ccedil;&atilde;o de Dados Pessoais</font></strong><br></div><form method="POST" action="<%=MM_editAction%>" name="form1">  <table width="90%" border="1" align="center" bgcolor="#CCCC99">    <tr valign="baseline">       <td align="right" nowrap><div align="center">Titulo:           <select name="select2">            <% while (!rstTitulo.EOF) {%>            <option value="<%=(rstTitulo.Fields.Item("IdTitulo").Value)%>" <%=((rstTitulo.Fields.Item("IdTitulo").Value == (rstUtilizadores.Fields.Item("titulo").Value))?"SELECTED":"")%> ><%=(rstTitulo.Fields.Item("Descricao").Value)%></option>            <%  rstTitulo.MoveNext();}if (rstTitulo.CursorType > 0) {  if (!rstTitulo.BOF) rstTitulo.MoveFirst();} else {  rstTitulo.Requery();}%>          </select>          &nbsp;&nbsp; Nome de User:           <input name="nomeUser2" type="text" onFocus="this.form.nomeUser2.value=jsTrim(this.form.nomeUser2.value)" onBlur="MM_validateForm('nomeUser2','Nome do Utilizador','R');return document.MM_returnValue" value="<%=(rstUtilizadores.Fields.Item("nomeUser").Value)%>" size="20" maxlength="20">          &nbsp;&nbsp;Tipo de Utilizador:           <select name="select">            <% while (!rstTipoUtilizador.EOF) {%>            <option value="<%=(rstTipoUtilizador.Fields.Item("IdUser").Value)%>" <%=((rstTipoUtilizador.Fields.Item("IdUser").Value == rstUtilizadores.Fields.Item("TipoUtilizador").Value)?"SELECTED":"")%> ><%=(rstTipoUtilizador.Fields.Item("TabTipoDesc").Value)%></option>            <%  rstTipoUtilizador.MoveNext();}if (rstTipoUtilizador.CursorType > 0) {  if (!rstTipoUtilizador.BOF) rstTipoUtilizador.MoveFirst();} else {  rstTipoUtilizador.Requery();}%>          </select>        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Username do Windows:           <input name="usernameNT2" type="text" onBlur="MM_validateForm('usernameNT2','UserName do Windows','R');return document.MM_returnValue" value="<%=(rstUtilizadores.Fields.Item("usernameNT").Value)%>" size="20" maxlength="20" onFocus="this.form.usernameNT2.value=jsTrim(this.form.usernameNT2.value)">          Password do Windows:           <input name="passwordNT2" type="text" onBlur="MM_validateForm('passwordNT2','Password do Windows','R');return document.MM_returnValue" value="<%=(rstUtilizadores.Fields.Item("passwordNT").Value)%>" size="20" maxlength="20" onFocus="this.form.passwordNT2.value=jsTrim(this.form.passwordNT2.value)">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center" >Username do eMail:           <input name="usernameMail2" type="text" onBlur="MM_validateForm('usernameMail2','UsernName do eMail','R');return document.MM_returnValue" value="<%=(rstUtilizadores.Fields.Item("usernameMail").Value)%>" size="20" maxlength="20" onFocus="this.form.usernameMail2.value=jsTrim(this.form.usernameMail.value)">          Password do eMail:           <input name="passwordMail2" type="text" value="<%=(rstUtilizadores.Fields.Item("passwordMail").Value)%>" size="20" maxlength="20" onBlur="MM_validateForm('passwordMail2','','R');return document.MM_returnValue" onFocus="this.form.passwordMail2.value=jsTrim(this.form.passwordMail2.value)">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">eMail:           <input name="email2" type="text" onBlur="MM_validateForm('email2','eMail do Utilizador','RisEmail');return document.MM_returnValue" value="<%=(rstUtilizadores.Fields.Item("email").Value)%>" size="50" maxlength="50" onFocus="this.form.eMail2.value=jsTrim(this.form.eMail2.value)">          URL da sua Página:           <input name="URLPagina2" type="text" value="<%=(rstUtilizadores.Fields.Item("URLPagina").Value)%>" size="50" maxlength="50" onFocus="this.form.URLPagina2.value=jsTrim(this.form.URLPagina2.value)">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº da Extens&atilde;o de Telefone:           <input name="Extensao2" type="text" value="<%=(rstUtilizadores.Fields.Item("Extensao").Value)%>" size="3" maxlength="3" onFocus="this.form.Extensao2.value=jsTrim(this.form.Extensao2.value)">          Nº do Telefone Directo:           <input name="Telefone2" type="text" value="<%=(rstUtilizadores.Fields.Item("Telefone").Value)%>" size="9" maxlength="9" onFocus="this.form.Telefone2.value=jsTrim(this.form.Telefone2.value)">          Cargo que Desempenha:           <input type="text" name="Cargos2" value="<%=(rstUtilizadores.Fields.Item("Cargos").Value)%>" size="32" onFocus="this.form.Cargos2.value=jsTrim(this.form.Cargos2.value)">        </div></td>    </tr>    <tr valign="baseline">      <td align="right" nowrap><div align="center">Categoria Profissional:         <input type="text" name="Categoria2" value="<%=(rstUtilizadores.Fields.Item("Categoria").Value)%>" size="50" onFocus="this.form.Categoria2.value=jsTrim(this.form.Categoria2.value)">       </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nome Completo:           <input name="NomeCompleto2" type="text" value="<%=(rstUtilizadores.Fields.Item("NomeCompleto").Value)%>" size="50" maxlength="50" onFocus="this.form.NomeCompleto2.value=jsTrim(this.form.NomeCompleto2.value)">          Morada:           <input name="Morada2" type="text" value="<%=(rstUtilizadores.Fields.Item("Morada").Value)%>" size="50" maxlength="50" onFocus="this.form.Morada2.value=jsTrim(this.form.Morada2.value)">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Localidade:           <input name="Localidade2" type="text" value="<%=(rstUtilizadores.Fields.Item("Localidade").Value)%>" size="50" maxlength="50" onFocus="this.form.Localidade2.value=jsTrim(this.form.Localidade2.value)">          Código Postal:           <input name="CodPostal2" type="text" value="<%=(rstUtilizadores.Fields.Item("CodPostal").Value)%>" size="8" maxlength="8" onFocus="this.form.CodPostal2.value=jsTrim(this.form.CodPostal2.value)">          <input name="LocPostal2" type="text" value="<%=(rstUtilizadores.Fields.Item("LocPostal").Value)%>" size="50" maxlength="50" onFocus="this.form.LocPostal2.value=jsTrim(this.form.LocPostal2.value)">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap> <div align="center">Grau Académico:           <input name="GrauAcademico2" type="text" onFocus="this.form.GrauAcademico2.value=jsTrim(this.form.GrauAcademico2.value)" value="<%=(rstUtilizadores.Fields.Item("GrauAcademico").Value)%>" size="50" maxlength="50">          Link da Foto:           <input name="Foto2" type="text" onFocus="this.form.Foto2.value=jsTrim(this.form.Foto2.value)" value="<%=(rstUtilizadores.Fields.Item("Foto").Value)%>" size="50" maxlength="50">        </div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº do Telefone de Casa:           <input name="TelefCasa2" type="text" value="<%=(rstUtilizadores.Fields.Item("TelefCasa").Value)%>" size="9" maxlength="9" onFocus="this.form.TelefCasa2.value=jsTrim(this.form.TelefCasa2.value)">          Nº do Telemóvel:           <input name="Telemovel2" type="text" value="<%=(rstUtilizadores.Fields.Item("Telemovel").Value)%>" size="9" maxlength="9" onFocus="this.form.Telemovel2.value=jsTrim(this.form.Telemovel2.value)">        </div></td>    </tr>    <tr valign="baseline">       <td height="26" align="right" nowrap><div align="center">Nº do Bilhete de           Identidade:           <input name="BI2" type="text" value="<%=(rstUtilizadores.Fields.Item("BI").Value)%>" size="10" maxlength="10" onFocus="this.form.BI2.value=jsTrim(this.form.BI2.value)">          Valido at&eacute;:           <input name="Validade" type="text" value="<%= DoDateTime((rstUtilizadores.Fields.Item("validade").Value), 2, 2070) %>" size="10" maxlength="10" onFocus="this.form.Validade.value=jsTrim(this.form.Validade.value)">          &nbsp;dd-mm-aaaa</div></td>    </tr>    <tr valign="baseline">       <td align="right" nowrap><div align="center">Nº de Identificação Fiscal: 		  <input name="NIF2" type="text" id="NIF2" onFocus="this.form.NIF2.value=jsTrim(this.form.NIF2.value)"  value="<%=(rstUtilizadores.Fields.Item("NIF").Value)%>" size="10" maxlength="9">          Data de Nascimento:           <input name="DataNasc" type="text" value="<%= DoDateTime((rstUtilizadores.Fields.Item("DataNasc").Value), 2, 2070) %>" size="10" maxlength="10" onFocus="this.form.DataNasc.value=jsTrim(this.form.DataNasc.value)">          dd-mm-aaaa </div></td>    </tr>    <tr valign="baseline">      <td align="right" nowrap><div align="center">N&ordm; do Computador que lhe           foi atribu&iacute;do:           <input name="IdComputador" type="text" value="<%=(rstUtilizadores.Fields.Item("IdComputador").Value)%>" size="20" maxlength="20">        </div></td>    </tr>  </table>  <div align="center"> <br>    <% Session("Prof") = rstUtilizadores.Fields.Item("numero").Value %>    <input type="hidden" name="MM_update" value="form1">    <input type="hidden" name="MM_recordId" value="<%= rstUtilizadores.Fields.Item("numero").Value %>">    <input name="Gravar" type="submit" class="botao_actualizar" id="Gravar2" onClick="MM_validateForm('nomeUser2','','R','usernameNT2','','R','passwordNT2','','R','usernameMail2','','R','passwordMail2','','R','email2','','RisEmail');return document.MM_returnValue" value="Gravar a Altera&ccedil;&atilde;o">    &nbsp;&nbsp;     <input name="Cancelar" type="reset" class="botao_actualizar" id="Cancelar" value="Cancelar">    &nbsp;&nbsp;     <% if (Session("Login") == "jorgemadeira") { %>    <input name="Voltar" type="button" class="botao_actualizar" id="Voltar2" onClick="MM_goToURL('parent','../../../CentroInformatica/centroInformatica.asp');return document.MM_returnValue" value="Voltar &agrave; P&aacute;gina Anterior">    <% } 	   else { %>    <input name="Voltar" type="button" class="botao_actualizar" id="Voltar2" onClick="MM_callJS('top.history.back()')" value="Voltar &agrave; P&aacute;gina Anterior">    <% } %>    <input name="Button" type="button" class="botao_actualizar" onClick="MM_goToURL('parent','Disciplinas.asp?<%=(rstUtilizadores.Fields("numero").Value)%>');return document.MM_returnValue" value="Inserir Disciplinas">  </div></form><p><br></p><div align="center">  <p>&nbsp;</p>  <p>&nbsp; </p></div></body></html><%rstUtilizadores.Close();%><%rstTipoUtilizador.Close();%><%rstTitulo.Close();%>