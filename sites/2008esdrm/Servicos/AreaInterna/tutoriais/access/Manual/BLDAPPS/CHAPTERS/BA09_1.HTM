<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head><title>CHAPTER 9</title>
<link REL="STYLESHEET" HREF="naetugp.css" TYPE="text/css">
<script Language="VBScript">
Dim look
Sub SyncURL(look)
if right(top.frames(0).frames(1).location.href, 10)="toc_tc.htm" then
top.frames(0).frames(1).TreeCtl1.SyncToURL(look)
end if
End Sub
</script>
<meta name="Microsoft Theme" content="expeditn 011, default"></head>
<!--DocHeaderStart-->
<body background="../../../../_themes/expeditn/exptextb.jpg" bgcolor="#FFFFFF" text="#000000" link="#993300" vlink="#666600" alink="#CC3300"><!--mstheme--><font face="book antiqua, times new roman, times"><a HREF="ba08_8.htm" OnClick="SyncURL(&quot;chapters/ba08_8.htm&quot;)"><img SRC="..\images\prevpage.gif" ALT="Previous Page" ALIGN="RIGHT" BORDER="0"></a>
<!--DocHeaderEnd-->
<!-- This is a PANDA Generated HTML file. The source is a WinWord Document. -->
<p CLASS="heading2ChapterNumberAppendixLetterchn">CHAPTER&nbsp; 9</p>
<p CLASS="ChapterAppendixTitlecht">Working with Records and Fields</p>
<p CLASS="ChapterSummaryTextchsum">The Microsoft Jet database engine supports a rich set of Data Access Objects (DAO) features for organizing, sorting, searching, updating, adding, and deleting data. The <span CLASS="ElementNameeln">Recordset </span>object alone provides 24 methods and 26 properties that give you a great deal of control over records in a database. With the <span CLASS="ElementNameeln">Recordset </span>object's <span CLASS="ElementNameeln">Fields</span> collection and the properties and methods of the<span CLASS="ElementNameeln"> Field</span> object, you can manipulate data at the field level. This chapter describes how to manipulate records and fields by using the DAO <span CLASS="ElementNameeln">Recordset </span>and <span CLASS="ElementNameeln">Field</span> objects.
<a NAME="3UsingRecordsetObjects"></a>
<p CLASS="heading3OrgHeading1h1">Using Recordset Objects</p>
<p CLASS="Textttext">A <span CLASS="ElementNameeln">Recordset</span> object represents the records in a base table or the records that result from running a query. You use <span CLASS="ElementNameeln">Recordset</span> objects to manipulate the data in a database at the record level. </p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>You use <span CLASS="ElementNameeln">Field</span> objects to manipulate the data in a database at the field level. For more information, see <a HREF="../chapters/ba09_2.htm" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)">&quot;Using Field Objects&quot;</a> later in this chapter.</p>
<p CLASS="Textttext">The four types of <span CLASS="ElementNameeln">Recordset</span> objects<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5"><span CLASS="NewTermntrm">table</span>, <span CLASS="NewTermntrm">dynaset</span>, <span CLASS="NewTermntrm">snapshot</span>, and <span CLASS="NewTermntrm">forward-only</span><img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">differ from each other in significant ways:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspA table-type <span CLASS="ElementNameeln">Recordset</span> object can be created from a table in a Microsoft Access database, but not from an Open Database Connectivity (ODBC) or a linked table. When you create a table-type <span CLASS="ElementNameeln">Recordset</span>, the Jet database engine opens the actual table, and your subsequent data manipulations operate directly on base-table data. A table-type <span CLASS="ElementNameeln">Recordset</span> can be opened on only one table; it cannot be opened on a union query or a select query with a join.</p>
<p CLASS="ListText1lt1">One of the biggest advantages of this type of <span CLASS="ElementNameeln">Recordset</span> object is that you can index it by using an index created for the underlying table. This allows much faster sorting and searching than is possible with the other types. To locate specific records, use the <span CLASS="ElementNameeln">Seek</span> method, which is faster than the Find methods.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspA dynaset-type <span CLASS="ElementNameeln">Recordset</span> object can be created from either a local or a linked table, or with a row-returning query that joins tables. It's actually a set of references to records in one or more tables. With a dynaset, you can extract and update data from more than one table, including linked tables from other databases. Heterogeneous updatable joins are a unique feature of dynasets<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">they enable you to use updatable queries against tables in different types of databases.</p>
<p CLASS="ListText1lt1">One of the main benefits of this type is that a dynaset and its underlying tables update each other. Changes made to records in the dynaset are also made in the underlying table, and changes made by other users to data in the underlying tables while the dynaset is open are reflected in the dynaset. The dynaset is the most flexible and powerful type of <span CLASS="ElementNameeln">Recordset</span> object, although searches and other manipulations may not run as fast as with a table-type <span CLASS="ElementNameeln">Recordset</span>.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspA snapshot-type <span CLASS="ElementNameeln">Recordset</span> object is a static copy of a set of records as it exists at the time the snapshot is created. A snapshot-type <span CLASS="ElementNameeln">Recordset</span> object can contain fields from one or more tables in a database. You can't update a snapshot.</p>
<p CLASS="ListText1lt1">The main advantage of a snapshot is that it creates less processing overhead than the other types, so it can run queries and return data faster, especially when working with ODBC data sources. 
<p CLASS="ListText1lt1"></p>
<p CLASS="ListNoteText1lnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For .mdb files, OLE Object and Memo fields are represented in a snapshot by pointers, rather than the actual data. For more information on OLE Object and Memo fields, see <a HREF="../chapters/ba09_2.htm#5TheOLEObjectandMemoDataTypes" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)">&quot;The OLE Object and Memo Data Types&quot;</a> later in this chapter.</span></p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspA forward-only-type <span CLASS="ElementNameeln">Recordset</span> object, sometimes referred to as a <span CLASS="NewTermntrm">forward-scrolling snapshot</span> or a <span CLASS="NewTermntrm">forward-only snapshot</span>, provides a subset of the capabilities of a snapshot. With forward-only snapshots, you can move only in a forward direction through the records. <span CLASS="ElementNameeln">Recordset</span> objects of this type cannot be cloned and only support the <span CLASS="ElementNameeln">Move</span> and <span CLASS="ElementNameeln">MoveNext</span> methods. Like snapshots, you can't update a forward-only-type <span CLASS="ElementNameeln">Recordset</span> object.</p>
<p CLASS="ListText1lt1">The advantage of a forward-only-type <span CLASS="ElementNameeln">Recordset</span> object is that it usually provides the greatest speed. It does, however, offer the least functionality of any <span CLASS="ElementNameeln">Recordset</span>.
<p CLASS="ListText1lt1"></p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>A snapshot stores a copy of the entire record (except for OLE Object and Memo fields). A dynaset stores just the primary key for each record, copying the full record only when it's needed for editing or display purposes. Since a snapshot stores a complete copy of all the records in a table, a snapshot may perform more slowly than a dynaset if the number of records is large. To determine whether a snapshot or dynaset is faster, you can open the <span CLASS="ElementNameeln">Recordset</span> as a dynaset and then open it as a snapshot to see which provides faster performance.</p>
<p CLASS="Textttext">The type of <span CLASS="ElementNameeln">Recordset</span> object you use depends on what you want to do and whether you want to change or simply view the data. For example, if you must sort the data or work with indexes, use a table. Because table-type <span CLASS="ElementNameeln">Recordset</span> objects are indexed, they also provide the fastest way to locate data. If you want to be able to update a set of records selected by a query, use a dynaset. If the table-type is unavailable and you only need to scan through a set of records, using a forward-only snapshot may improve performance.
<p CLASS="Textttext">All other things being equal, if a table-type <span CLASS="ElementNameeln">Recordset </span>object is available, using it almost always results in the best performance.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>In this chapter, the terms table, snapshot, and dynaset are often used for the sake of simplicity. However, keep in mind that these are all types of <span CLASS="ElementNameeln">Recordset</span> objects. For example, the term dynaset refers to a dynaset-type <span CLASS="ElementNameeln">Recordset</span> object, not the obsolete DAO <span CLASS="ElementNameeln">Dynaset</span> object.</p>
<a NAME="4CreatingaRecordsetObjectVariable"></a>
<p CLASS="heading4OrgHeading2h2">Creating a Recordset Object Variable</p>
<p CLASS="Textttext">To create a <span CLASS="ElementNameeln">Recordset</span> object variable, use the <span CLASS="ElementNameeln">OpenRecordset</span> method. First, declare a variable of type <span CLASS="ElementNameeln">Recordset</span>, and then set the variable to the object returned by the <span CLASS="ElementNameeln">OpenRecordset</span> method.
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">OpenRecordset</span> method with <span CLASS="ElementNameeln">Database</span>, <span CLASS="ElementNameeln">TableDef</span>, <span CLASS="ElementNameeln">QueryDef</span>, and existing <span CLASS="ElementNameeln">Recordset</span> objects. The syntax of the <span CLASS="ElementNameeln">OpenRecordset </span>method for <span CLASS="ElementNameeln">Database</span> object is:</p>
<p CLASS="SyntaxTextsyn"><span CLASS="ElementNameeln">Set</span> <span CLASS="NewTermntrm">variable</span> <span CLASS="ElementNameeln">=</span> <span CLASS="NewTermntrm">database</span><span CLASS="ElementNameeln">.OpenRecordset</span> <span CLASS="ElementNameeln">(</span><span CLASS="NewTermntrm">source</span> [, <span CLASS="NewTermntrm">type</span> [, <span CLASS="NewTermntrm">options</span> [, <span CLASS="NewTermntrm">lockedits</span> ]]]<span CLASS="ElementNameeln">)</span>
<p CLASS="SyntaxTextsyn"><span CLASS="ElementNameeln"></span></p>
<p CLASS="Textttext">The syntax of the <span CLASS="ElementNameeln">OpenRecordset</span> method for all other types of objects is:</p>
<p CLASS="SyntaxTextsyn"><span CLASS="ElementNameeln">Set</span> <span CLASS="NewTermntrm">variable</span> <span CLASS="ElementNameeln">=</span> <span CLASS="NewTermntrm">object</span><span CLASS="ElementNameeln">.OpenRecordset</span> <span CLASS="ElementNameeln">(</span>[<span CLASS="NewTermntrm">type</span> [, <span CLASS="NewTermntrm">options</span> [, <span CLASS="NewTermntrm">lockedits</span> ]]]<span CLASS="ElementNameeln">)</span>
<p CLASS="SyntaxTextsyn"><span CLASS="ElementNameeln"></span></p>
<p CLASS="Textttext">The <span CLASS="NewTermntrm">variable</span> argument is the name of the new <span CLASS="ElementNameeln">Recordset</span> object. The <span CLASS="NewTermntrm">database</span> argument is the name of the open <span CLASS="ElementNameeln">Database</span> object from which you're creating the new <span CLASS="ElementNameeln">Recordset</span> object. The <span CLASS="NewTermntrm">object</span> argument is the <span CLASS="ElementNameeln">TableDef</span>, <span CLASS="ElementNameeln">QueryDef</span>, or existing <span CLASS="ElementNameeln">Recordset</span> object from which you're creating the new <span CLASS="ElementNameeln">Recordset </span>object.
<p CLASS="Textttext">The <span CLASS="NewTermntrm">source</span> argument specifies the source of the records for the new <span CLASS="ElementNameeln">Recordset </span>object. The value of <span CLASS="NewTermntrm">source</span> is the value of the resulting <span CLASS="ElementNameeln">Recordset</span> object's DAO <span CLASS="ElementNameeln">Name</span> property. When you create a new <span CLASS="ElementNameeln">Recordset </span>object from a <span CLASS="ElementNameeln">Database</span> object, the <span CLASS="NewTermntrm">source</span> argument is a <span CLASS="ElementNameeln">TableDef </span>or <span CLASS="ElementNameeln">QueryDef</span> object in the database or a valid row-returning SQL query or statement. When you create a new <span CLASS="ElementNameeln">Recordset</span> object from a <span CLASS="ElementNameeln">TableDef</span>, <span CLASS="ElementNameeln">QueryDef</span>, or existing <span CLASS="ElementNameeln">Recordset</span> object, the object itself provides the data source for the new <span CLASS="ElementNameeln">Recordset</span>.
<p CLASS="Textttext">The <span CLASS="NewTermntrm">type</span> argument is an intrinsic constant that specifies the kind of <span CLASS="ElementNameeln">Recordset</span> object that you want to create. You can use the following constants:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbOpenTable</span></p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbOpenDynaset</span></p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbOpenSnapshot</span></p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbOpenForwardOnly</span></p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>The <span CLASS="ElementNameeln">dbOpenForwardOnly</span> type constant replaces the <span CLASS="ElementNameeln">dbForwardOnly</span> type constant that was available in previous versions of DAO. You can still use the <span CLASS="ElementNameeln">dbForwardOnly</span> constant, but it's provided only for backward compatibility.</p>
<p CLASS="Textttext">The following sections discuss the <span CLASS="NewTermntrm">type</span>,<span CLASS="NewTermntrm"> options</span>, and <span CLASS="NewTermntrm">lockedits</span> arguments in detail.</p>
<a NAME="5DefaultRecordsetTypes"></a>
<p CLASS="heading5OrgHeading3h3">Default Recordset Types</p>
<p CLASS="Textttext">Because DAO automatically chooses the default <span CLASS="ElementNameeln">Recordset</span> type depending on the data source and how the <span CLASS="ElementNameeln">Recordset</span> is opened, you don't need to specify a <span CLASS="ElementNameeln">Recordset</span> type. However, you can specify a type different from the default by using a <span CLASS="NewTermntrm">type</span> argument in the <span CLASS="ElementNameeln">OpenRecordset</span> method.
<p CLASS="Textttext">The following list describes the available types and the default type, depending on how you open the <span CLASS="ElementNameeln">Recordset</span> object:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUsing the <span CLASS="ElementNameeln">OpenRecordset</span> method with a <span CLASS="ElementNameeln">Database</span> object:</p>
<p CLASS="ListCodeText1lct1">Set rstNew = dbs.OpenRecordset(&quot;Data Source&quot;)</p>
<p CLASS="ListText1lt1">If <span CLASS="CodeTextEmbeddedcte">Data Source</span> is a table local to the database, all four types are available, and the table-type <span CLASS="ElementNameeln">Recordset</span> object is the default. If <span CLASS="CodeTextEmbeddedcte">Data Source</span> is anything else, only dynaset- and snapshot-type <span CLASS="ElementNameeln">Recordset</span> objects are available, and the dynaset type is the default.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUsing the<span CLASS="ElementNameeln"> OpenRecordset</span> method with a <span CLASS="ElementNameeln">TableDef </span>object:</p>
<p CLASS="ListCodeText1lct1">Set rstNew = tdfTableData.OpenRecordset</p>
<p CLASS="ListText1lt1">If <span CLASS="CodeTextEmbeddedcte">tdfTableData</span> refers to a table in a Microsoft Access database (.mdb) or to an installable ISAM database opened directly, then all four types are available and the table-type <span CLASS="ElementNameeln">Recordset</span> object is the default type. If <span CLASS="CodeTextEmbeddedcte">tdfTableData</span> is in an ODBC database or is a linked table in an external database, only dynaset- and snapshot-type <span CLASS="ElementNameeln">Recordset</span> objects are available, and the dynaset type is the default.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUsing the<span CLASS="ElementNameeln"> OpenRecordset</span> method with a <span CLASS="ElementNameeln">QueryDef</span> object:</p>
<p CLASS="ListCodeText1lct1">Set rstNew = qdfQueryData.OpenRecordset</p>
<p CLASS="ListText1lt1">Only dynaset- and snapshot-type <span CLASS="ElementNameeln">Recordset</span> objects are available, and the dynaset type is the default.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspUsing the<span CLASS="ElementNameeln"> OpenRecordset</span> method with an existing <span CLASS="ElementNameeln">Recordset</span> object:</p>
<p CLASS="ListCodeText1lct1">Set rstNew = rstExisting.OpenRecordset</p>
<p CLASS="ListText1lt1">Only dynaset- and snapshot-type <span CLASS="ElementNameeln">Recordset</span> objects are available. The default is the type of the existing <span CLASS="ElementNameeln">Recordset</span>, in this case, the type of <span CLASS="CodeTextEmbeddedcte">rstExisting</span>.
<a NAME="5OpenRecordsetOptions"></a>
<p CLASS="heading5OrgHeading3h3">OpenRecordset Options</p>
<p CLASS="Textttext">With the <span CLASS="NewTermntrm">options</span> argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method, you can specify a number of other features for a <span CLASS="ElementNameeln">Recordset</span> object. You can use the following constants:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbAppendOnly</span>&nbsp;&nbsp;&amp;nbspUsers can append new records to the <span CLASS="ElementNameeln">Recordset</span>, but they cannot edit or delete existing records. This is useful in applications that collect and archive data (dynaset only).</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbReadOnly</span>&nbsp;&nbsp;&amp;nbspNo changes can be made to the <span CLASS="ElementNameeln">Recordset</span>. This argument is provided only for backward compatibility. Use the <span CLASS="ElementNameeln">dbReadOnly</span> constant in the <span CLASS="NewTermntrm">lockedits</span> argument instead.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbSeeChanges</span>&nbsp;&nbsp;&amp;nbspIf another user changes data in a record on which this <span CLASS="ElementNameeln">Recordset</span> has invoked the <span CLASS="ElementNameeln">Edit</span> method, but before it has invoked the <span CLASS="ElementNameeln">Update</span> method, a run-time error occurs. This is useful in applications where multiple users have simultaneous read/write permission on the same data (dynaset and table only).</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbDenyWrite</span>&nbsp;&nbsp;&amp;nbspWhen used on a dynaset or snapshot, this option prevents other users from adding or modifying records, although they can still read data. When used on a table, no other user can open any type of <span CLASS="ElementNameeln">Recordset</span> from an underlying table.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbDenyRead</span>&nbsp;&nbsp;&amp;nbspOther users cannot read data in the table (table only).</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbForwardOnly</span>&nbsp;&nbsp;&amp;nbspThis option creates a forward-only snapshot. It is provided only for backward compatibility. Use the <span CLASS="ElementNameeln">dbOpenForwardOnly</span> constant in the <span CLASS="NewTermntrm">type</span> argument instead.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbSQLPassThrough</span>&nbsp;&nbsp;&amp;nbspWhen the <span CLASS="NewTermntrm">source</span> argument is an SQL statement, use this constant to pass the SQL statement to an ODBC database for processing. If used with a dynaset, data isn't updatable (dynaset and snapshot only).</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbConsistent</span>&nbsp;&nbsp;&nbsp;(Default) Only consistent updates are allowed (dynaset only). You can't use this constant with the <span CLASS="ElementNameeln">dbInconsistent</span> constant.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbInconsistent</span>&nbsp;&nbsp;&amp;nbspInconsistent updates are allowed. This is the opposite of <span CLASS="ElementNameeln">dbConsistent</span> (dynaset only). You can't use this constant with the <span CLASS="ElementNameeln">dbConsistent</span> constant.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For more information on inconsistent updates, see <a HREF="../chapters/ba09_1.htm#SBInconsistentUpdates" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Inconsistent Updates&quot;</a> later in this chapter.</span></p>
<p CLASS="Textttext">With the <span CLASS="NewTermntrm">lockedits </span>argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method, you can control how locking is handled for a <span CLASS="ElementNameeln">Recordset</span> object. You can use the following constants:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbReadOnly</span>&nbsp;&nbsp;&amp;nbspNo changes can be made to the <span CLASS="ElementNameeln">Recordset</span>. This constant replaces the <span CLASS="ElementNameeln">dbReadOnly</span> constant that was used in the <span CLASS="NewTermntrm">options</span> argument in previous versions of DAO.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbPessimistic</span>&nbsp;&nbsp;&nbsp;(Default) Microsoft Jet uses pessimistic locking to determine how changes are made to the <span CLASS="ElementNameeln">Recordset</span> in a multiuser environment.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="ElementNameeln">dbOptimistic</span>&nbsp;&nbsp;&amp;nbspMicrosoft Jet uses optimistic locking to determine how changes are made to the <span CLASS="ElementNameeln">Recordset</span> in a multiuser environment.</p>
<p CLASS="Textttext">The default value is <span CLASS="ElementNameeln">dbPessimistic</span>. The only effect of using <span CLASS="ElementNameeln">dbPessimistic</span> or <span CLASS="ElementNameeln">dbOptimistic</span> is to preset the value of the <span CLASS="ElementNameeln">Recordset</span> object's <span CLASS="ElementNameeln">LockEdits</span> property.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>Setting both the <span CLASS="NewTermntrm">lockedits</span> argument and the <span CLASS="NewTermntrm">options</span> argument to <span CLASS="ElementNameeln">dbReadOnly</span> generates a run-time error.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on optimistic and pessimistic locking, see Chapter 10, <a HREF="../chapters/ba10_1.htm" OnClick="SyncURL(&quot;chapters/ba10_1.htm&quot;)">&quot;Creating Multiuser Applications.&quot;</a> For information on using <span CLASS="ElementNameeln">Recordset </span>objects in client/server applications, see Chapter 19, <a HREF="../chapters/ba19_1.htm" OnClick="SyncURL(&quot;chapters/ba19_1.htm&quot;)">&quot;Developing Client/Server Applications.&quot;</a></p>
<a NAME="5CreatingaRecordsetObjectfromaForm"></a>
<p CLASS="heading5OrgHeading3h3">Creating a Recordset Object from a Form</p>
<p CLASS="Textttext">You can create a <span CLASS="ElementNameeln">Recordset</span> object based on a Microsoft Access form. To do so, use the <span CLASS="ElementNameeln">RecordsetClone </span>property of the form. This creates a dynaset-type <span CLASS="ElementNameeln">Recordset</span> that refers to the same underlying query or data as the form. If a form is based on a query, referring to the <span CLASS="ElementNameeln">RecordsetClone </span>property is the equivalent of creating a dynaset with the same query. You can use the <span CLASS="ElementNameeln">RecordsetClone </span>property when you want to apply a method that can't be used with forms, such as the <span CLASS="ElementNameeln">FindFirst</span> method. The <span CLASS="ElementNameeln">RecordsetClone </span>property provides access to all the methods and properties that you can use with a dynaset. The syntax for the<span CLASS="ElementNameeln"> RecordsetClone </span>property is:</p>
<p CLASS="SyntaxTextsyn"><span CLASS="ElementNameeln">Set</span> <span CLASS="NewTermntrm">variable</span> <span CLASS="ElementNameeln">=</span> <span CLASS="NewTermntrm">form</span><span CLASS="ElementNameeln">.RecordsetClone</span></p>
<p CLASS="Textttext">The <span CLASS="NewTermntrm">variable</span> argument is the name of an existing <span CLASS="ElementNameeln">Recordset</span> object. The <span CLASS="NewTermntrm">form</span> argument is the name of a Microsoft Access form. The following example shows how to assign a <span CLASS="ElementNameeln">Recordset</span> object to the records in the Orders form:</p>
<p CLASS="CodeTextct">Dim rstOrders As Recordset<br>Set rstOrders = Forms!Orders.RecordsetClone</p>
<p CLASS="Textttext">This code always creates the type of <span CLASS="ElementNameeln">Recordset</span> being cloned (the type of <span CLASS="ElementNameeln">Recordset</span> on which the form is based); no other types are available.</p>
<a NAME="5CreatingaRecordsetObjectfromaTable"></a>
<p CLASS="heading5OrgHeading3h3">Creating a Recordset Object from a Table</p>
<p CLASS="Textttext">The method you use to create a <span CLASS="ElementNameeln">Recordset</span> object from a table depends on whether the table is local to the current database or is a linked table in another database. The following discussion explains the differences and provides examples for each type of table.</p>
<a NAME="6CreatingaRecordsetfromaTableinaLocalMicrosoftAccessDatabase"></a>
<p CLASS="heading6OrgHeading4h4">Creating a Recordset from a Table in a Local Microsoft Access Database</p>
<p CLASS="Textttext">The following example uses the <span CLASS="ElementNameeln">OpenRecordset</span> method to create a table-type <span CLASS="ElementNameeln">Recordset</span> object for a table in the current database:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstCustomers As Recordset<br>Set dbs = CurrentDb<br>Set rstCustomers = dbs.OpenRecordset(&quot;Customers&quot;)</p>
<p CLASS="Textttext">Notice that you don't need to use the <span CLASS="ElementNameeln">dbOpenTable</span> constant to create a table-type <span CLASS="ElementNameeln">Recordset</span>. If you omit the <span CLASS="NewTermntrm">type</span> constant, as discussed in &quot;Default Recordset Types&quot; earlier in this chapter, DAO chooses the highest-functionality <span CLASS="ElementNameeln">Recordset</span> type available, depending on the object in which the <span CLASS="ElementNameeln">Recordset</span> is created, and the data source. Because the table type is available when you open a <span CLASS="ElementNameeln">Recordset</span> from a local table, DAO uses it.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on connecting to data in external databases, see Chapter 18, <a HREF="../chapters/ba18_1.htm" OnClick="SyncURL(&quot;chapters/ba18_1.htm&quot;)">&quot;Accessing External Data.&quot;</a></p>
<a NAME="6CreatingaRecordsetfromaLinkedTableinaDifferentDatabaseFormat"></a>
<p CLASS="heading6OrgHeading4h4">Creating a Recordset from a Linked Table in a Different Database Format</p>
<p CLASS="Textttext">The following example creates a dynaset-type <span CLASS="ElementNameeln">Recordset</span> object for a linked Paradox® version 3.<span CLASS="NewTermntrm">x</span> table. Because the table type isn't available when you open a <span CLASS="ElementNameeln">Recordset</span> from a linked table in a database other than a Microsoft Access database, DAO selects the next most efficient type, opening a dynaset-type <span CLASS="ElementNameeln">Recordset</span>.</p>
<p CLASS="CodeTextct">Dim dbs As Database<br>Dim tdf As TableDef<br>Dim rstTableData As Recordset<br>' Get current database.<br>Set dbs = CurrentDb<br>Set tdf = dbs.CreateTableDef(&quot;PDXAuthor&quot;)<br>' Connect to the Paradox table Author in the database <br>' C:\PDX\Publish.<br>tdf.Connect = &quot;Paradox 3.X;DATABASE=C:\PDX\Publish&quot;<br>tdf.SourceTableName = &quot;Author&quot;<br>' Link the table.<br>dbs.TableDefs.Append tdf<br>' Create a dynaset-type Recordset for the table.<br>Set rstTableData = tdf.OpenRecordset()</p>
<p CLASS="Textttext">You can also open a Paradox table directly by first opening the Paradox database.</p>
<a NAME="6UsinganIndexonaTableTypeRecordsetObject"></a>
<p CLASS="heading6OrgHeading4h4">Using an Index on a Table-Type Recordset Object</p>
<p CLASS="Textttext">You can order records in a table-type <span CLASS="ElementNameeln">Recordset</span> object by setting its <span CLASS="ElementNameeln">Index</span> property. Any <span CLASS="ElementNameeln">Index</span> object in the <span CLASS="ElementNameeln">Indexes</span> collection of the <span CLASS="ElementNameeln">Recordset</span> object's underlying table definition can be specified with the <span CLASS="ElementNameeln">Index</span> property.
<p CLASS="Textttext">The following example creates a table-type <span CLASS="ElementNameeln">Recordset</span> object based on the Customers table, by using an existing index called City:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstTableData As Recordset<br>Set dbs = CurrentDb<br>Set rstTableData = dbs.OpenRecordset(&quot;Customers&quot;, dbOpenTable)<br>' Move to the first record.<br>rstTableData.MoveFirst<br>' First record with no index set.<br>MsgBox rstTableData!CompanyName <br>rstTableData.Index = &quot;City&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Select the City index.<br>rstTableData.MoveFirst&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Move to the first record.<br>MsgBox rstTableData!CompanyName<br>rstTableData.Close</p>
<p CLASS="Textttext">If you set the <span CLASS="ElementNameeln">Index</span> property to an index that doesn't exist, a trappable run-time error occurs. If you want to sort records according to an index that doesn't exist, either create the index first, or create a dynaset- or snapshot-type <span CLASS="ElementNameeln">Recordset</span> by using a query that returns records in a specified order.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>You must set the <span CLASS="ElementNameeln">Index</span> property before using the <span CLASS="ElementNameeln">Seek</span> method. For information on using the <span CLASS="ElementNameeln">Seek</span> method to locate records that satisfy criteria that you specify, see <a HREF="../chapters/ba09_1.htm#5FindingaRecordinaTableTypeRecordsetObject" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Finding a Record in a Table-Type Recordset Object&quot;</a> later in this chapter.</p>
<a NAME="5CreatingaRecordsetObjectfromaQuery"></a>
<p CLASS="heading5OrgHeading3h3">Creating a Recordset Object from a Query</p>
<p CLASS="Textttext">You can also create a <span CLASS="ElementNameeln">Recordset</span> object based on a stored select query. In the following example, Current Product List is an existing select query stored in the current database:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstProducts As Recordset<br>Set dbs = CurrentDb<br>Set rstProducts = dbs.OpenRecordset(&quot;Current Product List&quot;)</p>
<p CLASS="Textttext">If a stored select query doesn't already exist, the <span CLASS="ElementNameeln">OpenRecordset </span>method also accepts an SQL string instead of the name of a query. The previous example can be rewritten as follows:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstProducts As Recordset<br>Dim strQuerySQL As String<br>Set dbs = CurrentDb<br>strQuerySQL = &quot;SELECT * FROM Products WHERE Discontinued = No &quot; _<br>&nbsp;&nbsp;&nbsp;&amp; &quot;ORDER BY ProductName;&quot;<br>Set rstProducts = dbs.OpenRecordset(strQuerySQL)</p>
<p CLASS="Textttext">The disadvantage of this approach is that the query string must be compiled each time it's run, whereas the stored query is compiled the first time it's saved, which usually results in slightly better performance.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>When you create a <span CLASS="ElementNameeln">Recordset</span> object by using an SQL string or a stored query, your code doesn't continue running until the query returns the first row in the <span CLASS="ElementNameeln">Recordset</span>.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on SQL statements, search the Help index for &quot;SQL statements.&quot;</p>
<a NAME="5SortingandFilteringRecords"></a>
<p CLASS="heading5OrgHeading3h3">Sorting and Filtering Records</p>
<p CLASS="Textttext">Unless you open a table-type <span CLASS="ElementNameeln">Recordset</span> object and set its <span CLASS="ElementNameeln">Index</span> property, you can't be sure records will appear in any specific order. However, you usually want to retrieve records in a specific order. For example, you may want to view invoices arranged by increasing invoice number, or retrieve employee records in alphabetic order by their last names. To see records in a specific order, <span CLASS="NewTermntrm">sort</span> them.
<p CLASS="Textttext">To sort data in a <span CLASS="ElementNameeln">Recordset</span> object that isn't a table, use an SQL ORDER BY clause in the query that constructs the <span CLASS="ElementNameeln">Recordset</span>. You can specify an SQL string when you create a <span CLASS="ElementNameeln">QueryDef</span> object, when you create a stored query in a database, or when you use the <span CLASS="ElementNameeln">OpenRecordset</span> method.
<p CLASS="Textttext">You can also <span CLASS="NewTermntrm">filter</span> data, which means you restrict the result set returned by a query to records that meet some criteria. With any type of <span CLASS="ElementNameeln">Recordset</span> object, use an SQL WHERE clause in the original query to filter data.
<p CLASS="Textttext">The following example opens a dynaset-type <span CLASS="ElementNameeln">Recordset</span> object, and uses an SQL statement to retrieve, filter, and sort records:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstManagers As Recordset<br>Set dbs = CurrentDb<br>Set rstManagers = dbs.OpenRecordset(&quot;SELECT FirstName, LastName FROM &quot; _<br>&nbsp;&nbsp;&nbsp;&amp; &quot;Employees WHERE Title = 'Sales Manager' ORDER BY LastName&quot;)</p>
<p CLASS="Textttext">One drawback of running an SQL query in an <span CLASS="ElementNameeln">OpenRecordset</span> method is that it has to be recompiled every time you run it. If this query is used frequently, you can improve performance by first creating a stored query using the same SQL statement, and then opening a <span CLASS="ElementNameeln">Recordset</span> object against the query, as shown in the following example:</p>
<p CLASS="CodeTextct">Dim dbs As Database<br>Dim rstSalesReps As Recordset<br>Dim qdf As QueryDef<br>Set dbs = CurrentDb<br>Set qdf = dbs.CreateQueryDef(&quot;SalesRepQuery&quot;)<br>qdf.SQL = &quot;SELECT * FROM Employees WHERE Title = 'Sales Representative';&quot;<br>Set rstSalesReps = dbs.OpenRecordset(&quot;SalesRepQuery&quot;)</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>For even greater flexibility and control at run time, you can use query parameters to determine the sort order and filter criteria. For more information, see <a HREF="../chapters/ba09_1.htm#5UsingParameterQueries" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Using Parameter Queries&quot;</a> later in this chapter.</p>
<a NAME="6RecreatingaQueryfromaRecordsetObject"></a>
<p CLASS="heading6OrgHeading4h4">Recreating a Query from a Recordset Object</p>
<p CLASS="Textttext">You can also use a <span CLASS="ElementNameeln">Recordset</span> object opened from a <span CLASS="ElementNameeln">QueryDef </span>object as a template to re-create the <span CLASS="ElementNameeln">QueryDef</span> object. To do this, use the <span CLASS="ElementNameeln">CopyQueryDef</span> method. This is useful in situations where a <span CLASS="ElementNameeln">Recordset</span> object variable created from a <span CLASS="ElementNameeln">QueryDef </span>object is passed to a function, and the function must re-create the SQL equivalent of the query and possibly modify it.</p>
<a NAME="6ModifyingaQueryfromaRecordsetObject"></a>
<p CLASS="heading6OrgHeading4h4">Modifying a Query from a Recordset Object</p>
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">Requery</span> method on a dynaset- or snapshot-type <span CLASS="ElementNameeln">Recordset</span> object when you want to run the underlying query again after changing a parameter. This is more convenient than opening a new <span CLASS="ElementNameeln">Recordset</span>, and it runs faster.
<p CLASS="Textttext">The following example creates a <span CLASS="ElementNameeln">Recordset </span>object and passes it to a function that uses the <span CLASS="ElementNameeln">CopyQueryDef</span> method to extract the equivalent SQL string. It then prompts the user to add an additional constraint clause to the query. The code uses the <span CLASS="ElementNameeln">Requery </span>method to run the modified query.</p>
<p CLASS="CodeTextct">Sub AddQuery()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspDim qdf As QueryDef<br>&nbsp;&nbsp;&amp;nbspDim rstSalesReps As Recordset<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet qdf = dbs.CreateQueryDef(&quot;SalesRepQuery&quot;)<br>&nbsp;&nbsp;&amp;nbspqdf.SQL = &quot;SELECT * FROM Employees WHERE Title = 'Sales Representative'&quot;<br>&nbsp;&nbsp;&amp;nbspSet rstSalesReps = qdf.OpenRecordset()<br>&nbsp;&nbsp;&nbsp;' Call the function to add a constraint.<br>&nbsp;&nbsp;&amp;nbspAddQueryFilter rstSalesReps <br>&nbsp;&nbsp;&nbsp;' Return database to original.<br>&nbsp;&nbsp;&amp;nbspdbs.QueryDefs.Delete &quot;SalesRepQuery&quot;<br>&nbsp;&nbsp;&amp;nbsprstSalesReps.Close<br>End Sub<br>Function AddQueryFilter(rst As Recordset)<br>&nbsp;&nbsp;&amp;nbspDim qdf As QueryDef<br>&nbsp;&nbsp;&amp;nbspDim strNewFilter As String, strRightSQL As String<br>&nbsp;&nbsp;&amp;nbspSet qdf = rst.CopyQueryDef<br>&nbsp;&nbsp;&nbsp;' Try &quot;LastName LIKE 'D*'&quot;.<br>&nbsp;&nbsp;&amp;nbspstrNewFilter = InputBox(&quot;Enter new criteria&quot;)<br>&nbsp;&nbsp;&amp;nbspstrRightSQL = Right(qdf.SQL, 1)<br>&nbsp;&nbsp;&nbsp;' Strip characters from the end of the query,<br>&nbsp;&nbsp;&nbsp;' as needed.<br>&nbsp;&nbsp;&amp;nbspDo While strRightSQL = &quot; &quot; Or strRightSQL = &quot;;&quot; Or strRightSQL = vbCR Or _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspstrRightSQL = vbLF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspqdf.SQL = Left(qdf.SQL, Len(qdf.SQL) - 1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspstrRightSQL = Right(qdf.SQL, 1)<br>&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&amp;nbspqdf.SQL = qdf.SQL &amp; &quot; AND &quot; &amp; strNewFilter &amp; &quot;;&quot;<br>&nbsp;&nbsp;&amp;nbsprst.Requery qdf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Requery the Recordset.<br>&nbsp;&nbsp;&amp;nbsprst.MoveLast&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Populate the Recordset.<br>&nbsp;&nbsp;&nbsp;' &quot;Lastname LIKE 'D*'&quot; should return 2 records.<br>&nbsp;&nbsp;&amp;nbspMsgBox &quot;Number returned = &quot; &amp; rst.RecordCount<br>End Function</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>To use the <span CLASS="ElementNameeln">Requery</span> method, the<span CLASS="ElementNameeln"> Restartable </span>property of the <span CLASS="ElementNameeln">Recordset</span> object must be set to <span CLASS="ElementNameeln">True</span>. The <span CLASS="ElementNameeln">Restartable</span> property is always set to <span CLASS="ElementNameeln">True</span> when the <span CLASS="ElementNameeln">Recordset</span> is created from a query other than a crosstab query against tables in a Microsoft Access database. You can't restart SQL pass-through queries. You may or may not be able to restart queries against linked tables in another database format. To determine whether a <span CLASS="ElementNameeln">Recordset</span> object can rerun its query, check the <span CLASS="ElementNameeln">Restartable </span>property. For more information on the <span CLASS="ElementNameeln">Restartable</span> property, search the Help index for<span CLASS="ElementNameeln"> </span>&quot;Restartable property.&quot;</p>
<a NAME="6TheDAOSortandFilterProperties"></a>
<p CLASS="heading6OrgHeading4h4">The DAO Sort and Filter Properties</p>
<p CLASS="Textttext">Another approach to sorting and filtering <span CLASS="ElementNameeln">Recordset</span> objects is to set the DAO <span CLASS="ElementNameeln">Sort</span> and <span CLASS="ElementNameeln">Filter</span> properties on an existing <span CLASS="ElementNameeln">Recordset</span>, and then open a new <span CLASS="ElementNameeln">Recordset</span> from the existing one. However, this is usually much slower than just including the sort and filter criteria in the original query or changing the query parameters and running it again with the <span CLASS="ElementNameeln">Requery</span> method. The DAO <span CLASS="ElementNameeln">Sort </span>and <span CLASS="ElementNameeln">Filter</span> properties are useful when you want to allow a user to sort or restrict a result set, but the original data source is unavailable for a new query<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">for example, when a <span CLASS="ElementNameeln">Recordset </span>object variable is passed to a function, and the function must reorder records or restrict the records in the set. With this approach, performance is likely to be slow if the<span CLASS="ElementNameeln"> Recordset</span> has more than 100 records. Using the <span CLASS="ElementNameeln">CopyQueryDef </span>method described in the previous section is preferable.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the DAO <span CLASS="ElementNameeln">Sort </span>and <span CLASS="ElementNameeln">Filter</span> properties, search the Help index for the name of the property.</p>
<a NAME="4MovingThroughaRecordsetObject"></a>
<p CLASS="heading4OrgHeading2h2">Moving Through a Recordset Object</p>
<p CLASS="Textttext">A <span CLASS="ElementNameeln">Recordset </span>object usually has a <span CLASS="NewTermntrm">current position</span>, most often at a record. When you refer to the fields in a <span CLASS="ElementNameeln">Recordset</span>, you obtain values from the record at the current position, which is known as the <span CLASS="NewTermntrm">current record</span>. However, the current position can also be immediately before the first record in a <span CLASS="ElementNameeln">Recordset</span> or immediately after the last record. In certain circumstances, the current position is undefined.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on referring to fields, see <a HREF="../chapters/ba09_2.htm#4ReferringtoFieldObjects" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)">&quot;Referring to Field Objects&quot;</a> later in this chapter.</p>
<p CLASS="Textttext">You can use the following Move methods to loop through the records in a <span CLASS="ElementNameeln">Recordset</span>:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">MoveFirst</span> method moves to the first record.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">MoveLast</span> method moves to the last record.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">MoveNext</span> method moves to the next record.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">MovePrevious</span> method moves to the previous record.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">Move</span> [<span CLASS="NewTermntrm">n</span>] method moves forward or backward the number of records you specify in its syntax.</p>
<p CLASS="Textttext">You can use each of these methods on table-, dynaset-, and snapshot-type <span CLASS="ElementNameeln">Recordset </span>objects. On a forward-only-type <span CLASS="ElementNameeln">Recordset</span> object, you can use only the <span CLASS="ElementNameeln">MoveNext</span> and <span CLASS="ElementNameeln">Move</span> methods. If you use the <span CLASS="ElementNameeln">Move</span> method on a forward-only-type <span CLASS="ElementNameeln">Recordset</span>, the argument specifying the number of rows to move must be a positive integer.
<p CLASS="Textttext">The following example opens a <span CLASS="ElementNameeln">Recordset</span> object on the Employees table containing all of the records that have a <span CLASS="ElementNameeln">Null</span> value in the ReportsTo field. The function then updates the records to indicate that these employees are temporary employees. For each record in the <span CLASS="ElementNameeln">Recordset</span>, the example changes the Title and Notes fields, and saves the changes with the <span CLASS="ElementNameeln">Update</span> method. It uses the <span CLASS="ElementNameeln">MoveNext</span> method to move to the next record.</p>
<p CLASS="CodeTextct">Function UpdateEmployees()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rstEmployees As Recordset, strQuery As String<br>&nbsp;&nbsp;&amp;nbspDim intI As Integer<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&nbsp;' Open a recordset on all records from the Employees table that have<br>&nbsp;&nbsp;&nbsp;' a Null value in the ReportsTo field.<br>&nbsp;&nbsp;&amp;nbspstrQuery = &quot;SELECT * FROM Employees WHERE ReportsTo IS NULL;&quot;<br>&nbsp;&nbsp;&amp;nbspSet rstEmployees = dbs.OpenRecordset(strQuery, dbOpenDynaset)<br>&nbsp;&nbsp;&nbsp;' If the recordset is empty, exit.<br>&nbsp;&nbsp;&amp;nbspIf rstEmployees.EOF Then Exit Function<br>&nbsp;&nbsp;&amp;nbspintI = 1<br>&nbsp;&nbsp;&amp;nbspWith rstEmployees<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDo Until .EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Edit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![ReportsTo] = 5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![Title] = &quot;Temporary&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![Notes] = rstEmployees![Notes] &amp; &quot;Temp #&quot; &amp; intI<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Update<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.MoveNext<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintI = intI + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Close<br>&nbsp;&nbsp;&amp;nbspEnd With<br>&nbsp;&nbsp;&nbsp;<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span><span CLASS="EmSpaceems">The previous example is provided only for the purposes of illustrating the </span><span CLASS="ElementNameeln">Update</span><span CLASS="EmSpaceems"> and </span><span CLASS="ElementNameeln">MoveNext</span><span CLASS="EmSpaceems"> methods. It would be much faster to perform this bulk operation with an SQL UPDATE query.</span></p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the Move methods, search the Help index for &quot;Move.&quot;</p>
<a NAME="5DetectingtheLimitsofaRecordsetObject"></a>
<p CLASS="heading5OrgHeading3h3">Detecting the Limits of a Recordset Object</p>
<p CLASS="Textttext">In a <span CLASS="ElementNameeln">Recordset</span> object, if you try to move too far in one direction, a run-time error occurs. For example, if you try to use the <span CLASS="ElementNameeln">MoveNext</span> method when you're already beyond the end of the <span CLASS="ElementNameeln">Recordset</span>, a trappable error occurs. For this reason, it's helpful to know the limits of the <span CLASS="ElementNameeln">Recordset</span> object.
<p CLASS="Textttext">The <span CLASS="ElementNameeln">BOF</span> property indicates whether the current position is at the beginning of the <span CLASS="ElementNameeln">Recordset</span>. If <span CLASS="ElementNameeln">BOF</span> is <span CLASS="ElementNameeln">True</span>, the current position is before the first record in the <span CLASS="ElementNameeln">Recordset</span>. The <span CLASS="ElementNameeln">BOF </span>property is also <span CLASS="ElementNameeln">True </span>if there are no records in the <span CLASS="ElementNameeln">Recordset</span> when it's opened. Similarly, the <span CLASS="ElementNameeln">EOF </span>property is <span CLASS="ElementNameeln">True </span>if the current position is after the last record in the <span CLASS="ElementNameeln">Recordset</span>, or if there are no records.
<p CLASS="Textttext">The following example shows you how to use the <span CLASS="ElementNameeln">BOF</span> and <span CLASS="ElementNameeln">EOF </span>properties to detect the beginning and end of a <span CLASS="ElementNameeln">Recordset</span> object. This code fragment creates a table-type <span CLASS="ElementNameeln">Recordset </span>based on the Orders table from the current database. It moves through the records, first from the beginning of the <span CLASS="ElementNameeln">Recordset </span>to the end, and then from the end of the <span CLASS="ElementNameeln">Recordset </span>to the beginning.</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstOrders As Recordset<br>Set dbs = CurrentDb<br>Set rstOrders = dbs.OpenRecordset(&quot;Orders&quot;, dbOpenTable)<br>Do Until rstOrders.EOF<br>&nbsp;&nbsp;&nbsp;.<br>&nbsp;&nbsp;&nbsp;. ' Manipulate data.<br>&nbsp;&nbsp;&nbsp;.<br>&nbsp;&nbsp;&amp;nbsprstOrders.MoveNext&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Move to the next record.<br>Loop<br>rstOrders.MoveLast&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Move to the last record.<br>' Do Until beginning of file.<br>Do Until rstOrders.BOF<br>&nbsp;&nbsp;&nbsp;.<br>&nbsp;&nbsp;&nbsp;. ' Manipulate data.<br>&nbsp;&nbsp;&nbsp;.<br>&nbsp;&nbsp;&nbsp;' Move to the previous record.<br>&nbsp;&nbsp;&amp;nbsprstOrders.MovePrevious <br>Loop<br>rstOrders.Close&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Close the Recordset.</p>
<p CLASS="Textttext">Notice that there's no current record immediately following the first loop. The <span CLASS="ElementNameeln">BOF</span> and <span CLASS="ElementNameeln">EOF</span> properties both have the following characteristics:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspIf the <span CLASS="ElementNameeln">Recordset</span> contains no records when you open it, both <span CLASS="ElementNameeln">BOF</span> and <span CLASS="ElementNameeln">EOF</span> are <span CLASS="ElementNameeln">True</span>.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspWhen <span CLASS="ElementNameeln">BOF</span> or <span CLASS="ElementNameeln">EOF </span>is <span CLASS="ElementNameeln">True</span>, the property remains <span CLASS="ElementNameeln">True </span>until you move to an existing record, at which time the value of <span CLASS="ElementNameeln">BOF </span>or <span CLASS="ElementNameeln">EOF </span>becomes <span CLASS="ElementNameeln">False</span>.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspWhen <span CLASS="ElementNameeln">BOF</span> or <span CLASS="ElementNameeln">EOF </span>is <span CLASS="ElementNameeln">False</span>, and the only record in a <span CLASS="ElementNameeln">Recordset</span> is deleted, the property remains <span CLASS="ElementNameeln">False</span> until you try to move to another record, at which time both <span CLASS="ElementNameeln">BOF</span> and <span CLASS="ElementNameeln">EOF </span>become <span CLASS="ElementNameeln">True</span>.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspAt the moment you create or open a <span CLASS="ElementNameeln">Recordset</span> that contains at least one record, the first record is the current record, and both <span CLASS="ElementNameeln">BOF</span> and <span CLASS="ElementNameeln">EOF</span> are <span CLASS="ElementNameeln">False</span>.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspIf the first record is the current record when you use the <span CLASS="ElementNameeln">MovePrevious</span> method, <span CLASS="ElementNameeln">BOF</span> is set to <span CLASS="ElementNameeln">True</span>. If you use <span CLASS="ElementNameeln">MovePrevious</span> while <span CLASS="ElementNameeln">BOF</span> is <span CLASS="ElementNameeln">True</span>, a run-time error occurs. When this happens, <span CLASS="ElementNameeln">BOF</span> remains <span CLASS="ElementNameeln">True</span> and there is no current record.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspSimilarly, moving past the last record in the <span CLASS="ElementNameeln">Recordset</span> changes the value of the <span CLASS="ElementNameeln">EOF</span> property to <span CLASS="ElementNameeln">True</span>. If you use the <span CLASS="ElementNameeln">MoveNext</span> method while <span CLASS="ElementNameeln">EOF</span> is <span CLASS="ElementNameeln">True</span>, a run-time error occurs. When this happens, <span CLASS="ElementNameeln">EOF</span> remains <span CLASS="ElementNameeln">True</span> and there is no current record.</p>
<p CLASS="Textttext">The following illustration shows the settings of the <span CLASS="ElementNameeln">BOF </span>and<span CLASS="ElementNameeln"> EOF</span> properties for all possible current positions in a <span CLASS="ElementNameeln">Recordset</span>.
<p CLASS="ListArt1la"><img SRC="..\images\ABAC0901.jpg">
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the <span CLASS="ElementNameeln">BOF </span>and<span CLASS="ElementNameeln"> EOF</span> properties, search the Help index for &quot;BOF property&quot; and &quot;EOF property.&quot;</p>
<a NAME="5CountingtheNumberofRecordsinaRecordsetObject"></a>
<p CLASS="heading5OrgHeading3h3">Counting the Number of Records in a Recordset Object</p>
<p CLASS="Textttext">You may want to know the number of records in a <span CLASS="ElementNameeln">Recordset </span>object. For example, you may want to create a form that shows how many records are in each of the tables in a database. Or you may want to change the appearance of a form or report based on the number of records it includes.
<p CLASS="Textttext">The <span CLASS="ElementNameeln">RecordCount</span> property contains the number of records in a table-type <span CLASS="ElementNameeln">Recordset </span>or the total number of records accessed in a dynaset- or snapshot-type <span CLASS="ElementNameeln">Recordset</span>. A <span CLASS="ElementNameeln">Recordset</span> object with no records has a <span CLASS="ElementNameeln">RecordCount</span> property value of 0.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>The value of the <span CLASS="ElementNameeln">RecordCount</span> property equals the number of records that have actually been accessed. For example, when you first create a dynaset or snapshot, you have accessed (or visited) only one record. If you check the <span CLASS="ElementNameeln">RecordCount</span> property immediately after creating the dynaset or snapshot (assuming it has at least one record), the value is 1. To visit all the records, use the <span CLASS="ElementNameeln">MoveLast</span> method immediately after opening the <span CLASS="ElementNameeln">Recordset</span>, then use <span CLASS="ElementNameeln">MoveFirst</span> to return to the first record. This isn't done automatically because it may be slow, especially for large result sets.
<p CLASS="NoteTextnt">When you open a table-type <span CLASS="ElementNameeln">Recordset</span> object, you effectively visit all of the records in the underlying table, and the value of the <span CLASS="ElementNameeln">RecordCount</span> property totals the number of records in the table as soon as the <span CLASS="ElementNameeln">Recordset</span> is opened. Canceled transactions may make the value of the <span CLASS="ElementNameeln">RecordCount</span> property out-of-date in some multiuser situations. Compacting the database restores the table's record count to the correct value.</p>
<p CLASS="Textttext">The following example creates a snapshot-type <span CLASS="ElementNameeln">Recordset</span> object, and then determines the number of records in the <span CLASS="ElementNameeln">Recordset</span>:</p>
<p CLASS="CodeTextct">Function RecCount(strSQL As String) As Long<br>&nbsp;&nbsp;&amp;nbspDim rstCount As Recordset<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet rstCount = dbs.OpenRecordset(strSQL)<br>&nbsp;&nbsp;&amp;nbspIf rstCount.EOF Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstCount.Close<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspRecCount = 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstCount.MoveLast<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspRecCount = rstCount.RecordCount<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstCount.Close<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="Textttext">As your application deletes records in a dynaset-type <span CLASS="ElementNameeln">Recordset</span>, the value of the <span CLASS="ElementNameeln">RecordCount</span> property decreases. However, in a multiuser environment, records deleted by other users aren't reflected in the value of the <span CLASS="ElementNameeln">RecordCount</span> property until the current record is positioned on a deleted record. At that time, the setting of the <span CLASS="ElementNameeln">RecordCount</span> property decreases by one. Using the <span CLASS="ElementNameeln">Requery</span> method on a <span CLASS="ElementNameeln">Recordset</span>, followed by the <span CLASS="ElementNameeln">MoveLast</span> method, sets the <span CLASS="ElementNameeln">RecordCount</span> property to the current total number of records in the <span CLASS="ElementNameeln">Recordset</span>.
<p CLASS="Textttext">A snapshot-type <span CLASS="ElementNameeln">Recordset</span> object is static and the value of its <span CLASS="ElementNameeln">RecordCount</span> property doesn't change when you add or delete records in the snapshot's underlying table.</p>
<a NAME="5FindingtheCurrentPositioninaRecordsetObject"></a>
<p CLASS="heading5OrgHeading3h3">Finding the Current Position in a Recordset Object</p>
<p CLASS="Textttext">In some situations, you need to determine how far through a <span CLASS="ElementNameeln">Recordset</span> object you have moved the current record position, and perhaps indicate the current record position to a user. For example, you may want to indicate the current position on a dial, meter, or similar type of control. Two properties are available to indicate the current position: the <span CLASS="ElementNameeln">AbsolutePosition</span> property and the <span CLASS="ElementNameeln">PercentPosition</span> property.
<p CLASS="Textttext">The <span CLASS="ElementNameeln">AbsolutePosition</span> property value is the position of the current record relative to 0. However, don't think of this property as a record number; if the current record is undefined, the <span CLASS="ElementNameeln">AbsolutePosition</span> property returns - 1. In addition, there is no assurance that a record will have the same absolute position if the <span CLASS="ElementNameeln">Recordset</span> object is re-created because the order of individual records within a<span CLASS="ElementNameeln"> Recordset</span> object isn't guaranteed unless it's created with an SQL statement that includes an ORDER BY clause.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the <span CLASS="ElementNameeln">AbsolutePosition</span> property, see <a HREF="../chapters/ba09_1.htm#SBWhyUseBookmarksInsteadofRecordNumbers" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Why Use Bookmarks Instead of Record Numbers?&quot;</a> later in this chapter.</p>
<p CLASS="Textttext">The <span CLASS="ElementNameeln">PercentPosition</span> property shows the current position expressed as a percentage of the total number of records indicated by the <span CLASS="ElementNameeln">RecordCount </span>property. Because the <span CLASS="ElementNameeln">RecordCount</span> property doesn't reflect the total number of records in the <span CLASS="ElementNameeln">Recordset</span> object until the <span CLASS="ElementNameeln">Recordset</span> has been fully populated, the <span CLASS="ElementNameeln">PercentPosition</span> property only reflects the current record position as a percentage of the number of records that have been accessed since the <span CLASS="ElementNameeln">Recordset</span> was opened. To make sure that the <span CLASS="ElementNameeln">PercentPosition</span> property reflects the current record position relative to the entire <span CLASS="ElementNameeln">Recordset</span>, use the <span CLASS="ElementNameeln">MoveLast</span> and <span CLASS="ElementNameeln">MoveFirst</span> methods immediately after opening the <span CLASS="ElementNameeln">Recordset</span>. This fully populates the <span CLASS="ElementNameeln">Recordset</span> object before you use the <span CLASS="ElementNameeln">PercentPosition</span> property. If you have a large result set, using the <span CLASS="ElementNameeln">MoveLast </span>method may take a long time for <span CLASS="ElementNameeln">Recordsets</span> that aren't of type table.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>The <span CLASS="ElementNameeln">PercentPosition</span> property is only an approximation and shouldn't be used as a critical parameter. This property is best suited for driving an indicator that marks a user's progress while moving though a set of records. For example, you may want a control that indicates the percent of records completed. For more information on the <span CLASS="ElementNameeln">PercentPosition</span> property, search the Help index for &quot;PercentPosition property.&quot;</p>
<p CLASS="Textttext">The following example opens a <span CLASS="ElementNameeln">Recordset</span> object on a table called Employees. The procedure then moves through the Employees table and uses the <span CLASS="ElementNameeln">SysCmd</span> function to display a progress bar showing the percentage of the table that's been processed. If the hire date of the employee is before Jan. 1, 1993, the text &quot;Senior Staff&quot; is appended to the Notes field.</p>
<p CLASS="CodeTextct">Function PercentPos()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, strMsg As String, rstEmployees As Recordset, intRet As Integer<br>&nbsp;&nbsp;&amp;nbspDim intCount As Integer, strQuery As String, sngPercent As Single<br>&nbsp;&nbsp;&amp;nbspDim varReturn As Variant<br>&nbsp;&nbsp;&amp;nbspDim lngEmpID() As Long<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspstrQuery = &quot;SELECT * FROM Employees;&quot;<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet rstEmployees = dbs.OpenRecordset(strQuery, dbOpenDynaset)<br>&nbsp;&nbsp;&amp;nbspWith rstEmployees<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf .EOF Then&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' If no records, exit.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspstrMsg = &quot;Processing Employees table...&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintRet = SysCmd(acSysCmdInitMeter, strMsg, 100)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDo Until .EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf !HireDate &lt; #1/1/93# Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Edit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!Notes = !Notes &amp; &quot;;&quot; &amp; &quot;Senior Staff&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Update<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf .PercentPosition &lt;&gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintRet = SysCmd(acSysCmdUpdateMeter, .PercentPosition)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.MoveNext<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Close<br>&nbsp;&nbsp;&amp;nbspEnd With<br>&nbsp;&nbsp;&amp;nbspintRet = SysCmd(acSysCmdRemoveMeter)<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Clear progress meter.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspvarReturn = SysCmd(acSysCmdSetStatus, &quot; &quot;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on reading data in a field, see <a HREF="../chapters/ba09_2.htm#4ReadingandWritingData" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)">&quot;Reading and Writing Data&quot;</a> later in this chapter.</p>
<a NAME="4FindingaSpecificRecord"></a>
<p CLASS="heading4OrgHeading2h2">Finding a Specific Record</p>
<p CLASS="Textttext">The previous section, <a HREF="#4MovingThroughaRecordsetObject" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Moving Through a Recordset Object,&quot;</a> explores ways you can use the Move methods<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5"><span CLASS="ElementNameeln">MoveFirst</span>, <span CLASS="ElementNameeln">MoveLast</span>, <span CLASS="ElementNameeln">MoveNext</span>, <span CLASS="ElementNameeln">MovePrevious</span>, and <span CLASS="ElementNameeln">Move</span><img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">to loop through records in a <span CLASS="ElementNameeln">Recordset</span> object. However, in most cases it's more efficient to search for a specific record.
<p CLASS="Textttext">For example, you may want to find a particular employee based on an employee number, or you may want to find all of the detail records that belong to a specific order. In these cases, looping through all of the employee or order detail records could be time consuming. Instead, you can use the <span CLASS="ElementNameeln">Seek</span> method with table-type <span CLASS="ElementNameeln">Recordset</span> objects, and the Find methods with dynaset- and snapshot-type <span CLASS="ElementNameeln">Recordset</span> objects to locate records. Since the forward-only-type <span CLASS="ElementNameeln">Recordset </span>object doesn't support the <span CLASS="ElementNameeln">Seek</span> method or any of the Find methods, you cannot search for records in a forward-only-type <span CLASS="ElementNameeln">Recordset</span>.</p>
<a NAME="5FindingaRecordinaTableTypeRecordsetObject"></a>
<p CLASS="heading5OrgHeading3h3">Finding a Record in a Table-Type Recordset Object</p>
<p CLASS="Textttext">You use the <span CLASS="ElementNameeln">Seek</span> method to locate a record in a table-type <span CLASS="ElementNameeln">Recordset</span> object.
<p CLASS="Textttext">When you use the <span CLASS="ElementNameeln">Seek</span> method to locate a record, the Microsoft Jet database engine uses the table's current index, as defined by the <span CLASS="ElementNameeln">Index</span> property. </p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>If you use the <span CLASS="ElementNameeln">Seek</span> method on a table-type <span CLASS="ElementNameeln">Recordset</span> object without first setting the current index, a run-time error occurs.</p>
<p CLASS="Textttext">The syntax for the <span CLASS="ElementNameeln">Seek</span> method is:</p>
<p CLASS="SyntaxTextsyn"><span CLASS="NewTermntrm">table</span><span CLASS="ElementNameeln">.Seek</span> <span CLASS="Placeholderp">comparison, key1, key2 ...</span></p>
<p CLASS="Textttext">The <span CLASS="NewTermntrm">table</span> argument is the table-type <span CLASS="ElementNameeln">Recordset</span> object you're searching through. The <span CLASS="NewTermntrm">comparison</span> argument is a string that determines the kind of comparison that is being performed. The following table lists the comparison strings you can use with the <span CLASS="ElementNameeln">Seek</span> method.</p>
<!--mstheme--></font><table WIDTH="100%" BORDER="0" CELLPADDING="5" CELLSPACING="0" FRAME="VOID" RULES="THEAD"><thead>
<tr VALIGN="TOP" BGCOLOR="#DDDDDD">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Comparison string</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Description</p></font><!--mstheme--></font></td></tr><tbody>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">&quot;=&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Equal to the specified key values</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">&quot;&gt;=&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Greater than or equal to the specified key values</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">&quot;&gt;&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Greater than the specified key values</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">&quot;&lt;=&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Less than or equal to the specified key values</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">&quot;&lt;&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Less than the specified key values</p></font><!--mstheme--></font></td></tr>
</table><!--mstheme--><font face="book antiqua, times new roman, times">
<p CLASS="Textttext">The <span CLASS="NewTermntrm">keyn</span> arguments are a series of one or more values that correspond to the field or fields that make up the current index of the <span CLASS="ElementNameeln">Recordset</span>. Microsoft Jet compares these values to values in the corresponding fields of the <span CLASS="ElementNameeln">Recordset </span>object's records. 
<p CLASS="Textttext">The following example opens a table-type <span CLASS="ElementNameeln">Recordset</span> object called Employees, and uses the <span CLASS="ElementNameeln">Seek</span> method to locate the record containing a value of lngEmpID in the EmployeeID field. It returns the hire date for the specified employee.</p>
<p CLASS="CodeTextct">Function intGetHireDate(lngEmpID As Long, varHireDate As Variant) As Integer<br>&nbsp;&nbsp;&amp;nbspDim rstEmployees As Recordset, dbs As Database<br>&nbsp;&nbsp;&amp;nbspConst conFilePath As String = &quot;C:\Program Files\Microsoft Office\Office\Samples\&quot;<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = OpenDatabase(conFilePath &amp; &quot;Northwind&quot;)<br>&nbsp;&nbsp;&amp;nbspSet rstEmployees = dbs.OpenRecordset(&quot;Employees&quot;, dbOpenTable)<br>&nbsp;&nbsp;&amp;nbsprstEmployees.Index = &quot;PrimaryKey&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' The index name for Employee ID.<br>&nbsp;&nbsp;&amp;nbsprstEmployees.Seek &quot;=&quot;, lngEmpID<br>&nbsp;&nbsp;&amp;nbspIf rstEmployees.NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspvarHireDate = Null<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' The constants conErrNoMatch, conSuccess, and conFailed are defined at <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' the module level as public constants with Integer values of <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' -32,761, 0, and -32,737 respectively.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintGetHireDate = conErrNoMatch<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspvarHireDate = rstEmployees!HireDate<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintGetHireDate = conSuccess<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd If<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspvarHireDate = Null<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintGetHireDate = conFailed<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="Textttext">The <span CLASS="ElementNameeln">Seek</span> method always starts searching for records at the beginning of the <span CLASS="ElementNameeln">Recordset</span> object. If you use the <span CLASS="ElementNameeln">Seek</span> method with the same arguments more than once on the same <span CLASS="ElementNameeln">Recordset</span>, it finds the same record.
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">NoMatch</span> property on the <span CLASS="ElementNameeln">Recordset</span> object to test whether a record matching the search criteria was found. If the record matching the criteria was found, the <span CLASS="ElementNameeln">NoMatch</span> property will be <span CLASS="ElementNameeln">False</span>; otherwise it will be <span CLASS="ElementNameeln">True</span>.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the <span CLASS="ElementNameeln">NoMatch</span> property, search the Help index for &quot;NoMatch property.&quot;</p>
<p CLASS="Textttext">The following example illustrates how you can create a function that uses the <span CLASS="ElementNameeln">Seek</span> method to locate a record by using a multiple-field index:</p>
<p CLASS="CodeTextct">Function GetFirstPrice(lngOrderID As Long, lngProductID As Long) As Variant<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rstOrderDetail As Recordset<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet rstOrderDetail = dbs.OpenRecordset(&quot;Order Details&quot;, dbOpenTable)<br>&nbsp;&nbsp;&amp;nbsprstOrderDetail.Index = &quot;PrimaryKey&quot;<br>&nbsp;&nbsp;&amp;nbsprstOrderDetail.Seek &quot;=&quot;, lngOrderID, lngProductID<br>&nbsp;&nbsp;&amp;nbspIf rstOrderDetail.NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspGetFirstPrice = Null<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Couldn't find order detail record.&quot;<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspGetFirstPrice = rstOrderDetail!UnitPrice<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbsprstOrderDetail.Close<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="Textttext">In this example, the table's primary key consists of two fields: OrderID and ProductID. When you call the <span CLASS="ElementNameeln">GetFirstPrice</span> function with a valid (existing) combination of OrderID and ProductID field values, the function returns the unit price from the found record. If it can't find the combination of field values you want in the table, the function returns the <span CLASS="ElementNameeln">Null</span> value.
<p CLASS="Textttext">If the current index is a multiple-field index, trailing key values can be omitted and are treated as <span CLASS="ElementNameeln">Null </span>values. That is, you can leave off any number of key values from the end of a <span CLASS="ElementNameeln">Seek</span> method's <span CLASS="NewTermntrm">key</span> argument, but not from the beginning or the middle. However, if you don't specify all values in the index, you can use only the &quot;&gt;&quot; or &quot;&lt;&quot; comparison string with the <span CLASS="ElementNameeln">Seek</span> method.</p>
<a NAME="5FindingaRecordinaDynasetorSnapshotTypeRecordsetObject"></a>
<p CLASS="heading5OrgHeading3h3">Finding a Record in a Dynaset- or Snapshot-Type Recordset Object</p>
<p CLASS="Textttext">You can use the Find methods to locate a record in a dynaset- or snapshot-type <span CLASS="ElementNameeln">Recordset</span> object. DAO provides four Find methods:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">FindFirst</span> method finds the first record satisfying the specified criteria.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">FindLast</span> method finds the last record satisfying the specified criteria.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">FindNext</span> method finds the next record satisfying the specified criteria.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspThe <span CLASS="ElementNameeln">FindPrevious</span> method finds the previous record satisfying the specified criteria. </p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>To locate a record in a table-type <span CLASS="ElementNameeln">Recordset</span> object, use the <span CLASS="ElementNameeln">Seek</span> method, which is described in the previous section.</p>
<p CLASS="Textttext">When you use the Find methods, you specify the search criteria; typically an expression equating a field name with a specific value.
<p CLASS="Textttext">You can locate the matching records in reverse order by finding the last occurrence with the <span CLASS="ElementNameeln">FindLast</span> method and then using the <span CLASS="ElementNameeln">FindPrevious</span> method instead of the <span CLASS="ElementNameeln">FindNext </span>method.
<p CLASS="Textttext">DAO sets the <span CLASS="ElementNameeln">NoMatch</span> property to <span CLASS="ElementNameeln">True</span> whenever a Find method fails and the current record position is undefined. There may be a current record, but you have no way to tell which one. If you want to be able to return to the previous current record following a failed Find method, use a bookmark.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on bookmarks, see the following section <a HREF="../chapters/ba09_1.htm#5MarkingRecordPositionwithBookmarks" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Marking Record Position with Bookmarks.&quot;</a></p>
<p CLASS="Textttext">The<span CLASS="ElementNameeln"> NoMatch</span> property is <span CLASS="ElementNameeln">False</span> whenever the operation succeeds. In this case, the current record position is the record found by one of the Find methods.
<p CLASS="Textttext">The following example illustrates how you can use the <span CLASS="ElementNameeln">FindNext</span> method to find all orders in the Orders table that have no corresponding records in the Order Details table and adds the value in the OrderID field to the array lngOrderID().</p>
<p CLASS="CodeTextct">Function FindEx(lngOrderID() As Long)<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rstOrders As Recordset<br>&nbsp;&nbsp;&amp;nbspDim strQuery As String, rstOrderDetails As Recordset<br>&nbsp;&nbsp;&amp;nbspDim intIndex As Integer<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&nbsp;' Open recordsets on the Orders and Order Details tables. If there are no<br>&nbsp;&nbsp;&nbsp;' records in either table, exit the function.<br>&nbsp;&nbsp;&amp;nbspstrQuery = &quot;SELECT * FROM Orders ORDER BY OrderID;&quot;<br>&nbsp;&nbsp;&amp;nbspSet rstOrders = dbs.OpenRecordset(strQuery, dbOpenSnapshot)<br>&nbsp;&nbsp;&amp;nbspIf rstOrders.EOF Then Exit Function<br>&nbsp;&nbsp;&amp;nbspstrQuery = &quot;SELECT * FROM [Order Details] ORDER BY OrderID;&quot;<br>&nbsp;&nbsp;&amp;nbspSet rstOrderDetails = dbs.OpenRecordset(strQuery, dbOpenSnapshot)<br>&nbsp;&nbsp;&nbsp;' For the first record in Orders, find the first matching record<br>&nbsp;&nbsp;&nbsp;' in OrderDetails. If no match, redimension the array of order IDs and<br>&nbsp;&nbsp;&nbsp;' add the order ID to the array.<br>&nbsp;&nbsp;&amp;nbsprstOrderDetails.FindFirst &quot;OrderID = &quot; &amp; rstOrders![OrderID]<br>&nbsp;&nbsp;&amp;nbspIf rstOrderDetails.NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspReDim Preserve lngOrderID(1 To intIndex)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsplngOrderID(intIndex) = rstOrders![OrderID]<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;' The first match has already been found, so use the FindNext method to find the<br>&nbsp;&nbsp;&nbsp;' next record satisfying the criteria.<br>&nbsp;&nbsp;&amp;nbspintIndex = 0<br>&nbsp;&nbsp;&amp;nbspDo Until rstOrders.EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstOrderDetails.FindNext &quot;OrderID = &quot; &amp; rstOrders![OrderID]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf rstOrderDetails.NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintIndex = intIndex + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspReDim Preserve lngOrderID(1 To intIndex)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsplngOrderID(intIndex) = rstOrders![OrderID]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstOrders.MoveNext<br>&nbsp;&nbsp;&amp;nbspLoop<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function
<p CLASS="TipIcontpi"></p>
<p CLASS="TipTexttpt"><span CLASS="TipHeadingtph">Tip&nbsp;&nbsp;&nbsp;</span>If you need to frequently search records in a dynaset, you may find it easier to create a temporary indexed table and use the <span CLASS="ElementNameeln">Seek</span> method instead.</p>
<a NAME="5MarkingRecordPositionwithBookmarks"></a>
<p CLASS="heading5OrgHeading3h3">Marking Record Position with Bookmarks</p>
<p CLASS="Textttext">A <span CLASS="NewTermntrm">bookmark</span> is a system-generated <span CLASS="ElementNameeln">Byte</span> array that uniquely identifies each record. The DAO <span CLASS="ElementNameeln">Bookmark</span> property of a <span CLASS="ElementNameeln">Recordset </span>object changes each time you move to a new record. To identify a record, move to that record and then assign the value of the DAO<span CLASS="ElementNameeln"> Bookmark </span>property to a variable of type <span CLASS="ElementNameeln">Variant</span>. To return to the record, set the DAO <span CLASS="ElementNameeln">Bookmark</span> property to the value of the variable.
<p CLASS="Textttext">The following example illustrates how you can use a bookmark to save the current record position. You can then perform other operations on the <span CLASS="ElementNameeln">Recordset</span> object, and then return to the saved record position.</p>
<p CLASS="CodeTextct">Function BookMarkEx() As Integer<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rstProducts As Recordset<br>&nbsp;&nbsp;&amp;nbspDim vBookMark As Variant, sngRevenue As Single<br>&nbsp;&nbsp;&amp;nbspDim strQuery As String, rstCategories As Recordset, strCriteria As String<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrHandler<br>&nbsp;&nbsp;&amp;nbspBookMarkEx = 0<br>&nbsp;&nbsp;&amp;nbspstrQuery = &quot;SELECT * FROM Products WHERE UnitsOnOrder &gt;= 40 ORDER BY &quot; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp; &quot;CategoryID, UnitsOnOrder DESC;&quot;<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet rstProducts = dbs.OpenRecordset(strQuery, dbOpenSnapshot)<br>&nbsp;&nbsp;&amp;nbspSet rstCategories = dbs.OpenRecordset(&quot;SELECT CategoryID FROM &quot; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp; &quot;Categories ORDER BY CategoryID;&quot;, dbOpenSnapshot)<br>&nbsp;&nbsp;&amp;nbspIf rstProducts.NoMatch Then Exit Function<br>&nbsp;&nbsp;&nbsp;' For each category find the product generating the least revenue <br>&nbsp;&nbsp;&nbsp;' and the product generating the most revenue.<br>&nbsp;&nbsp;&amp;nbspDo Until rstCategories.EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspstrCriteria = &quot;CategoryID = &quot; &amp; rstCategories![CategoryID]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstProducts.FindFirst strCriteria<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspsngRevenue = rstProducts![UnitPrice] * rstProducts![UnitsOnOrder]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf Not rstProducts.NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Set a bookmark at the first record containing the CategoryID.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspvBookMark = rstProducts.Bookmark<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Find the product generating the most revenue.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDo While rstProducts![CategoryID] = rstCategories![CategoryID]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf rstProducts![UnitPrice] * rstProducts![UnitsOnOrder] &gt; sngRevenue Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspsngRevenue = rstProducts![UnitPrice] * rstProducts![UnitsOnOrder]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstProducts.MoveNext<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Move to the first record containing the CategoryID.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstProducts.Bookmark = vBookMark<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspsngRevenue = rstProducts![UnitPrice] * rstProducts![UnitsOnOrder]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Find the product generating the least revenue.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDo While rstProducts![CategoryID] = rstCategories![CategoryID]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf rstProducts![UnitPrice] * rstProducts![UnitsOnOrder] &lt; sngRevenue Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspsngRevenue = rstProducts![UnitPrice] * rstProducts![UnitsOnOrder]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstProducts.MoveNext<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstCategories.MoveNext<br>&nbsp;&nbsp;&amp;nbspLoop<br>' Error Handler.<br>ErrHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="Textttext">A bookmark is particularly useful if a method fails because the current record position is undefined.
<p CLASS="Textttext">The <span CLASS="ElementNameeln">LastModified</span> property of the <span CLASS="ElementNameeln">Recordset</span> object provides a good illustration of how to use a bookmark. The <span CLASS="ElementNameeln">LastModified</span> property returns the bookmark of the last record in the <span CLASS="ElementNameeln">Recordset</span> to be added or modified. To use it, set the DAO <span CLASS="ElementNameeln">Bookmark </span>property equal to the <span CLASS="ElementNameeln">LastModified</span> property, as follows:</p>
<p CLASS="CodeTextct">rstCustomers.Bookmark = rstCustomers.LastModified</p>
<p CLASS="Textttext">This moves the current record position to the last record that was added or modified. This is particularly useful when adding new records, because after you add a new record, the current record is the one you were on before you added the record. With the <span CLASS="ElementNameeln">LastModified</span> property, you can move to the newly added record if that's what your application expects.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on adding new records, see <a HREF="../chapters/ba09_1.htm#5AddingaNewRecord" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Adding a New Record&quot;</a> later in this chapter.</p>
<a NAME="6BookmarkScope"></a>
<p CLASS="heading6OrgHeading4h4">Bookmark Scope</p>
<p CLASS="Textttext">When you close a <span CLASS="ElementNameeln">Recordset</span> object, any bookmarks you saved become invalid. You can't use a bookmark from one <span CLASS="ElementNameeln">Recordset</span> in another <span CLASS="ElementNameeln">Recordset</span>, even if both <span CLASS="ElementNameeln">Recordset</span> objects are based on the same underlying table or query. However, you can use a bookmark on the clone of a <span CLASS="ElementNameeln">Recordset</span>, as shown in the following example:</p>
<p CLASS="CodeTextct">Dim dbs As Database<br>Dim rstOriginal As Recordset, rstDuplicate As Recordset<br>Dim strPlaceholder As String<br>Set dbs = CurrentDb<br>' Create the first Recordset.<br>Set rstOriginal = dbs.OpenRecordset(&quot;Orders&quot;, dbOpenDynaset)<br>' Save the current record position.<br>strPlaceholder = rstOriginal.Bookmark<br>' Create a duplicate Recordset.<br>Set rstDuplicate = rstOriginal.Clone()<br>' Go to same record.<br>rstDuplicate.Bookmark = strPlaceholder<br>rstOriginal.Close</p>
<p CLASS="Textttext">You can also use the DAO <span CLASS="ElementNameeln">Bookmark</span> property on the <span CLASS="ElementNameeln">Recordset</span> object underlying a form. With this property, your code can mark which record is currently displayed on the form, and then change the record that is being displayed. For example, on a form containing employee information, you may want a button that a user can click to show the record for an employee's supervisor. The following example illustrates the event procedure you would use for the button's Click event:</p>
<p CLASS="CodeTextct">Private Sub cmdShowSuper_Click()<br>&nbsp;&nbsp;&amp;nbspDim frmEmployees As Form<br>&nbsp;&nbsp;&amp;nbspDim rstEmployees As Recordset<br>&nbsp;&nbsp;&amp;nbspDim strOrigin As String<br>&nbsp;&nbsp;&amp;nbspDim strEmployee As String<br>&nbsp;&nbsp;&amp;nbspDim strSuper As String<br>&nbsp;&nbsp;&amp;nbspSet frmEmployees = Screen.ActiveForm<br>&nbsp;&nbsp;&nbsp;' Open the Recordset.<br>&nbsp;&nbsp;&amp;nbspSet rstEmployees = frmEmployees.RecordsetClone<br>&nbsp;&nbsp;&amp;nbspstrOrigin = frmEmployees.Bookmark<br>&nbsp;&nbsp;&amp;nbspstrEmployee = frmEmployees!FirstName &amp; &quot; &quot; &amp; frmEmployees!LastName<br>&nbsp;&nbsp;&amp;nbsprstEmployees.FindFirst &quot;EmployeeID = &quot; &amp; frmEmployees!ReportsTo<br>&nbsp;&nbsp;&amp;nbspIf rstEmployees.NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Couldn't find &quot; &amp; strEmployee &amp; &quot;'s supervisor.&quot;<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspfrmEmployees.Bookmark = rstEmployees.Bookmark<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspstrSuper = frmEmployees!FirstName &amp; &quot; &quot; &amp; frmEmployees!LastName<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox strEmployee &amp; &quot;'s supervisor is &quot; &amp; strSuper<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspfrmEmployees.Bookmark = strOrigin<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbsprstEmployees.Close<br>End Sub</p>
<!--mstheme--></font><table CELLPADDING="3" BORDER="2" BORDERCOLOR="#0000FF" bordercolordark="#660000" bordercolorlight="#CC9966"><tr BGCOLOR="#FFFFFF"><td><!--mstheme--><font face="book antiqua, times new roman, times">
<a NAME="SBWhyUseBookmarksInsteadofRecordNumbers"></a>
<p CLASS="SidebarHeadingsbrh">Why Use Bookmarks Instead of Record Numbers?</p>
<p CLASS="SidebarTextsbrt">If you have used another database or programming environment, you may be accustomed to referring to record numbers. For example, you may have written code that opens a text file and thereafter refers to specific records by their relative position in the file. The first record in the file would be record 1, the second would be record 2, and so on.
<p CLASS="SidebarTextsbrt">In Microsoft Access databases, your view of records (a <span CLASS="ElementNameeln">Recordset</span>) is usually a subset of the records in one or more tables. Because the actual number of records in a <span CLASS="ElementNameeln">Recordset</span> can change at any time, especially in a multiuser environment, there's no absolute record number you can always use to refer to a particular record. The <span CLASS="ElementNameeln">AbsolutePosition</span> property isn't the same as a record number, because this property changes if a lower-numbered record is deleted.
<p CLASS="SidebarTextsbrt">Furthermore, records returned in a <span CLASS="ElementNameeln">Recordset</span> object appear in no particular order, unless the <span CLASS="ElementNameeln">Recordset</span> was created with a query that includes an ORDER BY clause, or is a table-type <span CLASS="ElementNameeln">Recordset </span>with an index. Record numbers are usually meaningless in a <span CLASS="ElementNameeln">Recordset</span> object.
<p CLASS="SidebarTextsbrt">Instead of record numbers, DAO provides bookmarks to uniquely identify a particular record. A given record retains its unique bookmark for the life of the <span CLASS="ElementNameeln">Recordset</span>.</p><!--mstheme--></font></td></tr></table><!--mstheme--><font face="book antiqua, times new roman, times">
<a NAME="6WhichRecordsetObjectsDontSupportBookmarks"></a>
<p CLASS="heading6OrgHeading4h4">Which Recordset Objects Don't Support Bookmarks?</p>
<p CLASS="Textttext">Dynasets based on certain linked tables, such as Paradox tables that have no primary key, don't support bookmarks, nor do forward-only-type <span CLASS="ElementNameeln">Recordset </span>objects.
<p CLASS="Textttext">You can determine whether a given <span CLASS="ElementNameeln">Recordset </span>object supports bookmarks by checking the value of the <span CLASS="ElementNameeln">Bookmarkable</span> property, as in the following example:</p>
<p CLASS="CodeTextct">If rstLinkedTable.Bookmarkable Then<br>&nbsp;&nbsp;&amp;nbspMsgBox &quot;The underlying table supports bookmarks.&quot;<br>Else<br>&nbsp;&nbsp;&amp;nbspMsgBox &quot;The underlying table doesn't support bookmarks.&quot;<br>End If</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>If you try to use bookmarks on a <span CLASS="ElementNameeln">Recordset</span> object that doesn't support bookmarks, a run-time error occurs.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the <span CLASS="ElementNameeln">Bookmarkable</span> property, search the Help index for &quot;Bookmarkable property.&quot;</p>
<a NAME="4ChangingData"></a>
<p CLASS="heading4OrgHeading2h2">Changing Data</p>
<p CLASS="Textttext">After you've created a table- or dynaset-type<span CLASS="ElementNameeln"> Recordset </span>object, you can change, delete, or add new records. You can't change, delete, or add records to a snapshot-type or forward-only-type <span CLASS="ElementNameeln">Recordset</span> object.
<p CLASS="Textttext">This section presents the methods and procedures for changing data in table- and dynaset-type <span CLASS="ElementNameeln">Recordset</span> objects.</p>
<a NAME="5UsingParameterQueries"></a>
<p CLASS="heading5OrgHeading3h3">Using Parameter Queries</p>
<p CLASS="Textttext">A <span CLASS="NewTermntrm">parameter query</span> is a query that when run displays a dialog box that prompts the user for information, such as criteria for retrieving records or a value to insert in a field. You can use stored parameter queries to accomplish most of the database maintenance tasks described in the rest of this chapter.
<p CLASS="Textttext">In many situations, you'll want a user or another procedure to provide parameters you can use with your stored queries and <span CLASS="ElementNameeln">Recordset</span> objects. Microsoft Jet provides the means to do this. First, create a stored query, specifying which parameters the user needs to provide. When you open a <span CLASS="ElementNameeln">Recordset</span> against one of these queries, the application opens a dialog box that prompts the user to enter a value, such as the criteria for a WHERE clause or the field on which to sort the selected records.
<p CLASS="Textttext">The following example takes two strings that represent dates and creates a parameter query that returns all records in the Orders table whose order date is between the two dates. It adds all values in the OrderID field in the query's recordset to an array.</p>
<p CLASS="CodeTextct">Function OrdersFromTo(strDateFrom As Variant, strDateTo As Variant, _<br>&nbsp;&nbsp;&amp;nbsplngOrderIDs() As Long)<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rstOrders As Recordset<br>&nbsp;&nbsp;&amp;nbspDim qdf As QueryDef, strSQL As String, intI As Integer<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspstrSQL = &quot;PARAMETERS [DateFrom] DateTime, [DateTo] DateTime; &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;SELECT * FROM Orders WHERE OrderDate BETWEEN &quot;<br>&nbsp;&nbsp;&amp;nbspstrSQL = strSQL &amp; &quot;[DateFrom] AND [DateTo];&quot;<br>&nbsp;&nbsp;&nbsp;' Create an unstored parameter query.<br>&nbsp;&nbsp;&amp;nbspSet qdf = dbs.CreateQueryDef(&quot;&quot;, strSQL)<br>&nbsp;&nbsp;&nbsp;' Set the query parameters.<br>&nbsp;&nbsp;&amp;nbspqdf.Parameters(&quot;DateFrom&quot;) = strDateFrom<br>&nbsp;&nbsp;&amp;nbspqdf.Parameters(&quot;DateTo&quot;) = strDateTo<br>&nbsp;&nbsp;&nbsp;' Open a forward-only snapshot on the query.<br>&nbsp;&nbsp;&amp;nbspSet rstOrders = qdf.OpenRecordset(dbOpenSnapshot, dbForwardOnly)<br>&nbsp;&nbsp;&nbsp;' Load all the OrderIDs in the query into an array that the caller<br>&nbsp;&nbsp;&nbsp;' of the function can use.<br>&nbsp;&nbsp;&amp;nbspintI = 1<br>&nbsp;&nbsp;&amp;nbspWhile rstOrders.EOF = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspReDim lngOrderIDs(1 To intI)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsplngOrderIDs(intI) = rstOrders!OrderID<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintI = intI + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstOrders.MoveNext<br>&nbsp;&nbsp;&amp;nbspWend<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on parameter queries, search the Help index for &quot;parameter queries.&quot;</p>
<a NAME="5MakingBulkChanges"></a>
<p CLASS="heading5OrgHeading3h3">Making Bulk Changes</p>
<p CLASS="Textttext">Many of the changes you may otherwise perform in a loop can be done more efficiently with an update or delete query. The following example creates a <span CLASS="ElementNameeln">QueryDef</span> object to update the Employees table and then runs the query:</p>
<p CLASS="CodeTextct">Dim dbs As Database, qdfChangeTitles As QueryDef<br>Set dbs = CurrentDb<br>Set qdfChangeTitles = dbs.CreateQueryDef(&quot;&quot;)<br>qdfChangeTitles.SQL = &quot;UPDATE Employees SET Title = 'Account Executive' &quot; _<br>&nbsp;&nbsp;&nbsp;&amp; &quot;WHERE Title = 'Sales Representative';&quot;<br>qdfChangeTitles.Execute dbFailOnError&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Invoke query.</p>
<p CLASS="Textttext">You can replace the entire SQL string in this example with a stored parameter query, in which case the procedure would prompt the user for parameter values. The following example shows how the previous example may be rewritten as a stored parameter query:</p>
<p CLASS="CodeTextct">Dim dbs As Database, qdfChangeTitles As QueryDef<br>Dim strSQLUpdate As String, strOld As String<br>Dim strNew As String<br>Set dbs = CurrentDb<br>strSQLUpdate = &quot;PARAMETERS [Old Title] Text, [New Title] Text; &quot; _<br>&nbsp;&nbsp;&nbsp;&amp; &quot;UPDATE Employees SET Title = [New Title] WHERE Title = [Old Title];&quot;<br>' Create the QueryDef object.<br>Set qdfChangeTitles = dbs.CreateQueryDef(&quot;&quot;, strSQLUpdate)<br>' Prompt for old title.<br>strOld = InputBox(&quot;Enter old job title&quot;)<br>' Prompt for new title.<br>strNew = InputBox(&quot;Enter new job title&quot;)<br>' Set parameters.<br>qdfChangeTitles.Parameters(&quot;Old Title&quot;) = strOld<br>qdfChangeTitles.Parameters(&quot;New Title&quot;) = strNew<br>' Invoke query.<br>qdfChangeTitles.Execute</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>A delete query is more efficient than code that loops through records looking for records to delete, especially with databases created in Microsoft Access for Windows 95 or later.</p>
<a NAME="5ModifyinganExistingRecord"></a>
<p CLASS="heading5OrgHeading3h3">Modifying an Existing Record</p>
<p CLASS="Textttext">You can modify existing records in a table- or dynaset-type <span CLASS="ElementNameeln">Recordset</span> object by using the <span CLASS="ElementNameeln">Edit</span> and <span CLASS="ElementNameeln">Update</span> methods.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To modify an existing record in a table- or dynaset-type Recordset object</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspGo to the record that you want to change.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">Edit</span> method to prepare the current record for editing.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspMake the necessary changes to the record.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">Update</span> method to save the changes to the current record.</p>
<p CLASS="Textttext">The following example illustrates how to change the job titles for all sales representatives in a table called Employees:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstEmployees As Recordset<br>Set dbs = CurrentDb<br>Set rstEmployees = dbs.OpenRecordset(&quot;Employees&quot;)<br>rstEmployees.MoveFirst<br>Do Until rstEmployees.EOF<br>&nbsp;&nbsp;&amp;nbspIf rstEmployees!Title = &quot;Sales Representative&quot; Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmployees.Edit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmployees!Title = &quot;Account Executive&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmployees.Update<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbsprstEmployees.MoveNext<br>Loop<br>rstEmployees.Close</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>If you don't use the <span CLASS="ElementNameeln">Edit</span> method before you try to change a value in the current record, a run-time error occurs.
 If you edit the current record and then move to another record or close the <span CLASS="ElementNameeln">Recordset</span> object without first using the <span CLASS="ElementNameeln">Update</span> method, your changes are lost without warning. For example, omitting the <span CLASS="ElementNameeln">Update</span> method from the preceding example results in no changes being made to the Employees table.</p>
<p CLASS="Textttext">You can also terminate the <span CLASS="ElementNameeln">Edit</span> method and any pending transactions without saving changes by using the <span CLASS="ElementNameeln">CancelUpdate </span>method. While you can terminate the <span CLASS="ElementNameeln">Edit </span>method just by moving off the current record, this isn't practical when the current record is the first or last record in the <span CLASS="ElementNameeln">Recordset</span>, or is a new record. It's generally simpler to use the <span CLASS="ElementNameeln">CancelUpdate</span> method.</p>
<!--mstheme--></font><table CELLPADDING="3" BORDER="2" BORDERCOLOR="#0000FF" bordercolordark="#660000" bordercolorlight="#CC9966"><tr BGCOLOR="#FFFFFF"><td><!--mstheme--><font face="book antiqua, times new roman, times">
<a NAME="SBInconsistentUpdates"></a>
<p CLASS="SidebarHeadingsbrh">Inconsistent Updates</p>
<p CLASS="SidebarTextsbrt">Dynaset-type <span CLASS="ElementNameeln">Recordset</span> objects can be based on a multiple-table query containing tables with a one-to-many relationship. For example, suppose you want to create a multiple-table query that combines fields from the Orders and Order Details tables. Generally speaking, you can't change values in the Orders table because it's on the &quot;one&quot; side of the relationship. Depending on your application, however, you may want to be able to make changes to the Orders table. To make it possible to freely change the values on the &quot;one&quot; side of a one-to-many relationship, use the <span CLASS="ElementNameeln">dbInconsistent</span> constant of the <span CLASS="ElementNameeln">OpenRecordset</span> method to create an inconsistent dynaset. For example:
<p CLASS="SidebarTextsbrt"><span CLASS="CodeTextFeaturedElementctfe">Set</span><span CLASS="CodeTextEmbeddedcte"> rstTotalSales = dbs.OpenRecordset(&quot;Sales Totals&quot; ,, _<br>&nbsp;&nbsp;&amp;nbspdbInconsistent)</span>
<p CLASS="SidebarTextsbrt">When you update an inconsistent dynaset, you can easily destroy the referential integrity of the data in the dynaset. You must take care to understand how the data is related across the one-to-many relationship and to update the values on both sides in a way that preserves data integrity.
<p CLASS="SidebarTextsbrt">The <span CLASS="ElementNameeln">dbInconsistent</span> constant is available only for dynaset-type <span CLASS="ElementNameeln">Recordset</span> objects. It's ignored for table-, snapshot-, and forward-only-type <span CLASS="ElementNameeln">Recordset</span> objects, but no compile or run-time error is returned if the <span CLASS="ElementNameeln">dbInconsistent</span> constant is used with those types of <span CLASS="ElementNameeln">Recordset</span> objects. 
<p CLASS="SidebarTextsbrt">Even with an inconsistent <span CLASS="ElementNameeln">Recordset</span>, some fields may not be updatable. For example, you can't change the value of an AutoNumber field, and a <span CLASS="ElementNameeln">Recordset</span> based on certain linked tables may not be updatable.</p><!--mstheme--></font></td></tr></table><!--mstheme--><font face="book antiqua, times new roman, times">
<a NAME="5DeletinganExistingRecord"></a>
<p CLASS="heading5OrgHeading3h3">Deleting an Existing Record</p>
<p CLASS="Textttext">You can delete an existing record in a table- or dynaset-type <span CLASS="ElementNameeln">Recordset</span> object by using the <span CLASS="ElementNameeln">Delete</span> method. You can't delete records from a snapshot-type <span CLASS="ElementNameeln">Recordset</span> object. The following example deletes all the duplicate records in the Shippers table:</p>
<p CLASS="CodeTextct">Function DeleteDuplicateShippers() As Integer<br>&nbsp;&nbsp;&amp;nbspDim rstShippers As Recordset, strQuery As String, dbs As Database, strName As String<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&amp;nbspstrQuery = &quot;SELECT * FROM Shippers ORDER BY CompanyName;&quot;<br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet rstShippers = dbs.OpenRecordset(strQuery, dbOpenDynaset)<br>&nbsp;&nbsp;&nbsp;' If no records in Shippers table, exit.<br>&nbsp;&nbsp;&amp;nbspIf rstShippers.EOF Then Exit Function<br>&nbsp;&nbsp;&amp;nbspstrName = rstShippers![CompanyName]<br>&nbsp;&nbsp;&amp;nbsprstShippers.MoveNext<br>&nbsp;&nbsp;&amp;nbspDo Until rstShippers.EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf rstShippers![CompanyName] = strName Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstShippers.Delete<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspstrName = rstShippers![CompanyName]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstShippers.MoveNext<br>&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&nbsp;<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' The constants conSuccess and conFailed are defined at<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' the module level as public constants with Integer values of<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' 0 and -32,737 respectively.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDeleteDuplicateShippers = conSuccess<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDeleteDuplicateShippers = conFailed<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="Textttext">When you use the <span CLASS="ElementNameeln">Delete</span> method, Microsoft Jet immediately deletes the current record without any warning or prompting. Deleting a record doesn't automatically cause the next record to become the current record; to move to the next record you must use the <span CLASS="ElementNameeln">MoveNext</span> method. However, keep in mind that after you've moved off the deleted record, you cannot move back to it.
<p CLASS="Textttext">If you try to access a record after deleting it on a table-type <span CLASS="ElementNameeln">Recordset</span>, you'll get error 3167, &quot;Record is deleted.&quot; On a dynaset, you'll get error 3021, &quot;No current record.&quot;
<p CLASS="Textttext">If you have a <span CLASS="ElementNameeln">Recordset</span> clone positioned at the deleted record and you try to read its value, you'll get error 3167 regardless of the type of <span CLASS="ElementNameeln">Recordset</span> object. Trying to use a bookmark to move to a deleted record will also result in error 3167.</p>
<a NAME="5AddingaNewRecord"></a>
<p CLASS="heading5OrgHeading3h3">Adding a New Record</p>
<p CLASS="Textttext">You can add a new record to a table- or dynaset-type <span CLASS="ElementNameeln">Recordset </span>object by using the <span CLASS="ElementNameeln">AddNew</span> method.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To add a new record to a table- or dynaset-type Recordset object</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">AddNew</span> method to create a new record you can edit.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspAssign values to each of the record's fields.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">Update</span> method to save the new record.</p>
<p CLASS="Textttext">The following example adds a new record to a table-type <span CLASS="ElementNameeln">Recordset </span>called Shippers:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstShippers As Recordset<br>Set dbs = CurrentDb<br>Set rstShippers = dbs.OpenRecordset(&quot;Shippers&quot;)<br>rstShippers.AddNew<br>rstShippers!CompanyName = &quot;Global Parcel Service&quot;<br>&nbsp;&nbsp;&nbsp;.<br>&nbsp;&nbsp;&nbsp;. ' Set remaining fields.<br>&nbsp;&nbsp;&nbsp;.<br>rstShippers.Update<br>rstShippers.Close</p>
<p CLASS="Textttext">When you use the <span CLASS="ElementNameeln">AddNew</span> method, Microsoft Jet prepares a new, blank record and makes it the current record. When you use the <span CLASS="ElementNameeln">Update</span> method to save the new record, the record that was current before you used the <span CLASS="ElementNameeln">AddNew</span> method<span CLASS="ElementNameeln"> </span>becomes the current record again.
<p CLASS="Textttext">The new record's position in the <span CLASS="ElementNameeln">Recordset</span> depends on whether you added the record to a dynaset- or a table-type <span CLASS="ElementNameeln">Recordset</span> object. If you add a record to a dynaset-type<span CLASS="ElementNameeln"> Recordset</span>, the new record appears at the end of the <span CLASS="ElementNameeln">Recordset</span>, no matter how the <span CLASS="ElementNameeln">Recordset</span> is sorted. To force the new record to appear in its properly sorted position, you can either use the <span CLASS="ElementNameeln">Requery</span> method or re-create the <span CLASS="ElementNameeln">Recordset</span> object.
<p CLASS="Textttext">If you add a record to a table-type<span CLASS="ElementNameeln"> Recordset</span>, the record appears positioned according to the current index, or at the end of the table if there is no current index. Because Microsoft Jet version 3.0 or later allows multiple users to create new records in a table simultaneously, your record may not appear right at the end of the <span CLASS="ElementNameeln">Recordset</span> as it did in previous versions of Microsoft Jet. Be sure to use the <span CLASS="ElementNameeln">LastModified</span> property rather than the <span CLASS="ElementNameeln">MoveLast</span> method to move to the record you just added.</p>
<p CLASS="ImportantTextit"><span CLASS="ImportantHeadingih">Important&nbsp;&nbsp;&nbsp;</span>If you use the <span CLASS="ElementNameeln">AddNew</span> method to add a new record, and then move to another record or close the <span CLASS="ElementNameeln">Recordset</span> object without first using the <span CLASS="ElementNameeln">Update</span> method, your changes are lost without warning. For example, omitting the <span CLASS="ElementNameeln">Update</span> method from the preceding example results in no changes being made to the Shippers table.</p>
<!--mstheme--></font><table CELLPADDING="3" BORDER="2" BORDERCOLOR="#0000FF" bordercolordark="#660000" bordercolorlight="#CC9966"><tr BGCOLOR="#FFFFFF"><td><!--mstheme--><font face="book antiqua, times new roman, times">
<p CLASS="SidebarHeadingsbrh">Caching ODBC Data with a Recordset</p>
<p CLASS="SidebarTextsbrt">You can use the dynaset-type <span CLASS="ElementNameeln">Recordset</span> to create a local cache for ODBC data. This lets you retrieve records in batches instead of one at a time as each record is requested, and makes much better use of your server connection, thus improving performance.
<p CLASS="SidebarTextsbrt">The <span CLASS="ElementNameeln">CacheSize</span> and <span CLASS="ElementNameeln">CacheStart</span> properties establish the size and starting offset (expressed as a bookmark) for the cache. For example, you may set the <span CLASS="ElementNameeln">CacheSize</span> property to 100 records. Then, using the <span CLASS="ElementNameeln">FillCache</span> method, you can retrieve sufficient records to fill the cache.</p>
<p CLASS="SidebarCrossRefTextsbrcrt"><span CLASS="CrossRefHeadingcrh">See Also</span><span CLASS="EmSpaceems">&nbsp;&nbsp;&nbsp;</span>For more information on caching ODBC data, see Chapter 19, <a HREF="../chapters/ba19_1.htm" OnClick="SyncURL(&quot;chapters/ba19_1.htm&quot;)">&quot;Developing Client/Server Applications.&quot;</a></p><!--mstheme--></font></td></tr></table><!--mstheme--><font face="book antiqua, times new roman, times">
<a NAME="5TrackingRecordsetChanges"></a>
<p CLASS="heading5OrgHeading3h3">Tracking Recordset Changes</p>
<p CLASS="Textttext">You may need to determine when the underlying <span CLASS="ElementNameeln">TableDef</span> object of a table-type <span CLASS="ElementNameeln">Recordset</span> was created, or the last time it was modified. The <span CLASS="ElementNameeln">DateCreated</span> and <span CLASS="ElementNameeln">LastUpdated</span> properties, respectively, give you this information. Both properties return the date stamp applied to the table by the machine on which the table resided at the time it was stamped. These properties are only updated when the table's design changes; they aren't affected by changes to records in the table.</p>
<a NAME="4MicrosoftJetTransactions"></a>
<p CLASS="heading4OrgHeading2h2">Microsoft Jet Transactions</p>
<p CLASS="Textttext">A <span CLASS="NewTermntrm">transaction</span> is a set of operations bundled together and treated as a single unit of work. The work in a transaction must be completed as a whole; if any part of the transaction fails, the entire transaction fails. Transactions offer the developer the ability to enforce data integrity. With multiple database operations bundled into a single unit that must succeed or fail as a whole, the database can't reach an inconsistent state. Transactions are common to most database management systems.
<p CLASS="Textttext">The most common example of transaction processing involves a bank's automated teller machine (ATM). The processes of dispensing cash and then debiting the user's account are considered a logical unit of work and are wrapped in a transaction: The cash isn't dispensed unless the system is also able to debit the account. By using a transaction, the entire operation either succeeds or fails. This maintains the consistent state of the ATM database.
<p CLASS="Textttext">You should consider using transactions if you want to make sure that each operation in a group of operations is successful before all operations are committed. Keep in mind that all transactions are invisible to other transactions. That is, no transaction can see another transaction's updates to the database until the transaction is committed.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>The behavior of transactions with Microsoft Access databases differs from the behavior of ODBC data sources, such as Microsoft SQL Server&#153;. For example, if a database is connected to a file server, and the file server stops before a transaction has had time to commit its changes, then your database could be left in an inconsistent state. If you require true transaction support with respect to durability, you should investigate the use of a client/server architecture. For more information on client/server architecture, see Chapter 19, <a HREF="../chapters/ba19_1.htm" OnClick="SyncURL(&quot;chapters/ba19_1.htm&quot;)">&quot;Developing Client/Server Applications.&quot;</a></p>
<a NAME="5UsingTransactionsinYourApplications"></a>
<p CLASS="heading5OrgHeading3h3">Using Transactions in Your Applications</p>
<p CLASS="Textttext">Microsoft Jet supports transactions through the DAO <span CLASS="ElementNameeln">BeginTrans</span>,<span CLASS="ElementNameeln"> CommitTrans</span>, and <span CLASS="ElementNameeln">Rollback</span> methods of the <span CLASS="ElementNameeln">Workspace</span> object. The basic syntax is shown in the following table.</p>
<!--mstheme--></font><table WIDTH="100%" BORDER="0" CELLPADDING="5" CELLSPACING="0" FRAME="VOID" RULES="THEAD"><thead>
<tr VALIGN="TOP" BGCOLOR="#DDDDDD">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Method</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Operation</p></font><!--mstheme--></font></td></tr><tbody>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="NewTermntrm">workspace.</span><span CLASS="ElementNameeln">BeginTrans</span></p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Begins the transaction</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="NewTermntrm">workspace.</span><span CLASS="ElementNameeln">CommitTrans</span></p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Posts the transaction, writing its updates to the permanent database objects</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="NewTermntrm">workspace.</span><span CLASS="ElementNameeln">Rollback</span></p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Cancels the transaction</p></font><!--mstheme--></font></td></tr>
</table><!--mstheme--><font face="book antiqua, times new roman, times">
<p CLASS="Textttext">The following example changes the job title of all sales representatives in the Employees table of the Northwind sample database. After the <span CLASS="ElementNameeln">BeginTrans</span> method starts a transaction that isolates all of the changes made to the Employees table, the <span CLASS="ElementNameeln">CommitTrans </span>method saves the changes. Notice that you can use the <span CLASS="ElementNameeln">Rollback</span> method to undo changes that you saved with the <span CLASS="ElementNameeln">Update</span> method.</p>
<p CLASS="CodeTextct">Sub ChangeTitle()<br>&nbsp;&nbsp;&amp;nbspDim dbsSales As Database<br>&nbsp;&nbsp;&amp;nbspDim rstEmp As Recordset<br>&nbsp;&nbsp;&amp;nbspDim wrkCurrent As Workspace<br>&nbsp;&nbsp;&amp;nbspSet wrkCurrent = DBEngine.Workspaces(0)<br>&nbsp;&nbsp;&amp;nbspSet dbsSales = OpenDatabase(&quot;Northwind.mdb&quot;)<br>&nbsp;&nbsp;&amp;nbspSet rstEmp = dbsSales.OpenRecordset(&quot;Employees&quot;, dbOpenTable)<br>&nbsp;&nbsp;&amp;nbspwrkCurrent.BeginTrans<br>&nbsp;&nbsp;&amp;nbspDo Until rstEmp.EOF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf rstEmp!Title = &quot;Sales Representative&quot; Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmp.Edit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmp!Title = &quot;Sales Associate&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmp.Update<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsprstEmp.MoveNext<br>&nbsp;&nbsp;&amp;nbspLoop<br>&nbsp;&nbsp;&amp;nbspIf MsgBox(&quot;Save all changes?&quot;, vbQuestion + vbYesNo) = vbYes Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspwrkCurrent.CommitTrans<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspwrkCurrent.Rollback<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbsprstEmp.Close<br>&nbsp;&nbsp;&amp;nbspdbsSales.Close<br>End Sub</p>
<p CLASS="Textttext">When you use transactions, all databases and<span CLASS="ElementNameeln"> Recordset</span> objects in the specified<span CLASS="ElementNameeln"> Workspace</span> object are affected<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">transactions are global to the workspace, not to a specific database or <span CLASS="ElementNameeln">Recordset</span>. If you perform operations on more than one database or within a workspace transaction, the <span CLASS="ElementNameeln">Commit</span> and <span CLASS="ElementNameeln">Rollback</span> methods affect all the objects changed within that workspace during the transaction.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>You can also use the <span CLASS="ElementNameeln">BeginTrans</span>, <span CLASS="ElementNameeln">CommitTrans</span>, and<span CLASS="ElementNameeln"> Rollback</span> methods with the <span CLASS="ElementNameeln">DBEngine</span> object. In this case, the transaction is applied to the default workspace, which is <span CLASS="CodeTextEmbeddedcte">DBEngine.Workspaces(0)</span>.</p>
<a NAME="5ManagingTransactions"></a>
<p CLASS="heading5OrgHeading3h3">Managing Transactions</p>
<p CLASS="Textttext">Microsoft Jet uses sophisticated algorithms to enhance transaction performance, reliability, and usability. This section discusses topics related to how the Jet database engine manages transactions.</p>
<a NAME="6TransactionSize"></a>
<p CLASS="heading6OrgHeading4h4">Transaction Size</p>
<p CLASS="Textttext">Transaction size is limited only by the amount of physical space on your disk drive. That is, Microsoft Jet can store a quantity of transaction data as large as the amount of free space on your disk drive. If the available disk space is exhausted during a transaction, a trappable run-time error occurs. Your code should check for this error (number 2004) and react accordingly. If you try to commit the transaction after this error occurs, Microsoft Jet will commit an indeterminate number of changes, possibly leaving the database in an inconsistent state. You should usually roll back the transaction when this error occurs to ensure a consistent database state.</p>
<a NAME="6NestingTransactions"></a>
<p CLASS="heading6OrgHeading4h4">Nesting Transactions</p>
<p CLASS="Textttext">You can have up to five levels of transactions active at any one time by nesting combinations of <span CLASS="ElementNameeln">BeginTrans</span> and either <span CLASS="ElementNameeln">CommitTrans</span> or <span CLASS="ElementNameeln">Rollback</span>. If you nest transactions, you must make sure that you commit or roll back the current transaction before trying to commit or roll back a transaction at a higher level of nesting.
<p CLASS="Textttext">If you want to have transactions with overlapping, nonnested scopes, you can open additional <span CLASS="ElementNameeln">Workspace</span> objects and manage other transactions within those new workspaces.</p>
<a NAME="6WhenaTransactionisRolledBackbytheJetDatabaseEngine"></a>
<p CLASS="heading6OrgHeading4h4">When a Transaction is Rolled Back by the Jet Database Engine</p>
<p CLASS="Textttext">If you close a <span CLASS="ElementNameeln">Workspace</span> object, any transactions within the scope of the workspace are automatically rolled back. Microsoft Jet never automatically commits any transactions you have started. This behavior is also true of database object variables. If you close a database object variable, any uncommitted transactions within the scope of that database object variable are rolled back. You should be aware of this behavior when you write your code. Never assume that the Jet database engine is going to commit your transaction for you.</p>
<a NAME="6TransactionsonExternalDataSources"></a>
<p CLASS="heading6OrgHeading4h4">Transactions on External Data Sources</p>
<p CLASS="Textttext">Transactions aren't supported on external non-Microsoft Jet data sources, with the exception of ODBC data. For example, if your database has linked FoxPro® or dBASE® tables, any transactions on those objects are ignored. This means that the transaction doesn't fail or generate a run-time error, but it doesn't actually do anything either.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note  </span> Microsoft Access version 2.0 databases are opened by Microsoft Access for Windows 95 and Microsoft Access 97 as external installable ISAM databases. However, unlike other external data sources, the Jet database engine does support transactions on Microsoft Access version 2.<span CLASS="NewTermntrm">x</span> databases.</p>
<p CLASS="Textttext">To determine whether or not a <span CLASS="ElementNameeln">Database</span> or <span CLASS="ElementNameeln">Recordset</span> object supports transactions, you can check the value of its <span CLASS="ElementNameeln">Transactions</span> property. A value of <span CLASS="ElementNameeln">True</span> indicates that the object does support transactions, and a value of <span CLASS="ElementNameeln">False</span> indicates that the object doesn't support transactions.</p>
<a NAME="5TransactionsandPerformance"></a>
<p CLASS="heading5OrgHeading3h3">Transactions and Performance</p>
<p CLASS="Textttext">In previous versions of Microsoft Access, it was generally recommended that you use transactions as a performance enhancement. Now all transactions for DAO add, update, and delete operations are performed internally and automatically. In most situations, this automatic support provides your application with the best possible performance. However, there may be situations where you want to fine-tune transaction behavior. You can do this by creating and modifying various settings in the Windows Registry.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on tuning Registry settings used by Microsoft Jet, see <a HREF="../chapters/ba13_2.htm" OnClick="SyncURL(&quot;chapters/ba13_2.htm&quot;)">&quot;Adjusting Windows Registry Settings to Improve Performance&quot;</a> in Chapter 13, &quot;Optimizing Your Application.&quot;</p>
<a NAME="4ExtractingDatafromaRecord"></a>
<p CLASS="heading4OrgHeading2h2">Extracting Data from a Record</p>
<p CLASS="Textttext">After you've located a particular record or records, you may want to extract data to use in your application instead of modifying the underlying source table.</p>
<a NAME="5CopyingaSingleField"></a>
<p CLASS="heading5OrgHeading3h3">Copying a Single Field</p>
<p CLASS="Textttext">You can copy a single field of a record to a variable of the appropriate data type. The following example extracts three fields from the first record in a <span CLASS="ElementNameeln">Recordset</span> object:</p>
<p CLASS="CodeTextct">Dim dbs As Database, rstEmployees As Recordset<br>Dim strFirstName As String, strLastName As String<br>Dim strTitle As String<br> <br>Set dbs = CurrentDb<br>Set rstEmployees = dbs.OpenRecordset(&quot;Employees&quot;)<br>rstEmployees.MoveFirst<br>strFirstName = rstEmployees!FirstName<br>strLastName = rstEmployees!LastName<br>strTitle = rstEmployees!Title<br>rstEmployees.Close</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on extracting data from a record, see <a HREF="../chapters/ba09_2.htm#4ReadingandWritingData" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)">&quot;Reading and Writing Data&quot;</a> later in this chapter.</p>
<a NAME="5CopyingEntireRecordstoanArray"></a>
<p CLASS="heading5OrgHeading3h3">Copying Entire Records to an Array</p>
<p CLASS="Textttext">To copy one or more entire records, you can create a two-dimensional array and copy records one at a time. You increment the first subscript for each field and the second subscript for each record.
<p CLASS="Textttext">A fast way to do this is with the <span CLASS="ElementNameeln">GetRows</span> method. The <span CLASS="ElementNameeln">GetRows </span>method returns a two-dimensional array. The first subscript identifies the field and the second identifies the row number, as follows:</p>
<p CLASS="CodeTextct">varRecords(intField, intRecord)</p>
<p CLASS="Textttext">The following example uses an SQL statement to retrieve three fields from a table called Employees into a <span CLASS="ElementNameeln">Recordset</span> object. It then uses the <span CLASS="ElementNameeln">GetRows</span> method to retrieve the first three records of the <span CLASS="ElementNameeln">Recordset</span>, and it stores the selected records in a two-dimensional array. It then prints each record, one field at a time, by using the two array indexes to select specific fields and records.
<p CLASS="Textttext">To clearly illustrate how the array indexes are used, the following example uses a separate statement to identify and print each field of each record. In practice, it would be more reliable to use two loops, one nested in the other, and to provide integer variables for the indexes that step through both dimensions of the array.</p>
<p CLASS="CodeTextct">Sub GetRowsTest()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspDim rstEmployees As Recordset<br>&nbsp;&nbsp;&amp;nbspDim varRecords As Variant<br>&nbsp;&nbsp;&amp;nbspDim intNumReturned As Integer<br>&nbsp;&nbsp;&amp;nbspDim intNumColumns As Integer<br>&nbsp;&nbsp;&amp;nbspDim intColumn As Integer, intRow As Integer<br> <br>&nbsp;&nbsp;&amp;nbspSet dbs = CurrentDb<br>&nbsp;&nbsp;&amp;nbspSet rstEmployees = dbs.OpenRecordset(&quot;SELECT FirstName, LastName, Title &quot; _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp; &quot;FROM Employees&quot;, dbOpenSnapshot)<br>&nbsp;&nbsp;&amp;nbspvarRecords = rstEmployees.GetRows(3)<br>&nbsp;&nbsp;&amp;nbspintNumReturned = UBound(varRecords, 2) + 1<br>&nbsp;&nbsp;&amp;nbspintNumColumns = UBound(varRecords, 1) + 1<br>&nbsp;&nbsp;&amp;nbspFor intRow = 0 To intNumReturned - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspFor intColumn = 0 To intNumColumns - 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDebug.Print varRecords(intColumn, intRow)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspNext intColumn<br>&nbsp;&nbsp;&amp;nbspNext intRow<br>&nbsp;&nbsp;&amp;nbsprstEmployees.Close<br>End Sub</p>
<p CLASS="Textttext">You can use subsequent calls to the <span CLASS="ElementNameeln">GetRows</span> method if more records are available. Because the array is filled as soon as you call the <span CLASS="ElementNameeln">GetRows </span>method, you can see why this approach is much faster than copying one field at a time.
<p CLASS="Textttext">Notice also that you don't have to declare the <span CLASS="ElementNameeln">Variant</span> as an array, because this is done automatically when the <span CLASS="ElementNameeln">GetRows</span> method returns records. This enables you to use fixed-length array dimensions without knowing how many records or fields will be returned, instead of using variable-length dimensions that take up more memory.
<p CLASS="Textttext">If you're trying to retrieve all the rows by using multiple<span CLASS="ElementNameeln"> GetRows</span> calls, use the <span CLASS="ElementNameeln">EOF</span> property to be sure that you're at the end of the <span CLASS="ElementNameeln">Recordset</span>. The <span CLASS="ElementNameeln">GetRows</span> method may return fewer rows than you request. If you request more that the remaining number of rows in a <span CLASS="ElementNameeln">Recordset</span>, for example, the<span CLASS="ElementNameeln"> GetRows</span> method only returns the rows that remain. Similarly, if it can't retrieve a row in the range requested, it doesn't return that row. For example, if the fifth record cannot be retrieved in a group of ten records that you're trying to retrieve, the <span CLASS="ElementNameeln">GetRows </span>method returns four records and leaves the current record position on the record that caused a problem<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">and doesn't generate a run-time error. This situation may occur if a record in a dynaset was deleted by another user. If it returns fewer records than the number requested and you're not at the end of the file, you need to read each field in the current record to determine what error the <span CLASS="ElementNameeln">GetRows</span> method encountered.
<p CLASS="Textttext">Because the <span CLASS="ElementNameeln">GetRows</span> method always returns all the fields in the <span CLASS="ElementNameeln">Recordset</span> object, you may want to create a query that returns just the fields that you need. This is especially important for OLE Object and Memo fields.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on OLE Object and Memo fields, see <a HREF="../chapters/ba09_2.htm#5TheOLEObjectandMemoDataTypes" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)">&quot;The OLE Object and Memo Data Types&quot;</a> later in this chapter.</p>
<p><!--DocFooterStart-->
<p><span CLASS="copyright"><a HREF="cpyright.htm">© 1996 Microsoft Corporation. All rights reserved.</a></span>
<p><!--DocFooterEnd-->
<a HREF="ba09_2.htm" OnClick="SyncURL(&quot;chapters/ba09_2.htm&quot;)"><img SRC="..\images\nextpage.gif" ALT="Next Page" ALIGN="RIGHT" BORDER="0"></a><!--mstheme--></font></body></html>
