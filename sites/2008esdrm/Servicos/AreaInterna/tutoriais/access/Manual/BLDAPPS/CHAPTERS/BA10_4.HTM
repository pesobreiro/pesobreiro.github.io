<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head><title>Locking Shared Data in Recordsets</title>
<link REL="STYLESHEET" HREF="naetugp.css" TYPE="text/css">
<script Language="VBScript">
Dim look
Sub SyncURL(look)
if right(top.frames(0).frames(1).location.href, 10)="toc_tc.htm" then
top.frames(0).frames(1).TreeCtl1.SyncToURL(look)
end if
End Sub
</script>
<meta name="Microsoft Theme" content="expeditn 011, default"></head>
<!--DocHeaderStart-->
<body background="../../../../_themes/expeditn/exptextb.jpg" bgcolor="#FFFFFF" text="#000000" link="#993300" vlink="#666600" alink="#CC3300"><!--mstheme--><font face="book antiqua, times new roman, times"><a HREF="ba10_3.htm" OnClick="SyncURL(&quot;chapters/ba10_3.htm&quot;)"><img SRC="..\images\prevpage.gif" ALT="Previous Page" ALIGN="RIGHT" BORDER="0"></a>
<!--DocHeaderEnd-->
<!-- This is a PANDA Generated HTML file. The source is a WinWord Document. -->
<a NAME="3LockingSharedDatainRecordsets"></a>
<p CLASS="heading3OrgHeading1h1">Locking Shared Data in Recordsets</p>
<p CLASS="Textttext">Although bound forms are one way to create a multiuser application, they don't provide the flexibility that Visual Basic procedures do. When you write your own locking procedures and run them from unbound forms, you can adapt your locking strategy and handle conflicts among users in a way more suitable for your situation<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">something that isn't possible with bound forms.</p>
<a NAME="4LevelsofLocking"></a>
<p CLASS="heading4OrgHeading2h2">Levels of Locking</p>
<p CLASS="Textttext">There are three different levels at which you can lock data in <span CLASS="ElementNameeln">Recordset</span> objects:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="NewTermntrm">Exclusive mode</span> prevents all other users from using the entire database. This is the most restrictive level.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="NewTermntrm">Recordset locking</span> locks a <span CLASS="ElementNameeln">Recordset</span> object's underlying tables.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&nbsp;<span CLASS="NewTermntrm">Page locking</span> locks the 2,048 byte (2K) page where the data that is being edited resides. This is the least restrictive level.</p>
<p CLASS="Textttext">To determine at which level you want to lock objects in your application, you must decide the level of <span CLASS="NewTermntrm">concurrency</span> that you need. Concurrency is the ability of more than one transaction to access the same data at the same time. For example, if you want the objects to be available as often as possible to as many users as possible, a high-concurrency strategy would dictate that you use page locking, which is the least restrictive level. However, if your application requires guaranteed access to most or all of the data in the database, you may opt for exclusive mode. This ensures that your application has the database open exclusively so it can't be shared by other users. 
<p CLASS="Textttext">The three levels aren't mutually exclusive. Many multiuser applications use all three levels at different times. For example, in an order entry system in which you want many order takers to have access to data simultaneously, you can use page locking to lock data in the Orders table. You can use recordset locking at the end of the day to lock a summary table and update it with summary data. Finally, you can use exclusive mode each night to compact the database.</p>
<a NAME="4UsingExclusiveMode"></a>
<p CLASS="heading4OrgHeading2h2">Using Exclusive Mode</p>
<p CLASS="Textttext">Exclusive mode is the most restrictive way you can lock data. It prevents all other users from opening the database; therefore, it denies all users access to all data in the database. This is useful for performing administrative or bulk changes to the database, such as repair or compact operations, or when making changes to the database's underlying structure, or <span CLASS="NewTermntrm">schema</span>.
<p CLASS="Textttext">When you access a database in a single-user environment, you typically open it in exclusive mode. This may provide better performance because Microsoft Jet doesn't have to lock and unlock objects or refresh its cache. When you access a database in a multiuser environment, exclusive mode is no longer an option; you must open the database in shared mode.
<p CLASS="Textttext">If you want multiple users to share data with your application, make sure none of them open your application's database in exclusive mode. You can use security features in Microsoft Access to deny most users Open Exclusive permission. The database administrator should have Open Exclusive permission to perform such tasks as compacting and repairing the database. </p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For information on setting permissions, search the Help index for &quot;setting permissions.&quot;</p>
<p CLASS="Textttext">You can use code to open a database in exclusive mode. To do so, use the <span CLASS="ElementNameeln">OpenDatabase</span> method on the current <span CLASS="ElementNameeln">Workspace</span> object, and specify <span CLASS="ElementNameeln">True</span> for the <span CLASS="NewTermntrm">options</span> argument. The following procedure opens the Northwind sample database in exclusive mode and checks for errors to determine if the operation was successful:</p>
<p CLASS="CodeTextct">Sub OpenDatabaseExclusive()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspDim errCurrent As Error<br>&nbsp;&nbsp;&nbsp;' Try to open the Northwind database exclusively.<br>&nbsp;&nbsp;&amp;nbspOn Error Resume Next<br>&nbsp;&nbsp;&amp;nbspSet dbs = OpenDatabase(&quot;Northwind.mdb&quot;, True)<br>&nbsp;&nbsp;&amp;nbspIf Err &lt;&gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' If errors occur, display them.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspFor Each errCurrent In DBEngine.Errors<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDebug.Print errCurrent.Description<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspNext<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' No errors: You have exclusive access.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDebug.Print &quot;The database is open in exclusive mode.&quot;<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbspdbs.Close<br>End Sub</p>
<p CLASS="Textttext">Using Visual Basic to open the Northwind sample database in exclusive mode has the same effect as selecting the <span CLASS="ElementNameeln">Exclusive</span> check box in the <span CLASS="ElementNameeln">Open</span> dialog box (<span CLASS="ElementNameeln">File</span> menu). If one user already has the database open for write access, and another user tries to open the database in exclusive mode, a locking error occurs. The second user can't open the database in exclusive mode until the first user closes it.</p>
<a NAME="5UsingReadOnlyMode"></a>
<p CLASS="heading5OrgHeading3h3">Using Read-Only Mode</p>
<p CLASS="Textttext">If the database is opened in exclusive mode with read-only access (both the <span CLASS="NewTermntrm">options </span>and <span CLASS="NewTermntrm">read-only </span>arguments of the <span CLASS="ElementNameeln">OpenDatabase</span> method are specified as <span CLASS="ElementNameeln">True</span>), any user can read the database, but no user<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">including the user who opened it<img SRC="../images/Emdash.gif" BORDER="0" VSPACE="0" HSPACE="0" WIDTH="16" HEIGHT="5">can write to it. You may want to do this to force other users to open the database in read-only mode without establishing user-level security.
<p CLASS="Textttext">When you open a database in read-only mode without also specifying exclusive mode, you cannot change objects in the database; this includes data and structural information. However, this mode doesn't prevent other users from changing data.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>Opening a database in read-only mode doesn't prevent locking conflicts.</p>
<a NAME="5CheckingforErrors"></a>
<p CLASS="heading5OrgHeading3h3">Checking for Errors</p>
<p CLASS="Textttext">When you are setting locks in code with any level of locking, it's important that you handle any errors that occur. In Microsoft Access, you don't check to see if a lock can be set before you set it. Instead, you try the operation and then check to see if it succeeded.
<p CLASS="Textttext">The typical approach to locking is a four-step process:</p>
<p CLASS="ListSequentialItem1ls">1.&nbsp;&amp;nbspTurn off error handling.</p>
<p CLASS="ListSequentialItem1ls">2.&nbsp;&amp;nbspAttempt the operation.</p>
<p CLASS="ListSequentialItem1ls">3.&nbsp;&amp;nbspCheck to see if an error occurred. If so, handle the error based on the error number.</p>
<p CLASS="ListSequentialItem1ls">4.&nbsp;&amp;nbspTurn on error handling.</p>
<p CLASS="Textttext">This approach works well because you don't have to anticipate every possible error before trying to set a lock; you handle the error only if it occurs. When writing multiuser code, you should handle the error by displaying a message and giving the user an opportunity to retry the operation. The OpenDatabaseExclusive procedure in the previous section uses this technique. 
<p CLASS="Textttext">The most common error you'll encounter when you use exclusive mode is error number 3006, &quot;Database &lt;<span CLASS="NewTermntrm">name</span>&gt; is exclusively locked.&quot; This error occurs when you try to open a database that is currently open in exclusive mode by another user. To respond to the error, wait until the other user has finished working with the database and then try the operation again.
<p CLASS="Textttext"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on error handling, see Chapter 8, <a HREF="../chapters/ba08_1.htm" OnClick="SyncURL(&quot;chapters/ba08_1.htm&quot;)">&quot;Handling Run-Time Errors.&quot;</a></p>
<a NAME="4UsingRecordsetLocking"></a>
<p CLASS="heading4OrgHeading2h2">Using Recordset Locking</p>
<p CLASS="Textttext">You use exclusive mode to lock an entire database. You use recordset locking, on the other hand, to control how one or more individual tables in a database are locked. Recordset locking applies only to table- and dynaset-type <span CLASS="ElementNameeln">Recordset</span> objects; it doesn't apply to snapshot- and forward-only-type <span CLASS="ElementNameeln">Recordset</span><span CLASS="CrossRefHeadingcrh"> </span>objects because these are inherently read-only objects.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>The default recordset lock is a write lock, which means that other users can't edit data in the locked records. You can also prevent users from reading the data by setting a read lock. You may want to do this if you are making bulk changes to a <span CLASS="ElementNameeln">Recordset</span> object and you want to prevent users from reading the data until you have completed your update. To set a read lock, specify the <span CLASS="ElementNameeln">dbDenyRead</span> constant in the <span CLASS="NewTermntrm">options</span> argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method. For more information, search the Help index for &quot;OpenRecordset method.&quot;</p>
<a NAME="5OpeningtheDatabaseinSharedMode"></a>
<p CLASS="heading5OrgHeading3h3">Opening the Database in Shared Mode</p>
<p CLASS="Textttext">If you want to implement recordset locking, you must open your database in shared mode. When a database is opened in shared mode, multiple users can simultaneously access the database and Microsoft Jet handles conflicts between users.
<p CLASS="Textttext">You can use code to open a database in shared mode. To do so, use the <span CLASS="ElementNameeln">OpenDatabase</span> method on the current <span CLASS="ElementNameeln">Workspace</span> object, and specify <span CLASS="ElementNameeln">False</span> for the <span CLASS="NewTermntrm">options</span> argument. The following procedure opens the Northwind sample database in shared mode and checks for errors to determine if the operation was successful:</p>
<p CLASS="CodeTextct">Sub OpenDatabaseShared()<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspDim errCurrent As Error<br>&nbsp;&nbsp;&nbsp;' Try to open the Northwind database in shared mode.<br>&nbsp;&nbsp;&amp;nbspOn Error Resume Next<br>&nbsp;&nbsp;&amp;nbspSet dbs = OpenDatabase(&quot;Northwind.mdb&quot;, False)<br>&nbsp;&nbsp;&amp;nbspIf Err &lt;&gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Errors occurred: Display them.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspFor Each errCurrent In DBEngine.Errors<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDebug.Print errCurrent.Description<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspNext<br>&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' No errors: Database is in shared mode.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDebug.Print &quot;The database is open in shared mode.&quot;<br>&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&amp;nbspdbs.Close<br>End Sub</p>
<p CLASS="Textttext">Using Visual Basic to open the Northwind sample database in shared mode has the same effect as clearing the <span CLASS="ElementNameeln">Exclusive</span> check box in the <span CLASS="ElementNameeln">Open</span> dialog box (<span CLASS="ElementNameeln">File</span> menu).</p>
<a NAME="5OpeningtheRecordsetObject"></a>
<p CLASS="heading5OrgHeading3h3">Opening the Recordset Object</p>
<p CLASS="Textttext">After you open the database in shared mode, you can implement recordset locking by specifying various constants in the <span CLASS="NewTermntrm">options</span> argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method. You can use a combination of the available constants to more precisely specify the type of locking you want to implement.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For a complete list of the constants you can specify for the <span CLASS="NewTermntrm">options</span> argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method, see <a HREF="../chapters/ba09_1.htm#5OpenRecordsetOptions" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;OpenRecordset Options&quot;</a> in Chapter 9, &quot;Working with Records and Fields.&quot;</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To open a Recordset object with locking enabled</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspOpen the <span CLASS="ElementNameeln">Recordset</span> object's database in shared mode.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspDetermine the type of recordset locking you want to implement.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspOpen the <span CLASS="ElementNameeln">Recordset</span> object by using the <span CLASS="ElementNameeln">OpenRecordset</span> method and set the <span CLASS="NewTermntrm">options</span> argument to the constant or combination of constants that specify the type of locking that you want.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspClose the <span CLASS="ElementNameeln">Recordset</span> object when you're finished performing operations on the data to release any locks on the <span CLASS="ElementNameeln">Recordset</span> object.</p>
<p CLASS="Textttext">For example, the following code locks a table by opening it with the <span CLASS="ElementNameeln">dbDenyWrite</span> and <span CLASS="ElementNameeln">dbDenyRead</span> constants specified in the<span CLASS="NewTermntrm"> options</span> argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method. For the duration of the procedure, no other users can access this table. If an error occurs when trying to open the table, the function returns the public constant <span CLASS="ElementNameeln">conFailed</span>.</p>
<p CLASS="CodeTextct">Function OpenTableEx(dbs As Database, strTable As String) As Integer<br>&nbsp;&nbsp;&amp;nbspDim rst As Recordset<br>&nbsp;&nbsp;&amp;nbspOn Error Resume Next<br>&nbsp;&nbsp;&amp;nbspSet rst = dbs.OpenRecordset(strTable, dbOpenTable, dbDenyRead + dbDenyWrite)<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' conSuccess and conFailed are defined at the module level as public<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' constants with values of 0 and -32,761 respectively.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 0: OpenTableEx = conSuccess<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else: OpenTableEx = conFailed<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>&nbsp;&nbsp;&amp;nbspErr = 0<br>End Function</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>If you open a <span CLASS="ElementNameeln">Recordset</span> object without specifying any value for the <span CLASS="NewTermntrm">options</span> argument, Microsoft Jet uses page locking by default. It opens the <span CLASS="ElementNameeln">Recordset</span> object<span CLASS="ElementNameeln"> </span>in shared mode and locks only the data that's being edited in the current page.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on opening a <span CLASS="ElementNameeln">Recordset</span> object, see <a HREF="../chapters/ba09_1.htm#4CreatingaRecordsetObjectVariable" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Creating a Recordset Object Variable&quot;</a> in Chapter 9, &quot;Working with Records and Fields.&quot;</p>
<a NAME="5CheckingforErrorswithRecordsetLocking"></a>
<p CLASS="heading5OrgHeading3h3">Checking for Errors with Recordset Locking</p>
<p CLASS="Textttext">As with opening databases in exclusive mode, setting locks on <span CLASS="ElementNameeln">Recordset</span> objects can cause errors if the lock fails. You should use the four-step process described in the previous section: turn off error handling, attempt the operation, check for errors and handle any that occur, and finally, turn on error handling.
<p CLASS="Textttext">The most common error in recordset locking is error number 3262, &quot;Couldn't lock table &lt;<span CLASS="NewTermntrm">name</span>&gt;; currently in use by user &lt;<span CLASS="NewTermntrm">name</span>&gt; on machine &lt;<span CLASS="NewTermntrm">name</span>&gt;.&quot; This error occurs when you try to use the <span CLASS="ElementNameeln">OpenRecordset</span> method on an object that can't be locked. There is usually another user who has the same table or tables locked in a way that prevents your action. To respond to the error, wait a short period of time and try the operation again.</p>
<a NAME="4UsingPageLocking"></a>
<p CLASS="heading4OrgHeading2h2">Using Page Locking</p>
<p CLASS="Textttext">While exclusive mode locks the entire database, and recordset locking locks one or more individual tables, page locking locks only the page containing the record that is currently being edited. This is the least restrictive level of locking. When you use page locking, other users can read data from the locked page, but they cannot change it. Page locking is the default locking level for <span CLASS="ElementNameeln">Recordset</span> objects.
<p CLASS="Textttext">In the parts of your application that lock data at the page level, you must specify which type of page locking you want to use. There are two types of page locking available: pessimistic locking and optimistic locking.
<p CLASS="Textttext">You can set the type of page locking for a <span CLASS="ElementNameeln">Recordset</span> object by specifying either the <span CLASS="ElementNameeln">dbPessimistic</span> or the <span CLASS="ElementNameeln">dbOptimistic</span> constant in the <span CLASS="NewTermntrm">lockedits</span> argument of the <span CLASS="ElementNameeln">OpenRecordset</span> method. You can also set the type of page locking after you open a <span CLASS="ElementNameeln">Recordset</span> object by using its <span CLASS="ElementNameeln">LockEdits</span> property. For pessimistic locking, set the <span CLASS="ElementNameeln">LockEdits</span> property to <span CLASS="ElementNameeln">True</span>; for optimistic locking, set the <span CLASS="ElementNameeln">LockEdits</span> property to <span CLASS="ElementNameeln">False</span>.</p>
<a NAME="5PessimisticLocking"></a>
<p CLASS="heading5OrgHeading3h3">Pessimistic Locking</p>
<p CLASS="Textttext">With pessimistic locking, a page is locked once you begin editing a record on that page with the <span CLASS="ElementNameeln">Edit</span> method. The page remains locked until you save your changes to the record with the <span CLASS="ElementNameeln">Update</span> method or cancel the edit, either with the <span CLASS="ElementNameeln">CancelUpdate</span> method or by moving off the current record. Pessimistic locking is the default type of page locking for <span CLASS="ElementNameeln">Recordset</span> objects.
<p CLASS="Textttext">The main advantage of pessimistic locking is that after you have obtained a lock, you know that you won't encounter any locking conflicts as long as the record is locked. Additionally, pessimistic locking is the only way to guarantee that your application reads the most current data, because one user can't change a record after another user has started to edit it.
<p CLASS="Textttext">The disadvantage of pessimistic locking is that it locks the entire page for the duration of the procedure. Therefore, other users can't change any records on that page until the lock is released.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To use pessimistic locking in your code</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspOpen a table- or dynaset-type <span CLASS="ElementNameeln">Recordset</span> object on the data that you want to edit.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspImplement pessimistic locking by setting the <span CLASS="ElementNameeln">LockEdits</span> property of the <span CLASS="ElementNameeln">Recordset</span> object to <span CLASS="ElementNameeln">True</span>.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspMove to the record that you're interested in.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">Edit</span> method to allow edits to the record. This locks the record. If the lock fails, try again.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">5</span>&nbsp;&nbsp;&amp;nbspWhen the record is locked, make your changes to the record.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">6</span>&nbsp;&nbsp;&amp;nbspSave your changes to the record by using the <span CLASS="ElementNameeln">Update</span> method. After your changes are saved, the lock is released.</p>
<a NAME="5OptimisticLocking"></a>
<p CLASS="heading5OrgHeading3h3">Optimistic Locking</p>
<p CLASS="Textttext">With optimistic locking, a page is locked only when you try to save the changes to the record with the <span CLASS="ElementNameeln">Update</span> method. Because the lock is applied only when your application tries to update the record, you minimize the time the lock is in place; this is the main advantage of optimistic locking.
<p CLASS="Textttext">The disadvantage of optimistic locking is that when you are editing a record, you can't be sure that the update will succeed. Your attempt to update the record with your edits fails if another user updates the record first.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To use optimistic locking in your code</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspOpen a table- or dynaset-type <span CLASS="ElementNameeln">Recordset</span> object on the data that you want to edit.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspMove to the record that you're interested in.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspImplement optimistic locking by setting the <span CLASS="ElementNameeln">LockEdits</span> property of the <span CLASS="ElementNameeln">Recordset</span> object to <span CLASS="ElementNameeln">False</span>.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">Edit</span> method to allow edits to the record. This does not lock the record.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">5</span>&nbsp;&nbsp;&amp;nbspMake changes to the record.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">6</span>&nbsp;&nbsp;&amp;nbspSave your changes to the record by using the <span CLASS="ElementNameeln">Update </span>method. This attempts to lock the record.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">7</span>&nbsp;&nbsp;&amp;nbspCheck to see if the <span CLASS="ElementNameeln">Update</span> method succeeded. If it didn't, try again.</p>
<p CLASS="Textttext">It's possible for the <span CLASS="ElementNameeln">Update</span> method to fail in optimistic locking. For example, if one user has a <span CLASS="ElementNameeln">Recordset</span> object open with pessimistic locking, and another user tries to update data on the same page by using optimistic locking, the second user's attempt to update will fail.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>Optimistic locking turns into pessimistic locking when transactions are used. Because a transaction locks data so that users can't change it until the transaction is committed, pessimistic locking is used even though the <span CLASS="ElementNameeln">LockEdits</span> property may have been set to <span CLASS="ElementNameeln">False</span>. For more information on transactions, see <a HREF="../chapters/ba09_1.htm#4MicrosoftJetTransactions" OnClick="SyncURL(&quot;chapters/ba09_1.htm&quot;)">&quot;Microsoft Jet Transactions&quot;</a> in Chapter 9, &quot;Working with Records and Fields.&quot;</p>
<a NAME="5CheckingforErrorswithPageLocking"></a>
<p CLASS="heading5OrgHeading3h3">Checking for Errors with Page Locking</p>
<p CLASS="Textttext">When using page locking, before proceeding, your code must check to see if the attempted lock succeeded. As with exclusive mode and recordset locking, you should turn off error handling, attempt the operation, check for errors and handle any that occur, and finally, turn on error handling.
<p CLASS="Textttext">The following table describes the three most common errors that your application may encounter when you use page locking.</p>
<!--mstheme--></font><table WIDTH="100%" BORDER="0" CELLPADDING="5" CELLSPACING="0" FRAME="VOID" RULES="THEAD"><thead>
<tr VALIGN="TOP" BGCOLOR="#DDDDDD">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Error number and text</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Cause and suggested response</p></font><!--mstheme--></font></td></tr><tbody>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="ElementNameeln">3186</span>  &quot;Couldn't save; currently locked by user &lt;<span CLASS="NewTermntrm">name</span>&gt; on machine &lt;<span CLASS="NewTermntrm">name</span>&gt;.&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">This error occurs when a user tries to save a record on a page that is locked by another user.
<p CLASS="TableTexttt">To handle this error, program your application to wait for a short period of time, and then try to save the record again. Optionally, you can display a message that explains the problem and give users the opportunity to try the operation again.</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="ElementNameeln">3197</span>  &quot;The database engine stopped the process because you and another user are attempting to change the same data at the same time.&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">This error occurs when another user has changed the data a user is trying to update. The other user changed the data between the time the first user used the <span CLASS="ElementNameeln">Edit</span> method and the <span CLASS="ElementNameeln">Update</span> method.
<p CLASS="TableTexttt">If this error occurs when the user uses the <span CLASS="ElementNameeln">Edit</span> method, you may want to handle this error by programming your application to refresh the user's view of the data with the current data and then attempt the <span CLASS="ElementNameeln">Edit</span> method a second time.
<p CLASS="TableTexttt">If this error occurs when the user uses the <span CLASS="ElementNameeln">Update</span> method, then optimistic locking is in place and the record has changed since the user used the <span CLASS="ElementNameeln">Edit</span> method. To handle this error, program your application to display a message that informs the user that someone else has changed the data. You may want to display the current data and give the user the choice of whether to overwrite the other user's changes or cancel their own edits.</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="ElementNameeln">3260</span>  &quot;Couldn't update; currently locked by user &lt;<span CLASS="NewTermntrm">name</span>&gt; on machine &lt;<span CLASS="NewTermntrm">name</span>&gt;.&quot;</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">This error occurs when a user uses the <span CLASS="ElementNameeln">Edit</span> method and the page containing the current record is locked.
<p CLASS="TableTexttt">This error also occurs when a user uses the <span CLASS="ElementNameeln">AddNew</span> method or the <span CLASS="ElementNameeln">Update</span> method to save a record on a locked page. This situation can occur when the user is trying to save a new record or when optimistic locking is in place and another user locks the page.
<p CLASS="TableTexttt">To handle this error, program your application to wait for a short period of time, and then try to save the record again. Optionally, you can inform users of the problem and allow them to indicate whether or not they want to retry the operation.</p></font><!--mstheme--></font></td></tr>
</table><!--mstheme--><font face="book antiqua, times new roman, times">&nbsp;&nbsp;&nbsp;<a NAME="5PageLockingCodeExample"></a>
<p CLASS="heading5OrgHeading3h3">Page Locking Code Example</p>
<p CLASS="Textttext">You can write a procedure that tries to lock a record, check to see if an error occurred, and respond to it regardless of the type of error. Alternatively, you can write a procedure that identifies the specific error that occurs and responds to it. The following procedure tries to edit a record. If a locking error occurs, the procedure tries to identify the error and responds accordingly. If an unidentified error occurs, the procedure displays a message and exits the function.</p>
<p CLASS="CodeTextct">Function UpdateUnitsInStock(strProduct As String, intUnitsInStock _<br>&nbsp;&nbsp;&amp;nbspAs Integer, intMaxTries As Integer) <br>&nbsp;&nbsp;&amp;nbspDim dbs As Database, rstProducts As Recordset<br>&nbsp;&nbsp;&amp;nbspDim blnError As Boolean, intCount As Integer<br>&nbsp;&nbsp;&amp;nbspDim intLockCount, intChoice As Integer, intRndCount As Integer, intI As Integer<br>&nbsp;&nbsp;&amp;nbspConst conFilePath As String = &quot;C:\Program Files\Microsoft Office\Office\Samples\&quot;<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&nbsp;' Open the database in shared mode. <br>&nbsp;&nbsp;&amp;nbspSet dbs = OpenDatabase(conFilePath &amp; &quot;Northwind.mdb&quot;)<br>&nbsp;&nbsp;&nbsp;' Open the table for editing. <br>&nbsp;&nbsp;&amp;nbspSet rstProducts = dbs.OpenRecordset(&quot;Products&quot;, dbOpenDynaset)<br>&nbsp;&nbsp;&amp;nbspWith rstProducts<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Set the locking type to pessimistic. Setting LockEdits to<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' False would use optimistic locking.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.LockEdits = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.FindFirst &quot;ProductName = &quot; &amp; Chr(34) &amp; strProduct &amp; Chr(34)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf .NoMatch Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' conErrNoMatch is defined at the module level as a public<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' constant of type Integer with a value of -32737.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspUpdateUnitsInStock = conErrNoMatch<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspGoTo CleanExit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Attempt to edit the record. If a lock error occurs, the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' error handler will attempt to resolve it. Because this procedure<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' uses pessimistic locking, errors are generated when you begin to edit a<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' record. If it used optimistic locking, lock errors would occur when you<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' update a record. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Edit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;![UnitsInStock] = intUnitsInStock<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Update<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&amp;nbspEnd With<br>&nbsp;&nbsp;&nbsp;<br>CleanExit: <br>&nbsp;&nbsp;&amp;nbsprstProducts.Close<br>&nbsp;&nbsp;&amp;nbspdbs.Close<br>&nbsp;&nbsp;&amp;nbspExit Function<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 3197<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Data in the recordset has changed since it was opened.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Try to edit the record again. This automatically refreshes<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' the recordset to display the most recent data.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 3260&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' The record is locked.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintLockCount = intLockCount + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Tried to get the lock twice already.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf intLockCount &gt; 2 Then&nbsp;&nbsp;&nbsp;' Let the user cancel or retry.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintChoice = MsgBox(Err.Description &amp; &quot; Retry?&quot;, _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspvbYesNo + vbQuestion)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspIf intChoice = vbYes Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintLockCount = 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspElse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' conErrRecordLocked is defined at the module level as a public<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' constant of type Integer with a value of -32,736.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspUpdateUnitsInStock = conErrRecordLocked<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume CleanExit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspEnd If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Yield to Windows.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspDoEvents<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Delay a short random interval, making it longer each time the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' lock fails.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspintRndCount = intLockCount ^ 2 * Int(Rnd * 3000 + 1000)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspFor intI = 1 To intRndCount: Next intI<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Try the edit again.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Unanticipated error.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspMsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error, vbOKOnly, &quot;ERROR&quot;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' conFailed is defined at the module level as a public<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' constant of type Integer with a value of -32,761.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspUpdateUnitsInStock = conFailed<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume CleanExit<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<p CLASS="Textttext">Note that the code specifies a random interval to retry the operation. This is an important technique for making sure that two users who are trying to update the same record don't end up in a deadlock situation where the code keeps trying to lock the record at the same time. By introducing a random element into the timing loop, you can minimize the chances of a deadlock.</p>
<a NAME="4TestingaRecordforLockingStatus"></a>
<p CLASS="heading4OrgHeading2h2">Testing a Record for Locking Status</p>
<p CLASS="Textttext">You may want to check to see if a record is locked without actually locking its page or pages. The following procedure uses the <span CLASS="ElementNameeln">LockEdits</span> property to determine if the current record is locked:</p>
<p CLASS="CodeTextct">Function RecordLocked(rst As Recordset) As Boolean<br>&nbsp;&nbsp;&amp;nbspDim blnLock As Boolean<br>&nbsp;&nbsp;&amp;nbspOn Error GoTo ErrorHandler<br>&nbsp;&nbsp;&nbsp;' Save current value of LockEdits property.<br>&nbsp;&nbsp;&amp;nbspblnLock = rst.LockEdits<br>&nbsp;&nbsp;&nbsp;' Set pessimistic locking.<br>&nbsp;&nbsp;&amp;nbsprst.LockEdits = True<br>&nbsp;&nbsp;&nbsp;' Try to edit the record. This generates error 3197 if the<br>&nbsp;&nbsp;&nbsp;' record is locked.<br>&nbsp;&nbsp;&amp;nbsprst.Edit<br>&nbsp;&nbsp;&amp;nbspRecordLocked = False<br>&nbsp;&nbsp;&amp;nbsprst.CancelUpdate<br>&nbsp;&nbsp;&nbsp;' Restore original value of LockEdits property.<br>&nbsp;&nbsp;&amp;nbsprst.LockEdits = blnLock<br>&nbsp;&nbsp;&amp;nbspExit Function<br>ErrorHandler:<br>&nbsp;&nbsp;&amp;nbspSelect Case Err<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase 3197<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspCase Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspRecordLocked = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspResume Next<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit Function<br>&nbsp;&nbsp;&amp;nbspEnd Select<br>End Function</p>
<a NAME="4ImplementingaCustomLockingScheme"></a>
<p CLASS="heading4OrgHeading2h2">Implementing a Custom Locking Scheme</p>
<p CLASS="Textttext">You may encounter situations in your multiuser application where the behavior of the built-in Microsoft Jet locking strategies isn't appropriate. In this case, you may want to consider your own custom locking scheme. Implemented through a set of routines that you write, custom locking completely bypasses Microsoft Jet locking. Your code controls locking by identifying when a record should be locked and unlocked.
<p CLASS="Textttext">The most common approach to this technique is to have a lock table that identifies when a record is locked. The lock table identifies records by storing the primary key value of the record, the lock status (locked or unlocked), and the name of the user who has the record locked.
<p CLASS="Textttext">The implementation of a custom locking scheme requires a great deal of design, implementation, and testing time. In many cases, it can't duplicate functionality that is built into Microsoft Jet. For example, even if you implement single-record locking, it would be very difficult to handle data in a <span CLASS="ElementNameeln">Recordset</span> object that's based on more than one table, because you would have to determine all the tables that contain records that have to be locked. Custom locking schemes are most attractive when they affect only a few tables and aren't based on a data model with complex joins and relationships.</p>
<p><!--DocFooterStart-->
<p><span CLASS="copyright"><a HREF="cpyright.htm">© 1996 Microsoft Corporation. All rights reserved.</a></span>
<p><!--DocFooterEnd-->
<a HREF="ba10_5.htm" OnClick="SyncURL(&quot;chapters/ba10_5.htm&quot;)"><img SRC="..\images\nextpage.gif" ALT="Next Page" ALIGN="RIGHT" BORDER="0"></a><!--mstheme--></font></body></html>
