<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head><title>Replicating Part of a Database</title>
<link REL="STYLESHEET" HREF="naetugp.css" TYPE="text/css">
<script Language="VBScript">
Dim look
Sub SyncURL(look)
if right(top.frames(0).frames(1).location.href, 10)="toc_tc.htm" then
top.frames(0).frames(1).TreeCtl1.SyncToURL(look)
end if
End Sub
</script>
<meta name="Microsoft Theme" content="expeditn 011, default"></head>
<!--DocHeaderStart-->
<body background="../../../../_themes/expeditn/exptextb.jpg" bgcolor="#FFFFFF" text="#000000" link="#993300" vlink="#666600" alink="#CC3300"><!--mstheme--><font face="book antiqua, times new roman, times"><a HREF="ba20_5.htm" OnClick="SyncURL(&quot;chapters/ba20_5.htm&quot;)"><img SRC="..\images\prevpage.gif" ALT="Previous Page" ALIGN="RIGHT" BORDER="0"></a>
<!--DocHeaderEnd-->
<!-- This is a PANDA Generated HTML file. The source is a WinWord Document. -->
<a NAME="3ReplicatingPartofaDatabase"></a>
<p CLASS="heading3OrgHeading1h1">Replicating Part of a Database</p>
<p CLASS="Textttext">So far, this chapter has discussed <span CLASS="NewTermntrm">full replicas</span>, in which all records in all replicas of a replica set are synchronized in their entirety. However, you may only want to replicate part of your data. To do this, you create <span CLASS="NewTermntrm">partial replicas</span>, which contain only a subset of the records in the full replica. With a partial replica, you can set filters and relationships that identify which subset of the records in the full replica you want to synchronize.
<p CLASS="Textttext">By replicating only part of your database, you can restrict access to data. In the case of a sales database, replicating part of a database can help ensure that people in a regional sales office don't view sales data for other regional offices. In addition, salespersons who carry laptops can filter their data to include only the information that is relevant to their territory. Although you can restrict access to records or filter records when you replicate part of a database, this isn't a substitute for a security system.
<p CLASS="Textttext">Replicating part of a database also has benefits for replicating data over local area networks (LANs) and wide area networks (WANs). By applying filters and relationships that restrict which data is replicated, you can reduce the amount of data transferred over a LAN or a WAN. This can reduce network traffic and lower telecommunications costs.
<p CLASS="Textttext">To create a partial replica, you can use DAO code or tools provided on the Microsoft Access Developer Forum Web site.</p>
<p CLASS="CrossRefTextcrt"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span>For more information on the Microsoft Access Developer Forum Web site, see <a HREF="../chapters/ba02_5.htm#4AccessingRelevantInformationontheInternet" OnClick="SyncURL(&quot;chapters/ba02_5.htm&quot;)">&quot;Accessing Relevant Information on the Internet&quot;</a> in Chapter 2, &quot;Introducing Visual Basic.&quot;</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>You can synchronize data only between a full replica and a partial replica. You can't synchronize data between two partial replicas. Also, when you replicate part of a database, you can set restrictions on which records are replicated, but you can't indicate which fields are replicated.</p>
<a NAME="4CreatingPartialReplicas"></a>
<p CLASS="heading4OrgHeading2h2">Creating Partial Replicas</p>
<p CLASS="Textttext">You can use DAO methods and properties to create a partial replica.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To create a partial replica</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspOpen with exclusive access the database that contains the data you want to replicate.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">MakeReplica</span> method on a <span CLASS="ElementNameeln">Database</span> object, and specify the <span CLASS="ElementNameeln">dbRepMakePartial</span> constant in the <span CLASS="NewTermntrm">options </span>argument.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For an example of using the <span CLASS="ElementNameeln">MakeReplica</span> method, see the MakeAdditionalReplica function in <a HREF="../chapters/ba20_5.htm" OnClick="SyncURL(&quot;chapters/ba20_5.htm&quot;)">&quot;Making Additional Replicas&quot;</a> earlier in this chapter.</span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">ReplicaFilter</span> and <span CLASS="ElementNameeln">PartialReplica</span> properties to set filters and relationships that determine which data to replicate from the full replica.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">4</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">PopulatePartial</span> method to replicate all records from the full replica that meet the new replica filter criteria.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>Once you create a partial replica, you cannot convert it to a full replica. However, if you remove all of the replica filters and replica relationships within the partial replica, it contains all the records of a full replica. However, it still has the same limitations of a partial replica; for example, you can't synchronize with another partial replica.</p>
<a NAME="5SettingReplicaFilters"></a>
<p CLASS="heading5OrgHeading3h3">Setting Replica Filters</p>
<p CLASS="Textttext">You use a replica filter to specify which subset of records to include from the full replica in the partial replica. To set a filter, use the<span CLASS="ElementNameeln"> ReplicaFilter</span> property of the <span CLASS="ElementNameeln">TableDef</span> object. You can set the <span CLASS="ElementNameeln">ReplicaFilter</span> property to the following values.</p>
<!--mstheme--></font><table WIDTH="100%" BORDER="0" CELLPADDING="5" CELLSPACING="0" FRAME="VOID" RULES="THEAD"><thead>
<tr VALIGN="TOP" BGCOLOR="#DDDDDD">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Value</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableHeadingth">Description</p></font><!--mstheme--></font></td></tr><tbody>
<tr VALIGN="TOP">
<td NOWRAP><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">A string</p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">A criteria that a record must satisfy to appear in the replicated table. The syntax you use is similar to an SQL WHERE clause, but you cannot specify subqueries, aggregate functions (such as the <span CLASS="ElementNameeln">Count </span>function), or user-defined functions within the criteria. </p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="ElementNameeln">True</span></p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">Replicate all records.</p></font><!--mstheme--></font></td></tr>
<tr VALIGN="TOP">
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt"><span CLASS="ElementNameeln">False</span></p></font><!--mstheme--></font></td>
<td><!--mstheme--><font face="book antiqua, times new roman, times"><font FACE="Arial" SIZE="2">
<p CLASS="TableTexttt">(Default) Don't replicate any records except those required to maintain referential integrity.</p></font><!--mstheme--></font></td></tr>
</table><!--mstheme--><font face="book antiqua, times new roman, times">
<p CLASS="Textttext">For example, to replicate only customer records from the California region, you would use the following code:</p>
<p CLASS="CodeTextct">Sub ReplicaFilterX(strPartialReplica As String)<br>&nbsp;&nbsp;&amp;nbspDim tdfCustomers As TableDef<br>&nbsp;&nbsp;&amp;nbspDim strFilter As String<br>&nbsp;&nbsp;&amp;nbspDim dbs As Database<br>&nbsp;&nbsp;&amp;nbspSet dbs = OpenDatabase(strPartialReplica), True<br>&nbsp;&nbsp;&amp;nbspSet tdfCustomers = dbs.TableDefs(&quot;Customers&quot;)<br>&nbsp;&nbsp;&amp;nbspstrFilter = &quot;Region = 'CA'&quot;<br>&nbsp;&nbsp;&amp;nbsptdfCustomers.ReplicaFilter = strFilter<br>&nbsp;&nbsp;&amp;nbspdbs.PopulatePartial strPartialReplica<br>&nbsp;&nbsp;&amp;nbspdbs.Close<br>End Sub</p>
<p CLASS="Textttext">To remove a filter, set the <span CLASS="ElementNameeln">ReplicaFilter</span> property to <span CLASS="ElementNameeln">False</span>. Once you remove all filters and use the <span CLASS="ElementNameeln">PopulatePartial</span> method, no records appear in any replicated tables.
<p CLASS="Textttext">Usually, you reset a replica filter when you want to archive data or replicate a different set of records. For example, when a sales representative temporarily takes over another sales representative's region, the database application can temporarily replicate data for both regions and then return to the previous filter. In this scenario, the application resets the <span CLASS="ElementNameeln">ReplicaFilter</span> property and then repopulates the databases.
<p CLASS="TipIcontpi"></p>
<p CLASS="TipTexttpt"><span CLASS="TipHeadingtph">Tip&nbsp;&nbsp;&nbsp;</span>You can significantly improve synchronization speed by specifying indexed fields in the <span CLASS="ElementNameeln">ReplicaFilter</span> property.</p>
<a NAME="5TheRoleofReferentialIntegrity"></a>
<p CLASS="heading5OrgHeading3h3">The Role of Referential Integrity</p>
<p CLASS="Textttext">If your database contains relationships that enforce referential integrity, then the Synchronizer automatically replicates related records. For example, suppose you create a new replica with no records in it and set the <span CLASS="ElementNameeln">ReplicaFilter</span> property of the Orders table in the new replica to <span CLASS="CodeTextEmbeddedcte">&quot;Amount &gt; 1000&quot;</span>. The next synchronization populates the Orders table in the new replica with all records that have an order amount over $1,000. This also populates records in the Customers table that are related to the Orders records, along with records in the Products table that are related to the records in the Orders table, and so on.
<p CLASS="Textttext">This automatic inclusion only occurs for records that must satisfy referential integrity constraints. For example, because the Customers table has a one-to-many relationship with the Orders table, if one or more records exist in the Orders table for a given customer, the Customers table must have a corresponding record to satisfy the referential integrity rule. Setting the <span CLASS="ElementNameeln">ReplicaFilter</span> property of the Customers table, however, doesn't automatically include related records in the Orders table. This is because referential integrity rules don't require a referenced row. To include such rows, use the <span CLASS="ElementNameeln">PartialReplica</span> property described in the following section.</p>
<a NAME="5SettingReplicaRelationships"></a>
<p CLASS="heading5OrgHeading3h3">Setting Replica Relationships</p>
<p CLASS="Textttext">In some cases, setting the <span CLASS="ElementNameeln">ReplicaFilter</span> property alone can't adequately specify which data should be replicated to the partial replica. For example, suppose you have a database in which the Customers table has a one-to-many relationship with the Orders table, and you want to configure a partial replica that only replicates orders from customers in the California region (instead of all orders). You can't set the <span CLASS="ElementNameeln">ReplicaFilter</span> property on the Orders table to <span CLASS="CodeTextEmbeddedcte">Region = 'CA'</span> because the Region field is in the Customers table, not the Orders table.
<p CLASS="Textttext">You can use the <span CLASS="ElementNameeln">PartialReplica</span> property of the <span CLASS="ElementNameeln">Relation</span> object to specify whether relationships between tables should be considered when populating a partial replica from a full replica. For example, to replicate all orders from customers in the California region, you would create a partial replica and set the <span CLASS="ElementNameeln">ReplicaFilter</span> property for the Customers <span CLASS="ElementNameeln">TableDef</span> object to <span CLASS="CodeTextEmbeddedcte">&quot;Region = 'CA'&quot;</span>. Then, set the <span CLASS="ElementNameeln">PartialReplica</span> property to <span CLASS="ElementNameeln">True</span> for the <span CLASS="ElementNameeln">Relation</span> object that corresponds to the relationship between the Orders and Customers tables.
<p CLASS="Textttext">The following code shows how to set the <span CLASS="ElementNameeln">PartialReplica</span> property:</p>
<p CLASS="CodeTextct">' Assumptions:<br>' The current open database, dbs, is the partial replica, and a one-to-many<br>' relationship already exists between the Customers and Orders tables.<br>' Find the &quot;Customers to Orders&quot; Relation object.<br>For intI = 0 To dbs.Relations.Count - 1<br>&nbsp;&nbsp;&amp;nbspIf (dbs.Relations(intI).Table = &quot;Customers&quot;) _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspAnd (dbs.Relations(intI).ForeignTable = _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Orders&quot;) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Set the Relation object's PartialReplica property to True.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspdbs.Relations(intI).PartialReplica = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbspExit For<br>&nbsp;&nbsp;&amp;nbspEnd If<br>Next intI</p>
<p CLASS="Textttext">If you have a second requirement to replicate all orders greater than $1,000, regardless of the region with which they are associated, you can set the <span CLASS="ElementNameeln">ReplicaFilter</span> property of the Orders table to <span CLASS="CodeTextEmbeddedcte">&quot;Amount &gt; 1000&quot;</span>. Synchronizing the partial replica with the full replica populates the Orders table with all orders greater than $1,000 from all regions, in addition to all orders from the California region.
<p CLASS="Textttext">Keep the following points in mind when setting replica filters and relationships:</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspIf you have set a replica filter and a replica relationship on the same table, the two act in combination as a logical <span CLASS="ElementNameeln">Or</span> operation, not a logical <span CLASS="ElementNameeln">And</span> operation. For instance, in the preceding example, the records exchanged during synchronization are all orders greater than $1,000 or all orders from the California region, not all orders from the California region that are over $1,000.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspIt makes no difference in which order you add replica filters and replica relationships.</p>
<p CLASS="ListBulletedItem1lb1"><img SRC="../images/bullet.jpg" WIDTH="5" HEIGHT="7">&amp;nbspAlthough it's possible to set complex filters and replica relationships, this isn't recommended. Use the <span CLASS="ElementNameeln">ReplicaFilter</span> and <span CLASS="ElementNameeln">PartialReplica</span> properties to place general restrictions on which data is replicated.</p>
<a NAME="5RepopulatingPartialReplicas"></a>
<p CLASS="heading5OrgHeading3h3">Repopulating Partial Replicas</p>
<p CLASS="Textttext">When you synchronize a partial replica with a full replica, it's possible to create &quot;orphaned&quot; records in the partial replica. For example, suppose you have a Customers table with its <span CLASS="ElementNameeln">ReplicaFilter</span> property set to <span CLASS="CodeTextEmbeddedcte">&quot;Region = 'CA'&quot;</span>. If a user changes a customer's region from CA to NY in the partial replica, and then a synchronization occurs, the change is propagated to the full replica, but the record containing NY in the partial replica is orphaned because it now doesn't meet the replica filter criteria.
<p CLASS="Textttext">To solve the problem of orphaned records, you can use the <span CLASS="ElementNameeln">PopulatePartial</span> method. The <span CLASS="ElementNameeln">PopulatePartial</span> method transfers any unpropagated changes to the full replica, removes all records in the partial replica, and then repopulates the partial replica based on the current replica filters. Even if your replica filters have not changed, the <span CLASS="ElementNameeln">PopulatePartial</span> method always repopulates the partial replica by clearing all records in the partial replica.
<p CLASS="Textttext">Generally, you use the <span CLASS="ElementNameeln">PopulatePartial</span> method when you create a partial replica and whenever you change your replica filters.</p>
<p CLASS="heading9ListProcedureHeadinglproch"><span CLASS="ProcedureIconproci"><img SRC="../images/bluetri.jpg" ALIGN="LEFT" WIDTH="9" HEIGHT="17">&nbsp;&nbsp;&nbsp;</span>To change replica filters</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">1</span>&nbsp;&nbsp;&amp;nbspBefore you change the replica filters, use the <span CLASS="ElementNameeln">Synchronize</span> method to synchronize your full replica with the partial replica.</p>
<p CLASS="ListText1lt1"><span CLASS="CrossRefHeadingcrh">See Also&nbsp;&nbsp;&nbsp;</span><span CLASS="Xref">For more information on the <span CLASS="ElementNameeln">Synchronize</span> method, see <a HREF="../chapters/ba20_7.htm" OnClick="SyncURL(&quot;chapters/ba20_7.htm&quot;)">&quot;Synchronizing Replicas&quot;</a> later in this chapter.</span></p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">2</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">ReplicaFilter</span> and <span CLASS="ElementNameeln">PartialReplica</span> properties to make changes to the replica filters and relationships.</p>
<p CLASS="ListProcedureItem1lproc"><span CLASS="lproc">3</span>&nbsp;&nbsp;&amp;nbspUse the <span CLASS="ElementNameeln">PopulatePartial</span> method to remove all records from the partial replica and transfer all records from the full replica that meet the new replica filter criteria.</p>
<p CLASS="Textttext">If a replica filter has changed and you use the <span CLASS="ElementNameeln">Synchronize</span> method without first using the <span CLASS="ElementNameeln">PopulatePartial</span> method, a trappable error occurs.</p>
<p CLASS="NoteTextnt"><span CLASS="NoteHeadingnh">Note&nbsp;&nbsp;&nbsp;</span>Although the <span CLASS="ElementNameeln">PopulatePartial</span> method performs a one-way synchronization from the partial replica to the full replica before it removes and repopulates the partial replica, it's still a good idea to use the <span CLASS="ElementNameeln">Synchronize</span> method before you use the <span CLASS="ElementNameeln">PopulatePartial</span> method. If the <span CLASS="ElementNameeln">Synchronize</span> method fails, a trappable error occurs. You can use this error to decide whether or not to proceed with the <span CLASS="ElementNameeln">PopulatePartial</span> method (which removes all records in the partial replica). If you use the <span CLASS="ElementNameeln">PopulatePartial</span> method by itself and an error occurs during synchronization, records in the partial replica are still removed.</p>
<p><!--DocFooterStart-->
<p><span CLASS="copyright"><a HREF="cpyright.htm">© 1996 Microsoft Corporation. All rights reserved.</a></span>
<p><!--DocFooterEnd-->
<a HREF="ba20_7.htm" OnClick="SyncURL(&quot;chapters/ba20_7.htm&quot;)"><img SRC="..\images\nextpage.gif" ALT="Next Page" ALIGN="RIGHT" BORDER="0"></a><!--mstheme--></font></body></html>
